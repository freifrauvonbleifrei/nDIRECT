#include <malloc.h>
#include <sys/time.h>
#include <stdio.h>
//#include <cblas.h>
#include <stdlib.h>

void trans_ass_core_K33(float *out_start, float *start, long out_num_size, long loop_count){
    
    asm volatile(
        ".macro K33_M8N8_UKERNEL_LOOP            \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[0], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[0], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[1], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[1], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[2], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[2], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[3], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[3], [x0], #16          \n"

        
        "ldr        q3, [x1], #16                       \n"
        "ldr        q4, [x4], #16                       \n"
        "ldr        q5, [x5], #16                       \n"
        "ldr        q6, [x6], #16                       \n"

        "ldr        q7, [x7], #16                       \n"
        "ldr        q8, [x8], #16                       \n"
        "ldr        q9, [x9], #16                         \n"
        "ldr        q10, [x10], #16                        \n"
        
        ".endm                                  \n"
        
        //ENTRANCE
        
        "ldr    x1, %[start]            \n"
        "ldr    x0, %[out_start]       \n"
        "ldr    x2, %[out_num_size]          \n"
        "ldr    x3, %[loop_count]       \n"
        
        "ldr        q3, [x1]                       \n"
        "add        x4, x1, x2              \n"
        
        "add        x5, x4, x2              \n"
        "add        x6, x5, x2              \n"
        "ldr        q4, [x4]                       \n"
        
        
        "add        x7, x6, x2              \n"
        "add        x8, x7, x2              \n"
        "ldr        q5, [x5]                       \n"
        
        "add        x9, x8, x2              \n"
        "add        x10, x9, x2             \n"
        "ldr        q6, [x6]                       \n"
        "ldr        q7, [x7]                       \n"
        "ldr        q8, [x8]                       \n"
        "ldr        q9, [x9]                         \n"
        "ldr        q10, [x10]                        \n"

        "add        x1, x1, #12     \n"

        "add        x4, x4, #12     \n"
        "add        x5, x5, #12     \n"
        "add        x6, x6, #12     \n"
        "add        x7, x7, #12     \n"
        "add        x8, x8, #12     \n"
        "add        x9, x9, #12     \n"
        "add        x10, x10, #12     \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[0], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[0], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[1], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[1], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[2], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[2], [x0], #16          \n"
        
        
        "ldr        q3, [x1], #16                       \n"
        "ldr        q4, [x4], #16                       \n"
        "ldr        q5, [x5], #16                       \n"
        "ldr        q6, [x6], #16                       \n"
        
        "ldr        q7, [x7], #16                       \n"
        "ldr        q8, [x8], #16                       \n"
        "ldr        q9, [x9], #16                         \n"
        "ldr        q10, [x10], #16                        \n"
        
        "K33_M8N8_PARAL_LOOP:                    \n"
        "   K33_M8N8_UKERNEL_LOOP                \n"
        "   subs    x3, x3, #1          \n"
        "   beq     K33_M8N8_END_LOOP            \n"
        "   b       K33_M8N8_PARAL_LOOP          \n"
        
        "K33_M8N8_END_LOOP:                      \n"
    
    :
    
    :
        [out_start] "m" (out_start),
        [start]     "m" (start),
        [out_num_size]   "m" (out_num_size),
        [loop_count]"m" (loop_count)
    
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10",
        
        "v3", "v4", "v5", "v6", "v7","v8","v9","v10"
    );
    
    
}


void transform_filter_paral_ass_K33(float* kernel, float* out_kernel, long outch, long kc_tile, long trans_threads)
{
    long i, j, k, ii, jj, kk, h, w;
    
    long kc, ic;
    
    long k_h = 3;
    
    long k_w = 3;
    
    long inch = 3;
    
    long st_0, st_1, st;

    long thread_used = trans_threads;

    long out_num = inch * k_h * k_w;   //27
    
    long out_num_size = out_num * sizeof(float);
    
    long i_off_1;
    long j_off;
    
    float *start, *out_start;
    
    long loop_count = 6;  //   27 = 3*3*3   (27 -3) /4 =6

#pragma omp parallel for num_threads(thread_used) default(none) shared(kernel, out_kernel, out_num, outch, kc_tile, loop_count, out_num_size) private(kc, i, i_off_1, st_0, st_1, start, out_start)

    for(kc = 0; kc < outch; kc += kc_tile){
        
        st_0 = 27 * kc;
                    
            for(i=kc; i < kc + kc_tile; i += 8)
            {
                
                st_1 = st_0 + 27 * (i-kc);
                
                i_off_1 = i * out_num;
                
                start = kernel + i_off_1;
                
                out_start = out_kernel + st_1;
                
                trans_ass_core_K33(out_start, start, out_num_size, loop_count);
                
            }

    }
}

void trans_ass_core(float *out_start, float *start, long out_num_size, long loop_count){
    
    asm volatile(
        ".macro UKERNEL_LOOP            \n"
        "   st4     {v3.s, v4.s, v5.s, v6.s}[0], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[0], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[1], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[1], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[2], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[2], [x0], #16          \n"
        
        "   st4     {v3.s, v4.s, v5.s, v6.s}[3], [x0], #16          \n"
        "   st4     {v7.s, v8.s, v9.s, v10.s}[3], [x0], #16          \n"
        
        "ldr        q3, [x1], #16                       \n"
        "ldr        q4, [x4], #16                       \n"
        "ldr        q5, [x5], #16                       \n"
        "ldr        q6, [x6], #16                       \n"
        "ldr        q7, [x7], #16                       \n"
        "ldr        q8, [x8], #16                       \n"
        "ldr        q9, [x9], #16                         \n"
        "ldr        q10, [x10], #16                        \n"
        
        ".endm                                  \n"
        

        
        "ldr    x0, %[out_start]       \n"
        "ldr    x1, %[start]            \n"
        "ldr    x2, %[out_num_size]          \n"
        "ldr    x3, %[loop_count]       \n"
        
        
        "add        x4, x1, x2              \n"
        "add        x5, x4, x2              \n"
        "add        x6, x5, x2              \n"
        "add        x7, x6, x2              \n"
        "add        x8, x7, x2              \n"
        "add        x9, x8, x2              \n"
        "add        x10, x9, x2             \n"

        "ldr        q3, [x1], #16                       \n"
        "ldr        q4, [x4], #16                       \n"
        "ldr        q5, [x5], #16                       \n"
        "ldr        q6, [x6], #16                       \n"
        "ldr        q7, [x7], #16                       \n"
        "ldr        q8, [x8], #16                       \n"
        "ldr        q9, [x9], #16                         \n"
        "ldr        q10, [x10], #16                        \n"
        
        "PARAL_LOOP:                    \n"
        "   UKERNEL_LOOP                \n"
        "   subs    x3, x3, #1          \n"
        "   beq     END_LOOP            \n"
        "   b       PARAL_LOOP          \n"
        
        "END_LOOP:                      \n"
    :
    
    :
        [out_start] "m" (out_start),
        [start]     "m" (start),
        [out_num_size]   "m" (out_num_size),
        [loop_count]"m" (loop_count)    
    
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8", "x9", "x10",
        
        "v3", "v4", "v5", "v6", "v7","v8","v9","v10"
    );
    
    
}

void transform_filter_paral_ass(long outch, long inch, long k_h, 
                long k_w, float* kernel, float* out_kernel, long kc_tile, long ic_tile, long ic_out_tile, long kc_out_tile, long trans_threads)
{
    long i, j, k, ii, jj, kk, h, w;
    
    long kc_out, ic_out, kc, ic;
    
    long st_0, st_1, st;

    long thread_used = trans_threads;

    long out_num = inch * k_h * k_w;
    
    long out_num_size = out_num * 4;
    
    long i_off_1;
    long i_off_2;
    long i_off_3;
    long i_off_4;
    long i_off_5;
    long i_off_6;
    long i_off_7;
    long i_off_8;
    long h_off;
    long j_off;
    
    float *start, *out_start;
    
    long loop_count;
    
#pragma omp parallel for num_threads(thread_used) default(none) shared(kernel, out_kernel, out_num, outch, inch, k_w, k_h, kc_out_tile, kc_tile, ic_out_tile, ic_tile, loop_count, out_num_size) private(kc_out, ic_out, kc, ic, i, jj, h, w, i_off_1, i_off_2, i_off_3, i_off_4, i_off_5, i_off_6, i_off_7, i_off_8, j_off, h_off, st_0, st_1, st, start, out_start)
    for(kc_out = 0; kc_out < outch; kc_out += kc_out_tile){
        
        st_0 = 9 * inch * kc_out;
        
        for(ic_out = 0; ic_out < inch; ic_out += ic_out_tile){
            
            st_1 =  st_0 + 9 * kc_out_tile * ic_out;

            for(kc=kc_out; kc < kc_out + kc_out_tile; kc += kc_tile){
            
                st =  st_1 + 9 * (kc - kc_out) * ic_out_tile;
                
                for(ic=ic_out; ic < ic_out + ic_out_tile; ic += ic_tile)
                {
                    
                    for(i=kc; i < kc + kc_tile; i += 8)
                    {
                        
                        start = kernel + i * out_num;
                        
                        i_off_1 = i * out_num;
                        
                        j_off = ic * k_h *k_w;
                        
                        start = kernel + i_off_1 + j_off;
                        
                        out_start = out_kernel + st;
                        
                        loop_count = ic_tile * 9 / 4;
                        
                        trans_ass_core(out_start, start, out_num_size, loop_count);
                        
                        st += ic_tile * 9 * 8;
                        
                    }
                }
            }

        }
    }
}


void direct_3x3_M8N12_00_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_00_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            //"   fmul    v8.4s, v0.4s, #0           \n"
            //"   vmov q8, #0      \n"
            //"   fmov x17, #1  \n"
            /*
            "mov v12.s[0], w17            \n"
            "mov v12.s[1], w17            \n"
            "mov v12.s[2], w17            \n"
            "mov v12.s[3], w17            \n"
            */
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            
            /*
            "fmov v8.s[1], w17            \n"
            "fmov v8.s[2], w17            \n"
            "fmov v8.s[3], w17            \n"
            */
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"


            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v3.s[3]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[0]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[1]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[2]          \n"
            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            
            "   fmul    v28.4s, v1.4s, v3.s[3]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[2]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_00_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_00_K5                              \n"
                "   ld1     {v5.2s}, [x1], #8               \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
             //22 sub

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                
                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_00_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[1]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_00_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add  x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_00_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_00_LOOP                               \n"
    
    "M8N12_00_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_00_K3                     \n"

    "M8N12_00_LOOP:                                  \n"
    "   uKERNEL_M8N12_00_K4                                 \n"
    "   uKERNEL_M8N12_00_K5                                 \n"
    "   uKERNEL_M8N12_00_K6                                 \n"
    "   uKERNEL_M8N12_00_K7                                 \n"

    "   beq     M8N12_00_END_K                        \n"

    "   uKERNEL_M8N12_00_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_00_MAIN_K                       \n" 




    "M8N12_00_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_00                     \n"

    //ic != 0
    "   uKERNEL_M8N12_00_END                    \n"

    "   b    M8N12_00_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_00:                               \n"
    "   M8N12_00_ADD_C                                   \n"
    
    
    "M8N12_00_END:                                       \n"
    :

    :
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N12_01_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_01_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[2]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[3]          \n"
            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            

            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[2]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[3]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_K3                              \n"


                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_01_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   ld1     {v5.2s}, [x1], #8               \n"
                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_01_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                

                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                
                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_01_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   add     sp, sp, #384                       \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"




                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[2]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_01_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_01_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_01_LOOP                               \n"
    
    "M8N12_01_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_01_K3                     \n"

    "M8N12_01_LOOP:                                  \n"
    "   uKERNEL_M8N12_01_K4                                 \n"
    "   uKERNEL_M8N12_01_K5                                 \n"
    "   uKERNEL_M8N12_01_K6                                 \n"
    "   uKERNEL_M8N12_01_K7                                 \n"

    "   beq     M8N12_01_END_K                        \n"

    "   uKERNEL_M8N12_01_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_01_MAIN_K                       \n" 




    "M8N12_01_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_01                     \n"

    //ic != 0
    "   uKERNEL_M8N12_01_END                    \n"

    "   b    M8N12_01_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_01:                               \n"
    "   M8N12_01_ADD_C                                   \n"
    
    
    "M8N12_01_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N10_02_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N10_02_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"

            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            

            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"


            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            

            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_K3                              \n"


                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"



                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"


                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N10_02_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"


                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"

                

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N10_02_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                

                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"


                "   ldr     q7, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"


                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"



                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"


                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"


                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"



                "   ldr     q7, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                
                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"

                
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"


                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"

                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N10_02_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st2     {v24.s, v25.s}[0], [x4]    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st2     {v24.s, v25.s}[1], [x10]    \n" 
                
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st2     {v24.s, v25.s}[2], [x11]   \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st2     {v24.s, v25.s}[3], [x12]    \n"
                
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"


                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st2     {v28.s, v29.s}[0], [x13]    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st2     {v28.s, v29.s}[1], [x14]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st2     {v28.s, v29.s}[2], [x15]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st2     {v28.s, v29.s}[3], [x16]    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_END                             \n"

    
                
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16    \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"



                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x28], #16  \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x28], #16  \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x28], #16  \n"
                
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x28], #16  \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x28], #16  \n"
                
                
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x28], #16  \n"

                "   st2     {v24.s, v25.s}[0], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[1], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[2], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[3], [x28], #8  \n"
                
                "   st2     {v28.s, v29.s}[0], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[1], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[2], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[3], [x28], #8  \n"


                        // 4*8
                        
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"
                        

                
                        // 8-------
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                       \n"
                "   str     q9, [x14], #16                      \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                     \n"
                "   str     q11, [x16], #16                     \n"



                
                // 8
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x10]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x12]                       \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"
                
                
                //
                "   ld1     {v0.2s}, [x13]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x14]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                "   ld1     {v2.2s}, [x15]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x16]                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                
                "   st1     {v8.2s}, [x13]                       \n"
                "   st1     {v9.2s}, [x14]                      \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x15]                     \n"
                "   st1     {v11.2s}, [x16]                     \n"
                
    
    ".endm                                                  \n"
    
    "M8N10_02_ENTRANCE:                                                       \n"
    "   mov x29, sp     \n"

    "   sub x29, x29, #320                        \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    "   mov x28,x29     \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N10_02_BEGIN                     \n"

    
    
    "   b M8N10_02_LOOP                               \n"
    
    "M8N10_02_MAIN_K:                                  \n"
        "   uKERNEL_M8N10_02_K3                     \n"

    "M8N10_02_LOOP:                                  \n"
    "   uKERNEL_M8N10_02_K4                                 \n"
    "   uKERNEL_M8N10_02_K5                                 \n"
    "   uKERNEL_M8N10_02_K6                                 \n"
    "   uKERNEL_M8N10_02_K7                                 \n"

    "   beq     M8N10_02_END_K                        \n"

    "   uKERNEL_M8N10_02_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N10_02_MAIN_K                       \n" 




    "M8N10_02_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N10_02                     \n"

    //ic != 0
    "   uKERNEL_M8N10_02_END                    \n"

    "   b    M8N10_02_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N10_02:                               \n"
    "   M8N10_02_ADD_C                                   \n"
    
    
    "M8N10_02_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N8_02_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N8_02_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"



            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_K3                              \n"

                
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                
                
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N8_02_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"
                "   ld1     {v4.2s}, [x1], #8                   \n"
                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N8_02_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   ldr     q3, [x1], #16                   \n"


                
                //update img row 1 col 2

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   ld1     {v4.2s}, [x1], #8                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //edge :row 1 col 2

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N8_02_ADD_C       \n"

                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                    "   add     sp, sp, #256                    \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

                ".endm              \n"
                
                ".macro uKERNEL_M8N8_02_END       \n"

                    "   ldr     q0, [x4]                        \n"
                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   ldr     q1, [x10]                       \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"


                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4]                        \n"


                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10]                       \n"

                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11]                      \n"
                    "   str     q11, [x12]                      \n"




                    "   ldr     q8, [x13]                       \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   ldr     q9, [x14]                       \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   ldr     q10, [x15]                      \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                    "   ldr     q11, [x16]                      \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x13]                       \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x14]                       \n"

                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x15]                      \n"
                    "   str     q11, [x16]                      \n"




                    "   ldr     q8, [x4, #16]                   \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                    "   ldr     q9, [x10, #16]                  \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                    "   ldr     q10, [x11, #16]                 \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                    "   ldr     q11, [x12, #16]                 \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4, #16]                   \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10, #16]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x11, #16]                 \n"
                    "   str     q11, [x12, #16]                 \n"




                    "   ldr     q8, [x13, #16]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                    "   ldr     q9, [x14, #16]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                    "   ldr     q10, [x15, #16]                 \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                    "   ldr     q11, [x16, #16]                 \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x13, #16]                  \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x14, #16]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x15, #16]                 \n"
                    "   str     q11, [x16, #16]                 \n"


                ".endm                                          \n" 

//
    

    
    "M8N8_02_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #256                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N8_02_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N8_02_LOOP                               \n"
    
    "M8N8_02_MAIN_K:                                  \n"
        "   uKERNEL_M8N8_02_K3                     \n"

    "M8N8_02_LOOP:                                  \n"
    "   uKERNEL_M8N8_02_K4                                 \n"
    "   uKERNEL_M8N8_02_K5                                 \n"
    "   uKERNEL_M8N8_02_K6                                 \n"
    "   uKERNEL_M8N8_02_K7                                 \n"

    "   beq     M8N8_02_END_K                        \n"

    "   uKERNEL_M8N8_02_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N8_02_MAIN_K                       \n" 




    "M8N8_02_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N8_02                     \n"

    //ic != 0
    "   uKERNEL_M8N8_02_END                    \n"

    "   b    M8N8_02_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N8_02:                               \n"
    "   M8N8_02_ADD_C                                   \n"
    
    
    "M8N8_02_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N7_02_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N7_02_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                       \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            

            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                       \n"

            
            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"
            
            
            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"
            
            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"


            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_02_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N7_02_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                "   ldr     q2, [x1], #16                       \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"



                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                //update img row 1 col 1
                "   ldr     q3, [x1], #16                       \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"


                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"



                "   ldr     q7, [x3], #16                   \n"
                


                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                       \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"



                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                       \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    

    
    ".macro M8N7_02_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"



                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                
                
                "   st3     {v16.s, v17.s, v18.s}[0], [x4]    \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x10]    \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x11]    \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x12]    \n"
                

                

                "   st3     {v20.s, v21.s, v22.s}[0], [x13]   \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x14]   \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x15]   \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x16]   \n"

                


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_END                             \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16 \n"
                /*
                "   st3     {v16.s, v17.s, v18.s}[0], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x28], #12     \n"
                
                "   st3     {v20.s, v21.s, v22.s}[0], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x28], #12     \n"
                */
                "   st2     {v16.s, v17.s}[0], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[1], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[2], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[3], [x28], #8     \n"
                
                "   st2     {v20.s, v21.s}[0], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x28], #8     \n"
                
                "   st1     {v18.s}[0], [x28], #4        \n"
                "   st1     {v18.s}[1], [x28], #4        \n"
                "   st1     {v18.s}[2], [x28], #4        \n"
                "   st1     {v18.s}[3], [x28], #4        \n"
                
                "   st1     {v22.s}[0], [x28], #4        \n"
                "   st1     {v22.s}[1], [x28], #4        \n"
                "   st1     {v22.s}[2], [x28], #4        \n"
                "   st1     {v22.s}[3], [x28], #4        \n"
                
                
                
                //4
                "   ldr     q0, [x4]                   \n"
                "   ldr     q1, [x10]                   \n"
                "   ldr     q2, [x11]                   \n"
                "   ldr     q3, [x12]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"

                //4
                "   ldr     q0, [x13]                   \n"
                "   ldr     q1, [x14]                   \n"
                "   ldr     q2, [x15]                   \n"
                "   ldr     q3, [x16]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"

                //2
                "   ld1     {v0.2s}, [x4]                   \n"
                "   ld1     {v1.2s}, [x10]                   \n"
                "   ld1     {v2.2s}, [x11]                   \n"
                "   ld1     {v3.2s}, [x12]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x4], #8                   \n"
                "   st1     {v9.2s}, [x10], #8                   \n"
                "   st1     {v10.2s}, [x11], #8                   \n"
                "   st1     {v11.2s}, [x12], #8                   \n"

                 //2
                "   ld1     {v0.2s}, [x13]                   \n"
                "   ld1     {v1.2s}, [x14]                   \n"
                "   ld1     {v2.2s}, [x15]                   \n"
                "   ld1     {v3.2s}, [x16]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x13], #8                   \n"
                "   st1     {v9.2s}, [x14], #8                   \n"
                "   st1     {v10.2s}, [x15], #8                   \n"
                "   st1     {v11.2s}, [x16], #8                   \n"
                
                //1
                
                "   ld1     {v0.s}[0], [x4]                   \n"
                "   ld1     {v0.s}[1], [x10]                   \n"
                "   ld1     {v0.s}[2], [x11]                   \n"
                "   ld1     {v0.s}[3], [x12]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x4]                  \n"
                "   st1     {v8.s}[1], [x10]                  \n"
                "   st1     {v8.s}[2], [x11]                  \n"
                "   st1     {v8.s}[3], [x12]                  \n"

                //1
                
                "   ld1     {v0.s}[0], [x13]                   \n"
                "   ld1     {v0.s}[1], [x14]                   \n"
                "   ld1     {v0.s}[2], [x15]                   \n"
                "   ld1     {v0.s}[3], [x16]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x13]                  \n"
                "   st1     {v8.s}[1], [x14]                  \n"
                "   st1     {v8.s}[2], [x15]                  \n"
                "   st1     {v8.s}[3], [x16]                  \n"
                
                
                
    ".endm                                                  \n"
    
    "M8N7_02_ENTRANCE:                                                       \n"


    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add  x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #64]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x29, sp                            \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N7_02_BEGIN                     \n"

    "   sub x29, x29, #224                        \n"
    
    "   mov x28, x29                        \n"
    
    "   b M8N7_02_LOOP                               \n"
    
    "M8N7_02_MAIN_K:                                  \n"
        "   uKERNEL_M8N7_02_K3                     \n"

    "M8N7_02_LOOP:                                  \n"
    "   uKERNEL_M8N7_02_K4                                 \n"
    "   uKERNEL_M8N7_02_K5                                 \n"
    "   uKERNEL_M8N7_02_K6                                 \n"
    "   uKERNEL_M8N7_02_K7                                 \n"

    "   beq     M8N7_02_END_K                        \n"

    "   uKERNEL_M8N7_02_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N7_02_MAIN_K                       \n" 




    "M8N7_02_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N7_02                     \n"

    //ic != 0
    "   uKERNEL_M8N7_02_END                    \n"

    "   b    M8N7_02_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N7_02:                               \n"
    "   M8N7_02_ADD_C                                   \n"
    
    
    "M8N7_02_END:                                       \n"
    :

    :
        [img_pack]                  "m"     (img_pack),    
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N5_02_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N5_02_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"

            
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"

            "   ld1     {v3.2s}, [x1], #8                   \n"


            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"
            "   add     x12, x11, x6           \n"

            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   add     x13, x12, x6           \n"
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"
            "   add     x15, x14, x6          \n"
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_K3                              \n"

                
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                
                
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N5_02_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"
                
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N5_02_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                


                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x1], #16                        \n"
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   ldr     q7, [x3], #16                   \n"


                "   ld1     {v3.2s}, [x1], #8                   \n"


                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"



    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"


                "   ldr     q6, [x3], #16                   \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"



                "   ldr     q7, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"


                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x1], #16                   \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   ld1     {v3.2s}, [x1], #8                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N5_02_ADD_C       \n"

                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                "   st1     {v16.s}[0], [x4]        \n"
                "   st1     {v16.s}[1], [x10]        \n"
                "   st1     {v16.s}[2], [x11]        \n"
                "   st1     {v16.s}[3], [x12]        \n"
                
                "   st1     {v20.s}[0], [x13]        \n"
                "   st1     {v20.s}[1], [x14]        \n"
                "   st1     {v20.s}[2], [x15]        \n"
                "   st1     {v20.s}[3], [x16]        \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N5_02_END       \n"

                    "   ldr     q0, [x4]                        \n"
                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   ldr     q1, [x10]                       \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                    

                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"

                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4], #16                        \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"

                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10], #16                       \n"
                    "   str     q16, [x28], #16         \n"
                    "   str     q20, [x28], #16         \n"
                    
                    
                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11], #16                      \n"
                    "   str     q11, [x12], #16                      \n"

                    "   ldr     q0, [x13]                        \n"
                    "   ldr     q8, [x29], #16                  \n"
                    
                    "   ldr     q1, [x14]                       \n"
                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    "   ldr     q2, [x15]                       \n"
                    "   ldr     q3, [x16]                       \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    
                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q11, [x29], #16                 \n"
                    "   fadd    v10.4s, v10.4s, v2.4s             \n"
                    
                    "   str     q8, [x13], #16                        \n"
                    "   str     q9, [x14], #16                       \n"
                    
                    "   fadd    v11.4s, v11.4s, v3.4s             \n"
                    "   str     q10, [x15], #16                      \n"
                    "   str     q11, [x16], #16                      \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   ld1     {v0.s}[0], [x4]                   \n"
                    "   ld1     {v0.s}[1], [x10]                   \n"
                    "   ld1     {v0.s}[2], [x11]                   \n"
                    "   ld1     {v0.s}[3], [x12]                   \n"

                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    
                    
                    "   ldr     q9, [x29], #16                  \n"
                    "   ld1     {v1.s}[0], [x13]                   \n"
                    "   ld1     {v1.s}[1], [x14]                   \n"
                    "   ld1     {v1.s}[2], [x15]                   \n"
                    "   ld1     {v1.s}[3], [x16]                   \n"
                    
                    "   st1     {v8.s}[0], [x4]                  \n"
                    "   st1     {v8.s}[1], [x10]                  \n"
                    "   st1     {v8.s}[2], [x11]                  \n"
                    "   st1     {v8.s}[3], [x12]                  \n"
                    
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   st1     {v9.s}[0], [x13]                  \n"
                    "   st1     {v9.s}[1], [x14]                  \n"
                    "   st1     {v9.s}[2], [x15]                  \n"
                    "   st1     {v9.s}[3], [x16]                  \n"

                ".endm                                          \n" 

//
    

    
    "M8N5_02_ENTRANCE:                                                       \n"


    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    "   mov x29, sp                            \n"
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub x29, x29, #160                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N5_02_BEGIN                     \n"
    "   mov x28, x29                            \n"
    
    
    "   b M8N5_02_LOOP                               \n"
    
    "M8N5_02_MAIN_K:                                  \n"
        "   uKERNEL_M8N5_02_K3                     \n"

    "M8N5_02_LOOP:                                  \n"
    "   uKERNEL_M8N5_02_K4                                 \n"
    "   uKERNEL_M8N5_02_K5                                 \n"
    "   uKERNEL_M8N5_02_K6                                 \n"
    "   uKERNEL_M8N5_02_K7                                 \n"

    "   beq     M8N5_02_END_K                        \n"

    "   uKERNEL_M8N5_02_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N5_02_MAIN_K                       \n" 




    "M8N5_02_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N5_02                     \n"

    //ic != 0
    "   uKERNEL_M8N5_02_END                    \n"

    "   b    M8N5_02_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N5_02:                               \n"
    "   M8N5_02_ADD_C                                   \n"
    
    
    "M8N5_02_END:                                       \n"
    :

    :


        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N4_02_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N4_02_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"

            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"


            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"



            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_K3                              \n"

                
                

                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                
                "   ldr     q7, [x3], #16                   \n"
                
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N4_02_K4                              \n"

                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"
                
                "   ld1     {v4.2s}, [x1], #8                   \n"

                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N4_02_K5                              \n"
    


                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q7, [x3], #16                   \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   ldr     q3, [x1], #16                   \n"


                
                //update img row 1 col 2

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_K6                              \n"

                
                
                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"
                "   ldr     q1, [x3], #16                   \n"


                "   ld1     {v4.2s}, [x1], #8                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_K7                              \n"


                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_K8                              \n"
                "   add     x3, x3, #96         \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"




                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N4_02_ADD_C       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]      \n"

                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                    "   add     sp, sp, #128                    \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

                ".endm              \n"
                
                ".macro uKERNEL_M8N4_02_END       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"


                    "   ldr     q8, [x4]                   \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                    "   ldr     q9, [x10]                  \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                    "   ldr     q10, [x11]                 \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                    "   ldr     q11, [x12]                 \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4]                   \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x11]                 \n"
                    "   str     q11, [x12]                 \n"




                    "   ldr     q8, [x13]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                    "   ldr     q9, [x14]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                    "   ldr     q10, [x15]                 \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                    "   ldr     q11, [x16]                 \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x13]                  \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x14]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x15]                 \n"
                    "   str     q11, [x16]                 \n"


                ".endm                                          \n" 

//
    

    
    "M8N4_02_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #128                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N4_02_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N4_02_LOOP                               \n"
    
    "M8N4_02_MAIN_K:                                  \n"
        "   uKERNEL_M8N4_02_K3                     \n"

    "M8N4_02_LOOP:                                  \n"
    "   uKERNEL_M8N4_02_K4                                 \n"
    "   uKERNEL_M8N4_02_K5                                 \n"
    "   uKERNEL_M8N4_02_K6                                 \n"
    "   uKERNEL_M8N4_02_K7                                 \n"

    "   beq     M8N4_02_END_K                        \n"

    "   uKERNEL_M8N4_02_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N4_02_MAIN_K                       \n" 




    "M8N4_02_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N4_02                     \n"

    //ic != 0
    "   uKERNEL_M8N4_02_END                    \n"

    "   b    M8N4_02_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N4_02:                               \n"
    "   M8N4_02_ADD_C                                   \n"
    
    
    "M8N4_02_END:                                       \n"
    :

    :
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N2_02_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N2_02_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"

            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"



            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_K3                              \n"

                
                

                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"

                
                "   ldr     q7, [x3], #16                   \n"
                
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N2_02_K4                              \n"

                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N2_02_K5                              \n"
    
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"



                //update the kernel
                "   ldr     q7, [x3], #16                   \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   ldr     q3, [x1], #16                   \n"


                
                //update img row 1 col 2

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_K6                              \n"

                
                
                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"
                
                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_K7                              \n"


                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_K8                              \n"
                "   add     x3, x3, #96         \n"


                //update kernel
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"



                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N2_02_ADD_C       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"


                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    
                    "   st2     {v16.s, v17.s}[0], [x4]      \n"
                    "   st2     {v16.s, v17.s}[1], [x10]      \n"
                    "   st2     {v16.s, v17.s}[2], [x11]      \n"
                    "   st2     {v16.s, v17.s}[3], [x12]      \n"


                    "   add     sp, sp, #64                    \n"

                    "   st2     {v20.s, v21.s}[0], [x13]      \n"
                    "   st2     {v20.s, v21.s}[1], [x14]      \n"
                    "   st2     {v20.s, v21.s}[2], [x15]      \n"
                    "   st2     {v20.s, v21.s}[3], [x16]      \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N2_02_END       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"

                "   st2     {v16.s, v17.s}[0], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[1], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[2], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[3], [x29], #8       \n"

                "   st2     {v20.s, v21.s}[0], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x29], #8     \n"
                
                "   sub     x29, x29, #64                   \n"
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v1.2s}, [x10]                       \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"


                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"

                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v0.2s}, [x12]                       \n"
                
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"


                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"


                "   ld1     {v8.2s}, [x13]                       \n"
                "   ld1     {v9.2s}, [x14]                       \n"
                "   ld1     {v10.2s}, [x15]                      \n"
                "   ld1     {v11.2s}, [x16]                      \n"



                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   st1     {v8.2s}, [x13]                       \n"


                "   ld1     {v1.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   st1     {v9.2s}, [x14]                       \n"

                "   ld1     {v2.2s}, [x29], #8                  \n"
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   st1     {v10.2s}, [x15]                      \n"

                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"
                "   st1     {v11.2s}, [x16]                      \n"
                "   add     sp, sp, #64                    \n"


                ".endm                                          \n" 

//
    

    
    "M8N2_02_ENTRANCE:                                                       \n"


    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #64                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N2_02_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N2_02_LOOP                               \n"
    
    "M8N2_02_MAIN_K:                                  \n"
        "   uKERNEL_M8N2_02_K3                     \n"

    "M8N2_02_LOOP:                                  \n"
    "   uKERNEL_M8N2_02_K4                                 \n"
    "   uKERNEL_M8N2_02_K5                                 \n"
    "   uKERNEL_M8N2_02_K6                                 \n"
    "   uKERNEL_M8N2_02_K7                                 \n"

    "   beq     M8N2_02_END_K                        \n"

    "   uKERNEL_M8N2_02_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N2_02_MAIN_K                       \n" 




    "M8N2_02_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N2_02                     \n"

    //ic != 0
    "   uKERNEL_M8N2_02_END                    \n"

    "   b    M8N2_02_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N2_02:                               \n"
    "   M8N2_02_ADD_C                                   \n"
    
    
    "M8N2_02_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N12_10_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_10_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v3.s[3]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[0]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[1]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[2]          \n"
            

            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            
            "   fmul    v28.4s, v1.4s, v3.s[3]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[2]          \n"

            "   ldr     q0, [x3], #16                   \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"

    ".endm                                                  \n"
    
//
    ".macro uKERNEL_M8N12_10_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 



                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 


                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_K1                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                
                
                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_K2                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_10_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_10_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_10_K5                              \n"
                "   ld1     {v5.2s}, [x1], #8               \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
   
                
                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_10_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[1]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_10_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_10_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_10_LOOP                               \n"
    
    "M8N12_10_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_10_K0                     \n"

    "M8N12_10_LOOP:                                  \n"
    "   uKERNEL_M8N12_10_K1                                 \n"
    "   uKERNEL_M8N12_10_K2                                 \n"
    "   uKERNEL_M8N12_10_K3                                 \n"
    "   uKERNEL_M8N12_10_K4                                 \n"
    "   uKERNEL_M8N12_10_K5                                 \n"
    "   uKERNEL_M8N12_10_K6                                 \n"
    "   uKERNEL_M8N12_10_K7                                 \n"

    "   beq     M8N12_10_END_K                        \n"

    "   uKERNEL_M8N12_10_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_10_MAIN_K                       \n" 




    "M8N12_10_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_10                     \n"

    //ic != 0
    "   uKERNEL_M8N12_10_END                    \n"

    "   b    M8N12_10_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_10:                               \n"
    "   M8N12_10_ADD_C                                   \n"
    
    
    "M8N12_10_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N12_11_p1_s1( float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_11_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            
            "   add     x10, x4, x6                     \n"

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[2]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[3]          \n"
            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"

            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[2]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[3]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K0                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K1                              \n"
            "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
            "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
            "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
            "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
 
            //get the end two column of img
            "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
            "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
            "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
            "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
            
            //edge condition(这个地方可能会错，需要改成加法)
            "   ld1     {v5.2s}, [x1], #8               \n"
            
            "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
            "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
            
            "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
            "   fmla    v19.4s, v6.4s, v4.s[0]          \n"


            //update the kernel
            "   ldr     q0, [x3], #16                   \n"
            

            "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
            "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
            "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
            "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
            //update the kernel
            "   ldr     q1, [x3], #16                   \n"

            "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
            "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
            "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
            "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

            "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
            "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
            "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
            "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K2                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                //update the kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K3                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K4                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K5                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K6                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                //edge: row 2 col 2

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
            
                "   ld1     {v5.2s}, [x1], #8              \n"
                
                //corresponding to the add
    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K7                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"


                //update r2 to the next inch



                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                //update kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   prfm    PLDL1KEEP, [x3, #128]           \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare row 0 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare row 0 col 0
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                //prepare row 0 col 0
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro M8N12_11_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   add     sp, sp, #384                       \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"




                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[2]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_11_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_11_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_11_LOOP                               \n"
    
    "M8N12_11_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_11_K0                     \n"

    "M8N12_11_LOOP:                                  \n"
    "   uKERNEL_M8N12_11_K1                                 \n"
    "   uKERNEL_M8N12_11_K2                                 \n"
    "   uKERNEL_M8N12_11_K3                                 \n"
    "   uKERNEL_M8N12_11_K4                                 \n"
    "   uKERNEL_M8N12_11_K5                                 \n"
    "   uKERNEL_M8N12_11_K6                                 \n"
    "   uKERNEL_M8N12_11_K7                                 \n"

    "   beq     M8N12_11_END_K                        \n"

    "   uKERNEL_M8N12_11_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_11_MAIN_K                       \n" 




    "M8N12_11_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_11                     \n"

    //ic != 0
    "   uKERNEL_M8N12_11_END                    \n"

    "   b    M8N12_11_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_11:                               \n"
    "   M8N12_11_ADD_C                                   \n"
    
    
    "M8N12_11_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N10_12_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N10_12_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            

            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"

            
            "   add     x10, x4, x6                     \n"

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"


            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"

            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K0                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                
                //update kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"



                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K1                              \n"
            "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
            "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
            "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
            "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
            "   prfm    PLDL1KEEP, [x1, #64]            \n"            //预取img_1    
            //get the end two column of img
            "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
            "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
            "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
            "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

            
            "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
            "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
            
            "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
            "   fmla    v19.4s, v6.4s, v4.s[0]          \n"




            //update the kernel
            "   ldr     q0, [x3], #16                   \n"


            "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
            "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
            "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
            "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
            //update the kernel
            "   ldr     q1, [x3], #16                   \n"

            "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
            "   fmla    v25.4s, v6.4s, v4.s[2]          \n"


            "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
            "   fmla    v29.4s, v7.4s, v4.s[2]          \n"

    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K2                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                //update the kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"


                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"




                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"


                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K3                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"



                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K4                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   ldr     q7, [x3], #16                   \n"
                

                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"

                "   prfm    PLDL1KEEP, [x1, #64]            \n"            //预取img_2
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K5                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"



                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"



                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"


                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K6                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                //edge: row 2 col 2

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"

    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K7                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"


                //update r2 to the next inch
                "   prfm    PLDL1KEEP, [x1, #64]            \n"            //预取img_0



                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"


                //update kernel
                "   ldr     q7, [x3], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   prfm    PLDL1KEEP, [x3, #128]           \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"

                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro M8N10_12_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st2     {v24.s, v25.s}[0], [x4]    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st2     {v24.s, v25.s}[1], [x10]    \n" 
                
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st2     {v24.s, v25.s}[2], [x11]   \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st2     {v24.s, v25.s}[3], [x12]    \n"
                
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"


                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st2     {v28.s, v29.s}[0], [x13]    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st2     {v28.s, v29.s}[1], [x14]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st2     {v28.s, v29.s}[2], [x15]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st2     {v28.s, v29.s}[3], [x16]    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_END                             \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16    \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"



                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x28], #16  \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x28], #16  \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x28], #16  \n"
                
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x28], #16  \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x28], #16  \n"
                
                
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x28], #16  \n"

                "   st2     {v24.s, v25.s}[0], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[1], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[2], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[3], [x28], #8  \n"
                
                "   st2     {v28.s, v29.s}[0], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[1], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[2], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[3], [x28], #8  \n"


                        // 4*8
                        
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"
                        

                
                        // 8-------
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                       \n"
                "   str     q9, [x14], #16                      \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                     \n"
                "   str     q11, [x16], #16                     \n"



                
                // 8
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x10]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x12]                       \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"
                
                
                //
                "   ld1     {v0.2s}, [x13]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x14]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                "   ld1     {v2.2s}, [x15]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x16]                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                
                "   st1     {v8.2s}, [x13]                       \n"
                "   st1     {v9.2s}, [x14]                      \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x15]                     \n"
                "   st1     {v11.2s}, [x16]                     \n"
    
    ".endm                                                  \n"
    
    "M8N10_12_ENTRANCE:                                                       \n"
    "   mov x29, sp     \n"

    
    "   sub x29, x29, #320                        \n"
    
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    "   mov x28,x29     \n"
    "   ldr x8, %[ic]                          \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N10_12_BEGIN                     \n"

    
    
    "   b M8N10_12_LOOP                               \n"
    
    "M8N10_12_MAIN_K:                                  \n"
        "   uKERNEL_M8N10_12_K0                     \n"

    "M8N10_12_LOOP:                                  \n"
    "   uKERNEL_M8N10_12_K1                                 \n"
    "   uKERNEL_M8N10_12_K2                                 \n"
    "   uKERNEL_M8N10_12_K3                                 \n"
    "   uKERNEL_M8N10_12_K4                                 \n"
    "   uKERNEL_M8N10_12_K5                                 \n"
    "   uKERNEL_M8N10_12_K6                                 \n"
    "   uKERNEL_M8N10_12_K7                                 \n"

    "   beq     M8N10_12_END_K                        \n"

    "   uKERNEL_M8N10_12_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N10_12_MAIN_K                       \n" 




    "M8N10_12_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N10_12                     \n"

    //ic != 0
    "   uKERNEL_M8N10_12_END                    \n"

    "   b    M8N10_12_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N10_12:                               \n"
    "   M8N10_12_ADD_C                                   \n"
    
    
    "M8N10_12_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N8_12_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
            asm volatile(
                    ".macro uKERNEL_M8N8_12_BEGIN                      \n"
                        "   ldr     q0, [x3], #16                   \n"
                        "   ldr     q1, [x3], #16                   \n"
                        "   ldr     q2, [x1], #16                   \n"     //ldr q2 x1
                        
                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"     //p x1


                        "   add     x10, x4, x6                     \n"

                        "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmul    v11.4s, v0.4s, v2.s[3]          \n"

                        "   ldr     q3, [x1], #16                   \n"     //ldr q2 x1
                        "   add     x11, x10, x6                    \n"

                        "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmul    v15.4s, v1.4s, v2.s[3]          \n"

                        "   ldr     q6, [x3], #16                   \n"
                        "   add     x12, x11, x6                    \n"

                        "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
                        "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

                        "   ldr     q7, [x3], #16                   \n"
                        "   add     x13, x12, x6                    \n"

                        "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
                        "   fmul    v19.4s, v0.4s, v3.s[3]          \n"

                        "   add     x14, x13, x6                    \n"

                        "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
                        "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

                        "   add     x15, x14, x6                    \n"

                        "   prfm    PLDL2KEEP, [x4, #64]            \n"
                        "   prfm    PLDL2KEEP, [x10, #64]           \n"
                        "   prfm    PLDL2KEEP, [x11, #64]           \n"
                        "   prfm    PLDL2KEEP, [x12, #64]           \n"

                        "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
                        "   fmul    v23.4s, v1.4s, v3.s[3]          \n"

                        "   add     x16, x15, x6                    \n"

                        "   prfm    PLDL2KEEP, [x13, #64]           \n"
                        "   prfm    PLDL2KEEP, [x14, #64]           \n"
                        "   prfm    PLDL2KEEP, [x15, #64]           \n"
                        "   prfm    PLDL2KEEP, [x16, #64]           \n"


                        ".endm                                      \n"
                    
                    ".macro uKERNEL_M8N8_12_K0                         \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"
                        
                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                        "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                        "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N8_12_K1     \n"
                        "   ld1     {v4.2s}, [x1], #8                   \n" //ld1 q4 x1

                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                        "   ldr     q1, [x3], #16                   \n"
                        "   prfm    PLDL1KEEP, [x22, #64]            \n"            //p 22
                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                        "   fmla    v23.4s, v7.4s, v4.s[0]          \n"


                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_K2     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                        "   ldr     q2, [x1], #16                  \n"     //ldr q2 x1

                        "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                        "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[3]          \n"

                        "   fmla    v22.4s, v1.4s, v4.s[0]          \n"


                        "   ldr     q3, [x1], #16                   \n"     //ldr q3 x1

                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_K3     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                        "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                        

                        "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                        "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_K4     \n"

                        "   ld1     {v4.2s}, [x1], #8               \n"        //ld1 q4 x1

                        "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                        "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                        "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                        "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_K5     \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   ldr     q2, [x1], #16                        \n"       //ldr q2 23    

                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                        "   ldr     q3, [x1], #16                   \n"        //ldr q3 23 


                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_K6     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                        "   ldr     q7, [x3], #16                   \n"


                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                        "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v19.4s, v0.4s, v3.s[3]          \n"


                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                        "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v23.4s, v1.4s, v3.s[3]          \n"



                    ".endm              \n"    
                    
                    ".macro uKERNEL_M8N8_12_K7     \n"


                        "   ld1     {v4.2s}, [x1], #8                   \n"    //ld1 q4 23

                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"


                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                        "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                        "   ldr     q7, [x3], #16                   \n"
                    ".endm              \n"
                 
                    ".macro uKERNEL_M8N8_12_K8     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"         //p
                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        
                        "   ldr     q2, [x1], #16                        \n"        //ldr q2 x1
                        
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        
                        "   ldr     q3, [x1], #16                   \n"             //ldr q2 x1
                        
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                    ".endm              \n"
                    
                    ".macro M8N8_12_ADD_C       \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                        "   add     sp, sp, #256                    \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N8_12_END       \n"

                        "   ldr     q0, [x4]                        \n"
                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   ldr     q1, [x10]                       \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"


                        "   ldr     q8, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"


                        "   ldr     q9, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4]                        \n"


                        "   ldr     q10, [x29], #16                 \n"
                        "   ldr     q2, [x11]                       \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10]                       \n"

                        "   ldr     q11, [x29], #16                 \n"
                        "   ldr     q0, [x12]                       \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x11]                      \n"
                        "   str     q11, [x12]                      \n"




                        "   ldr     q8, [x13]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   ldr     q9, [x14]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   ldr     q10, [x15]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                        "   ldr     q11, [x16]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13]                       \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14]                       \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x15]                      \n"
                        "   str     q11, [x16]                      \n"




                        "   ldr     q8, [x4, #16]                   \n"
                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                        "   ldr     q9, [x10, #16]                  \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                        "   ldr     q10, [x11, #16]                 \n"
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                        "   ldr     q11, [x12, #16]                 \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4, #16]                   \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x11, #16]                 \n"
                        "   str     q11, [x12, #16]                 \n"




                        "   ldr     q8, [x13, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                        "   ldr     q9, [x14, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                        "   ldr     q10, [x15, #16]                 \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                        "   ldr     q11, [x16, #16]                 \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13, #16]                  \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x15, #16]                 \n"
                        "   str     q11, [x16, #16]                 \n"


                    ".endm                                          \n" 
            
            "M8N8_12_ENTRANCE:                                                       \n"

            "   ldr x1, %[img_pack]                     \n"
            "   ldr x3, %[kernal]                       \n"
            "   ldr x4, %[out]                          \n"
            "   ldr x7, %[ic_count]                     \n"
            "   ldr x6, %[stride_out_size]             \n"
            "   ldr x5, %[stride_in_size]             \n"
            
            "   prfm PLDL1KEEP, [x1, #128]              \n"
            "   prfm PLDL1KEEP, [x3, #256]              \n"
            
            "   ldr x8, %[ic]                          \n"
            
            "   sub sp, sp, #256                        \n"
            "   subs x7, x7, #1                         \n"
            
            "   uKERNEL_M8N8_12_BEGIN                     \n"
            "   mov x29, sp                            \n"
            
            
            "   b M8N8_12_LOOP                               \n"
            
            "M8N8_12_MAIN_K:                                  \n"
                "   uKERNEL_M8N8_12_K0                     \n"

            "M8N8_12_LOOP:                                  \n"
            "   uKERNEL_M8N8_12_K1                                 \n"
            "   uKERNEL_M8N8_12_K2                                 \n"
            "   uKERNEL_M8N8_12_K3                                 \n"
            "   uKERNEL_M8N8_12_K4                                 \n"
            "   uKERNEL_M8N8_12_K5                                 \n"
            "   uKERNEL_M8N8_12_K6                                 \n"
            "   uKERNEL_M8N8_12_K7                                 \n"

            "   beq     M8N8_12_END_K                        \n"

            "   uKERNEL_M8N8_12_K8                                 \n"

            "   subs    x7, x7, #1                 \n"
            "   b       M8N8_12_MAIN_K                       \n" 




            "M8N8_12_END_K:                                     \n"
            //ic = 0, store
            "   cmp     x8, #0                          \n"
            "   beq     END_uKERNEL_M8N8_12                     \n"

            //ic != 0
            "   uKERNEL_M8N8_12_END                    \n"

            "   b    M8N8_12_END                             \n"
            
            //ic = 0, add
            "END_uKERNEL_M8N8_12:                               \n"
            "   M8N8_12_ADD_C                                   \n"
            
            
            "M8N8_12_END:                                       \n"
            :

            :

                [img_pack]                    "m"     (img_pack),
                [kernal]                    "m"     (kernal),
                [out]                       "m"     (out),
                [ic_count]                  "m"     (ic_count),
                [ic]                        "m"     (ic),
                [stride_out_size]           "m"     (stride_out_size),
                [stride_in_size]            "m"     (stride_in_size)
                
            :
                "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
                "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
                "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
                "x26", "x27", "x28","x29","x30",
                "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
                "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
                "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
                "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
            );
            
            
}


void direct_3x3_M8N7_12_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N7_12_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"

            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            "   add     x14, x13, x6           \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   add     x15, x14, x6          \n"

            "   ldr     q0, [x3], #16                   \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            "   add     x16, x15, x6          \n"
            "   ldr     q1, [x3], #16                   \n"

    ".endm                                                  \n"
    
//
    ".macro uKERNEL_M8N7_12_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"



                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 


                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"


                
                "   ldr     q1, [x3], #16                   \n"
                
                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_K1                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

 

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"




                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_K2                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                "   ldr     q2, [x1], #16                      \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"


                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                      \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_12_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"


                "   ldr     q6, [x3], #16                   \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"



    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_12_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"



    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N7_12_K5                              \n"

    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                "   add     x22, x22, x5                    \n"

                "   ldr     q2, [x1], #16                      \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                //update img row 1 col 1
                "   ldr     q3, [x1], #16                      \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"



    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"
                


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                      \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                      \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    

    
    ".macro M8N7_12_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                
                
                "   st3     {v16.s, v17.s, v18.s}[0], [x4]    \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x10]    \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x11]    \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x12]    \n"
                

                

                "   st3     {v20.s, v21.s, v22.s}[0], [x13]   \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x14]   \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x15]   \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x16]   \n"

                


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_END                             \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16 \n"
                /*
                "   st3     {v16.s, v17.s, v18.s}[0], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x28], #12     \n"
                
                "   st3     {v20.s, v21.s, v22.s}[0], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x28], #12     \n"
                */
                "   st2     {v16.s, v17.s}[0], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[1], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[2], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[3], [x28], #8     \n"
                
                "   st2     {v20.s, v21.s}[0], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x28], #8     \n"
                
                "   st1     {v18.s}[0], [x28], #4        \n"
                "   st1     {v18.s}[1], [x28], #4        \n"
                "   st1     {v18.s}[2], [x28], #4        \n"
                "   st1     {v18.s}[3], [x28], #4        \n"
                
                "   st1     {v22.s}[0], [x28], #4        \n"
                "   st1     {v22.s}[1], [x28], #4        \n"
                "   st1     {v22.s}[2], [x28], #4        \n"
                "   st1     {v22.s}[3], [x28], #4        \n"
                
                
                
                //4
                "   ldr     q0, [x4]                   \n"
                "   ldr     q1, [x10]                   \n"
                "   ldr     q2, [x11]                   \n"
                "   ldr     q3, [x12]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"

                //4
                "   ldr     q0, [x13]                   \n"
                "   ldr     q1, [x14]                   \n"
                "   ldr     q2, [x15]                   \n"
                "   ldr     q3, [x16]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"

                //2
                "   ld1     {v0.2s}, [x4]                   \n"
                "   ld1     {v1.2s}, [x10]                   \n"
                "   ld1     {v2.2s}, [x11]                   \n"
                "   ld1     {v3.2s}, [x12]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x4], #8                   \n"
                "   st1     {v9.2s}, [x10], #8                   \n"
                "   st1     {v10.2s}, [x11], #8                   \n"
                "   st1     {v11.2s}, [x12], #8                   \n"

                 //2
                "   ld1     {v0.2s}, [x13]                   \n"
                "   ld1     {v1.2s}, [x14]                   \n"
                "   ld1     {v2.2s}, [x15]                   \n"
                "   ld1     {v3.2s}, [x16]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x13], #8                   \n"
                "   st1     {v9.2s}, [x14], #8                   \n"
                "   st1     {v10.2s}, [x15], #8                   \n"
                "   st1     {v11.2s}, [x16], #8                   \n"
                
                //1
                
                "   ld1     {v0.s}[0], [x4]                   \n"
                "   ld1     {v0.s}[1], [x10]                   \n"
                "   ld1     {v0.s}[2], [x11]                   \n"
                "   ld1     {v0.s}[3], [x12]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x4]                  \n"
                "   st1     {v8.s}[1], [x10]                  \n"
                "   st1     {v8.s}[2], [x11]                  \n"
                "   st1     {v8.s}[3], [x12]                  \n"

                //1
                
                "   ld1     {v0.s}[0], [x13]                   \n"
                "   ld1     {v0.s}[1], [x14]                   \n"
                "   ld1     {v0.s}[2], [x15]                   \n"
                "   ld1     {v0.s}[3], [x16]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x13]                  \n"
                "   st1     {v8.s}[1], [x14]                  \n"
                "   st1     {v8.s}[2], [x15]                  \n"
                "   st1     {v8.s}[3], [x16]                  \n"
                
                
    
    ".endm                                                  \n"
    
    "M8N7_12_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x29, sp                            \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N7_12_BEGIN                     \n"

    "   sub x29, x29, #224                        \n"
    
    "   mov x28, x29                            \n"
    
    "   b M8N7_12_LOOP                               \n"
    
    "M8N7_12_MAIN_K:                                  \n"
        "   uKERNEL_M8N7_12_K0                     \n"

    "M8N7_12_LOOP:                                  \n"
    "   uKERNEL_M8N7_12_K1                                 \n"
    "   uKERNEL_M8N7_12_K2                                 \n"
    "   uKERNEL_M8N7_12_K3                                 \n"
    "   uKERNEL_M8N7_12_K4                                 \n"
    "   uKERNEL_M8N7_12_K5                                 \n"
    "   uKERNEL_M8N7_12_K6                                 \n"
    "   uKERNEL_M8N7_12_K7                                 \n"

    "   beq     M8N7_12_END_K                        \n"

    "   uKERNEL_M8N7_12_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N7_12_MAIN_K                       \n" 




    "M8N7_12_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N7_12                     \n"

    //ic != 0
    "   uKERNEL_M8N7_12_END                    \n"

    "   b    M8N7_12_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N7_12:                               \n"
    "   M8N7_12_ADD_C                                   \n"
    
    
    "M8N7_12_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N5_12_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
            asm volatile(
                    ".macro uKERNEL_M8N5_12_BEGIN                      \n"
                        "   ldr     q0, [x3], #16                   \n"
                        "   ldr     q1, [x3], #16                   \n"
                        "   ldr     q2, [x1], #16                   \n"     //ldr q2 x1
                        
                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"     //p x1


                        "   add     x10, x4, x6                     \n"

                        "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmul    v11.4s, v0.4s, v2.s[3]          \n"



                        "   ld1     {v3.2s}, [x1], #8                   \n"
                        "   add     x11, x10, x6                    \n"

                        "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmul    v15.4s, v1.4s, v2.s[3]          \n"



                        "   ldr     q6, [x3], #16                   \n"
                        "   add     x12, x11, x6                    \n"
                        "   fmul    v16.4s, v0.4s, v3.s[0]          \n"

                        "   ldr     q7, [x3], #16                   \n"
                        "   add     x13, x12, x6                    \n"


                        "   add     x14, x13, x6                    \n"

                        "   fmul    v20.4s, v1.4s, v3.s[0]          \n"


                        "   add     x15, x14, x6                    \n"

                        "   prfm    PLDL2KEEP, [x4, #64]            \n"
                        "   prfm    PLDL2KEEP, [x10, #64]           \n"
                        "   prfm    PLDL2KEEP, [x11, #64]           \n"
                        "   prfm    PLDL2KEEP, [x12, #64]           \n"


                        "   add     x16, x15, x6                    \n"

                        "   prfm    PLDL2KEEP, [x13, #64]           \n"
                        "   prfm    PLDL2KEEP, [x14, #64]           \n"
                        "   prfm    PLDL2KEEP, [x15, #64]           \n"
                        "   prfm    PLDL2KEEP, [x16, #64]           \n"


                        ".endm                                      \n"
                    
                    ".macro uKERNEL_M8N5_12_K0                         \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"
                        
                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"


                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"


                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N5_12_K1     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
 
                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                        "   ldr     q1, [x3], #16                   \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"            //p 22
                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"


                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"



                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_K2     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                        
                        "   ldr     q2, [x1], #16                  \n"     //ldr q2 x1
                        
                        "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                        "   ldr     q7, [x3], #16                   \n"

                        "   ld1     {v3.2s}, [x1], #8                   \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_K3     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v6.4s, v2.s[3]          \n"


                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[0]          \n"


                        

                        "   fmla    v20.4s, v7.4s, v3.s[0]          \n"


                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_K4     \n"


                        "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                        "   ldr     q6, [x3], #16                   \n"


                        "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[1]          \n"


                        "   fmla    v20.4s, v1.4s, v3.s[1]          \n"


                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_K5     \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        
                        "   ldr     q2, [x1], #16                        \n"  
                        
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   ld1     {v3.2s}, [x1], #8                   \n"


                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_K6     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"


                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                        "   ldr     q7, [x3], #16                   \n"


                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"



                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"




                    ".endm              \n"    
                    
                    ".macro uKERNEL_M8N5_12_K7     \n"



                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"




                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"


                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"


                        "   ldr     q7, [x3], #16                   \n"
                    ".endm              \n"
                 
                    ".macro uKERNEL_M8N5_12_K8     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                        "   prfm    PLDL1KEEP, [x1, #64]            \n"         //p
                        "   ldr     q0, [x3], #16                   \n"




                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        
                        "   ldr     q2, [x1], #16                        \n"        //ldr q2 x1
                        
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   ld1     {v3.2s}, [x1], #8                   \n"
                        



                    ".endm              \n"
                    
                    ".macro M8N5_12_ADD_C       \n"

                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                "   st1     {v16.s}[0], [x4]        \n"
                "   st1     {v16.s}[1], [x10]        \n"
                "   st1     {v16.s}[2], [x11]        \n"
                "   st1     {v16.s}[3], [x12]        \n"
                
                "   st1     {v20.s}[0], [x13]        \n"
                "   st1     {v20.s}[1], [x14]        \n"
                "   st1     {v20.s}[2], [x15]        \n"
                "   st1     {v20.s}[3], [x16]        \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N5_12_END       \n"

                    "   ldr     q0, [x4]                        \n"
                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   ldr     q1, [x10]                       \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                    

                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"

                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4], #16                        \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"

                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10], #16                       \n"
                    "   str     q16, [x28], #16     \n"
                    "   str     q20, [x28], #16     \n"
                    
                    
                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11], #16                      \n"
                    "   str     q11, [x12], #16                      \n"

                    "   ldr     q0, [x13]                        \n"
                    "   ldr     q8, [x29], #16                  \n"
                    
                    "   ldr     q1, [x14]                       \n"
                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    "   ldr     q2, [x15]                       \n"
                    "   ldr     q3, [x16]                       \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    
                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q11, [x29], #16                 \n"
                    "   fadd    v10.4s, v10.4s, v2.4s             \n"
                    
                    "   str     q8, [x13], #16                        \n"
                    "   str     q9, [x14], #16                       \n"
                    
                    "   fadd    v11.4s, v11.4s, v3.4s             \n"
                    "   str     q10, [x15], #16                      \n"
                    "   str     q11, [x16], #16                      \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   ld1     {v0.s}[0], [x4]                   \n"
                    "   ld1     {v0.s}[1], [x10]                   \n"
                    "   ld1     {v0.s}[2], [x11]                   \n"
                    "   ld1     {v0.s}[3], [x12]                   \n"

                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    
                    
                    "   ldr     q9, [x29], #16                  \n"
                    "   ld1     {v1.s}[0], [x13]                   \n"
                    "   ld1     {v1.s}[1], [x14]                   \n"
                    "   ld1     {v1.s}[2], [x15]                   \n"
                    "   ld1     {v1.s}[3], [x16]                   \n"
                    
                    "   st1     {v8.s}[0], [x4]                  \n"
                    "   st1     {v8.s}[1], [x10]                  \n"
                    "   st1     {v8.s}[2], [x11]                  \n"
                    "   st1     {v8.s}[3], [x12]                  \n"
                    
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   st1     {v9.s}[0], [x13]                  \n"
                    "   st1     {v9.s}[1], [x14]                  \n"
                    "   st1     {v9.s}[2], [x15]                  \n"
                    "   st1     {v9.s}[3], [x16]                  \n"


                    ".endm                                          \n" 
            
            "M8N5_12_ENTRANCE:                                                       \n"

            "   ldr x1, %[img_pack]                     \n"
            "   ldr x3, %[kernal]                       \n"
            "   ldr x4, %[out]                          \n"
            "   ldr x7, %[ic_count]                     \n"
            "   ldr x6, %[stride_out_size]             \n"
            "   ldr x5, %[stride_in_size]             \n"
            "   mov x29, sp                            \n"
            "   prfm PLDL1KEEP, [x1, #128]              \n"
            "   prfm PLDL1KEEP, [x3, #256]              \n"
            
            "   ldr x8, %[ic]                          \n"
            
            "   sub x29, x29, #160                        \n"
            "   subs x7, x7, #1                         \n"
            
            "   uKERNEL_M8N5_12_BEGIN                     \n"
            "   mov x28, x29                            \n"
            
            
            "   b M8N5_12_LOOP                               \n"
            
            "M8N5_12_MAIN_K:                                  \n"
                "   uKERNEL_M8N5_12_K0                     \n"

            "M8N5_12_LOOP:                                  \n"
            "   uKERNEL_M8N5_12_K1                                 \n"
            "   uKERNEL_M8N5_12_K2                                 \n"
            "   uKERNEL_M8N5_12_K3                                 \n"
            "   uKERNEL_M8N5_12_K4                                 \n"
            "   uKERNEL_M8N5_12_K5                                 \n"
            "   uKERNEL_M8N5_12_K6                                 \n"
            "   uKERNEL_M8N5_12_K7                                 \n"

            "   beq     M8N5_12_END_K                        \n"

            "   uKERNEL_M8N5_12_K8                                 \n"

            "   subs    x7, x7, #1                 \n"
            "   b       M8N5_12_MAIN_K                       \n" 




            "M8N5_12_END_K:                                     \n"
            //ic = 0, store
            "   cmp     x8, #0                          \n"
            "   beq     END_uKERNEL_M8N5_12                     \n"

            //ic != 0
            "   uKERNEL_M8N5_12_END                    \n"

            "   b    M8N5_12_END                             \n"
            
            //ic = 0, add
            "END_uKERNEL_M8N5_12:                               \n"
            "   M8N5_12_ADD_C                                   \n"
            
            
            "M8N5_12_END:                                       \n"
            :

            :

                [img_pack]                    "m"     (img_pack),
                [kernal]                    "m"     (kernal),
                [out]                       "m"     (out),
                [ic_count]                  "m"     (ic_count),
                [ic]                        "m"     (ic),
                [stride_out_size]           "m"     (stride_out_size),
                [stride_in_size]            "m"     (stride_in_size)
                
            :
                "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
                "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
                "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
                "x26", "x27", "x28","x29","x30",
                "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
                "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
                "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
                "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
            );
            
            
}



void direct_3x3_M8N4_12_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
            ".macro uKERNEL_M8N4_12_BEGIN                      \n"
                "   ldr     q0, [x3], #16                   \n"
                "   ldr     q1, [x3], #16                   \n"

                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                "   prfm    PLDL1KEEP, [x1, #64]            \n"     //p x0


                "   add     x10, x4, x6                     \n"


                "   ldr     q3, [x1], #16                   \n"     //ldr q2 x0
                "   add     x11, x10, x6                    \n"

                "   ldr     q6, [x3], #16                   \n"
                "   add     x12, x11, x6                    \n"

                "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmul    v17.4s, v0.4s, v3.s[1]          \n"


                "   ldr     q7, [x3], #16                   \n"
                "   add     x13, x12, x6                    \n"

                "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmul    v19.4s, v0.4s, v3.s[3]          \n"

                "   add     x14, x13, x6                    \n"

                "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

                "   add     x15, x14, x6                    \n"

                "   prfm    PLDL2KEEP, [x4, #64]            \n"
                "   prfm    PLDL2KEEP, [x10, #64]           \n"
                "   prfm    PLDL2KEEP, [x11, #64]           \n"
                "   prfm    PLDL2KEEP, [x12, #64]           \n"

                "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmul    v23.4s, v1.4s, v3.s[3]          \n"

                "   add     x16, x15, x6                    \n"

                "   prfm    PLDL2KEEP, [x13, #64]           \n"
                "   prfm    PLDL2KEEP, [x14, #64]           \n"
                "   prfm    PLDL2KEEP, [x15, #64]           \n"
                "   prfm    PLDL2KEEP, [x16, #64]           \n"


                ".endm                                      \n"
            
            ".macro uKERNEL_M8N4_12_K0                         \n"



                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"



                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

            ".endm              \n"
            
            ".macro uKERNEL_M8N4_12_K1     \n"
                "   ld1     {v4.2s}, [x1], #8                   \n" //ld1 q4 x0

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"



            ".endm              \n"

            ".macro uKERNEL_M8N4_12_K2     \n"



                "   ldr     q6, [x3], #16                   \n"




                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"


                "   ldr     q3, [x1], #16                   \n"     //ldr q3 x22

            ".endm              \n"

            ".macro uKERNEL_M8N4_12_K3     \n"


                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

            ".endm              \n"

            ".macro uKERNEL_M8N4_12_K4     \n"

                "   ld1     {v4.2s}, [x1], #8               \n"        //ld1 q4 x22


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                


                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                "   prfm    PLDL1KEEP, [x23, #64]            \n"

            ".endm              \n"

            ".macro uKERNEL_M8N4_12_K5     \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                "   ldr     q3, [x1], #16                   \n"        //ldr q3 23 


            ".endm              \n"

            ".macro uKERNEL_M8N4_12_K6     \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"



            ".endm              \n"    
            
            ".macro uKERNEL_M8N4_12_K7     \n"


                "   ld1     {v4.2s}, [x1], #8                   \n"    //ld1 q4 23
                

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                
                "   ldr     q6, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   ldr     q7, [x3], #16                   \n"


            ".endm              \n"
         
            ".macro uKERNEL_M8N4_12_K8     \n"

                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   ldr     q1, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                
                "   ldr     q3, [x1], #16                   \n"             //ldr q2 x0
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


            ".endm              \n"
            
            ".macro M8N4_12_ADD_C       \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]      \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                "   add     sp, sp, #128                    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

            ".endm              \n"
            
            ".macro uKERNEL_M8N4_12_END       \n"
                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                "   ldr     q8, [x4]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11]                 \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4]                   \n"

                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10]                  \n"

                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11]                 \n"
                "   str     q11, [x12]                 \n"




                "   ldr     q8, [x13]                  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                "   ldr     q9, [x14]                  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                "   ldr     q10, [x15]                 \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                "   ldr     q11, [x16]                 \n"



                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                  \n"

                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                  \n"

                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15]                 \n"
                "   str     q11, [x16]                 \n"


            ".endm                                          \n" 
    
    "M8N4_12_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #128                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N4_12_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N4_12_LOOP                               \n"
    
    "M8N4_12_MAIN_K:                                  \n"
        "   uKERNEL_M8N4_12_K0                     \n"

    "M8N4_12_LOOP:                                  \n"
    "   uKERNEL_M8N4_12_K1                                 \n"
    "   uKERNEL_M8N4_12_K2                                 \n"
    "   uKERNEL_M8N4_12_K3                                 \n"
    "   uKERNEL_M8N4_12_K4                                 \n"
    "   uKERNEL_M8N4_12_K5                                 \n"
    "   uKERNEL_M8N4_12_K6                                 \n"
    "   uKERNEL_M8N4_12_K7                                 \n"

    "   beq     M8N4_12_END_K                        \n"

    "   uKERNEL_M8N4_12_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N4_12_MAIN_K                       \n" 




    "M8N4_12_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N4_12                     \n"

    //ic != 0
    "   uKERNEL_M8N4_12_END                    \n"

    "   b    M8N4_12_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N4_12:                               \n"
    "   M8N4_12_ADD_C                                   \n"
    
    
    "M8N4_12_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N2_12_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
            ".macro uKERNEL_M8N2_12_BEGIN                      \n"
                "   ldr     q0, [x3], #16                   \n"
                "   ldr     q1, [x3], #16                   \n"

                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                "   prfm    PLDL1KEEP, [x0, #64]            \n"     //p x0


                "   add     x10, x4, x6                     \n"


                "   ldr     q3, [x1], #16                   \n"     //ldr q2 x0
                "   add     x11, x10, x6                    \n"

                "   ldr     q6, [x3], #16                   \n"
                "   add     x12, x11, x6                    \n"

                "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q7, [x3], #16                   \n"
                "   add     x13, x12, x6                    \n"


                "   add     x14, x13, x6                    \n"

                "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

                "   add     x15, x14, x6                    \n"

                "   prfm    PLDL2KEEP, [x4, #64]            \n"
                "   prfm    PLDL2KEEP, [x10, #64]           \n"
                "   prfm    PLDL2KEEP, [x11, #64]           \n"
                "   prfm    PLDL2KEEP, [x12, #64]           \n"


                "   add     x16, x15, x6                    \n"

                "   prfm    PLDL2KEEP, [x13, #64]           \n"
                "   prfm    PLDL2KEEP, [x14, #64]           \n"
                "   prfm    PLDL2KEEP, [x15, #64]           \n"
                "   prfm    PLDL2KEEP, [x16, #64]           \n"


                ".endm                                      \n"
            
            ".macro uKERNEL_M8N2_12_K0                         \n"



                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

            ".endm              \n"
            
            ".macro uKERNEL_M8N2_12_K1     \n"


                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                
                "   ldr     q1, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


            ".endm              \n"

            ".macro uKERNEL_M8N2_12_K2     \n"



                "   ldr     q6, [x3], #16                   \n"




                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   ldr     q3, [x1], #16                   \n"     //ldr q3 x22

            ".endm              \n"

            ".macro uKERNEL_M8N2_12_K3     \n"


                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"


                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"

            ".endm              \n"

            ".macro uKERNEL_M8N2_12_K4     \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


            ".endm              \n"

            ".macro uKERNEL_M8N2_12_K5     \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   ldr     q3, [x1], #16                   \n"        //ldr q3 23 


            ".endm              \n"

            ".macro uKERNEL_M8N2_12_K6     \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"




            ".endm              \n"    
            
            ".macro uKERNEL_M8N2_12_K7     \n"
                

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                
                "   ldr     q6, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                "   ldr     q7, [x3], #16                   \n"


            ".endm              \n"
         
            ".macro uKERNEL_M8N2_12_K8     \n"

                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"



                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   ldr     q1, [x3], #16                   \n"
                
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                
                "   ldr     q3, [x1], #16                   \n"             //ldr q2 x0
                



            ".endm              \n"
            
                ".macro M8N2_12_ADD_C       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"


                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    
                    "   st2     {v16.s, v17.s}[0], [x4]      \n"
                    "   st2     {v16.s, v17.s}[1], [x10]      \n"
                    "   st2     {v16.s, v17.s}[2], [x11]      \n"
                    "   st2     {v16.s, v17.s}[3], [x12]      \n"


                    "   add     sp, sp, #64                    \n"

                    "   st2     {v20.s, v21.s}[0], [x13]      \n"
                    "   st2     {v20.s, v21.s}[1], [x14]      \n"
                    "   st2     {v20.s, v21.s}[2], [x15]      \n"
                    "   st2     {v20.s, v21.s}[3], [x16]      \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N2_12_END       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"

                "   st2     {v16.s, v17.s}[0], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[1], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[2], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[3], [x29], #8       \n"

                "   st2     {v20.s, v21.s}[0], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x29], #8     \n"
                
                "   sub     x29, x29, #64                   \n"
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v1.2s}, [x10]                       \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"


                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"

                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v0.2s}, [x12]                       \n"
                
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"


                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"


                "   ld1     {v8.2s}, [x13]                       \n"
                "   ld1     {v9.2s}, [x14]                       \n"
                "   ld1     {v10.2s}, [x15]                      \n"
                "   ld1     {v11.2s}, [x16]                      \n"



                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   st1     {v8.2s}, [x13]                       \n"


                "   ld1     {v1.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   st1     {v9.2s}, [x14]                       \n"

                "   ld1     {v2.2s}, [x29], #8                  \n"
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   st1     {v10.2s}, [x15]                      \n"

                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"
                "   st1     {v11.2s}, [x16]                      \n"
                "   add     sp, sp, #64                    \n"


                ".endm                                          \n" 
    
    "M8N2_12_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #64                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N2_12_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N2_12_LOOP                               \n"
    
    "M8N2_12_MAIN_K:                                  \n"
        "   uKERNEL_M8N2_12_K0                     \n"

    "M8N2_12_LOOP:                                  \n"
    "   uKERNEL_M8N2_12_K1                                 \n"
    "   uKERNEL_M8N2_12_K2                                 \n"
    "   uKERNEL_M8N2_12_K3                                 \n"
    "   uKERNEL_M8N2_12_K4                                 \n"
    "   uKERNEL_M8N2_12_K5                                 \n"
    "   uKERNEL_M8N2_12_K6                                 \n"
    "   uKERNEL_M8N2_12_K7                                 \n"

    "   beq     M8N2_12_END_K                        \n"

    "   uKERNEL_M8N2_12_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N2_12_MAIN_K                       \n" 




    "M8N2_12_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N2_12                     \n"

    //ic != 0
    "   uKERNEL_M8N2_12_END                    \n"

    "   b    M8N2_12_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N2_12:                               \n"
    "   M8N2_12_ADD_C                                   \n"
    
    
    "M8N2_12_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}



void direct_3x3_M8N12_20_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_20_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"


            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v3.s[3]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[0]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[1]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[2]          \n"
            
            //update kernel

            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            
            "   fmul    v28.4s, v1.4s, v3.s[3]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[2]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"



                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_20_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                
                "   ldr     q7, [x3], #16                   \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_20_K2                              \n"
                "   ld1     {v5.2s}, [x1], #8               \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                

                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                
                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_K5                              \n"
    
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_20_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"

                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_20_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_20_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_20_LOOP                               \n"
    
    "M8N12_20_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_20_K0                     \n"

    "M8N12_20_LOOP:                                  \n"
    "   uKERNEL_M8N12_20_K1                                 \n"
    "   uKERNEL_M8N12_20_K2                                 \n"
    "   uKERNEL_M8N12_20_K3                                 \n"
    "   uKERNEL_M8N12_20_K4                                 \n"

    "   beq     M8N12_20_END_K                        \n"

    "   uKERNEL_M8N12_20_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_20_MAIN_K                       \n" 




    "M8N12_20_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_20                     \n"

    //ic != 0
    "   uKERNEL_M8N12_20_END                    \n"

    "   b    M8N12_20_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_20:                               \n"
    "   M8N12_20_ADD_C                                   \n"
    
    
    "M8N12_20_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N12_21_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_21_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[2]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[3]          \n"
            
            //update kernel

            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[2]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[3]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_21_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   ld1     {v5.2s}, [x1], #8               \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q7, [x3], #16                   \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_21_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                

                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                
                
                
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_21_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"

                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_21_ENTRANCE:                                                       \n"


    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_21_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_21_LOOP                               \n"
    
    "M8N12_21_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_21_K0                     \n"

    "M8N12_21_LOOP:                                  \n"
    "   uKERNEL_M8N12_21_K1                                 \n"
    "   uKERNEL_M8N12_21_K2                                 \n"
    "   uKERNEL_M8N12_21_K3                                 \n"
    "   uKERNEL_M8N12_21_K4                                 \n"

    "   beq     M8N12_21_END_K                        \n"

    "   uKERNEL_M8N12_21_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_21_MAIN_K                       \n" 




    "M8N12_21_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_21                     \n"

    //ic != 0
    "   uKERNEL_M8N12_21_END                    \n"

    "   b    M8N12_21_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_21:                               \n"
    "   M8N12_21_ADD_C                                   \n"
    
    
    "M8N12_21_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N10_22_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N10_22_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            

            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            



            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x1], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"


            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"



                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   ldr     q0, [x3], #16                   \n"
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                

                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N10_22_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"



                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N10_22_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                

                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"



                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"



                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"

                "   ldr     q4, [x1], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"


                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"



                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                
                
                
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"

                
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                
                "   ldr     q3, [x1], #16                   \n"
                
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                
                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"

                "   ldr     q0, [x3], #16                   \n"
                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   ldr     q4, [x1], #16                   \n"

                
                "   ldr     q1, [x3], #16                   \n"


    ".endm                                                  \n"
    

    
    ".macro M8N10_22_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"

                
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st2     {v24.s, v25.s}[0], [x4]    \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st2     {v24.s, v25.s}[1], [x10]    \n" 
                
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st2     {v24.s, v25.s}[2], [x11]   \n"
                
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st2     {v24.s, v25.s}[3], [x12]    \n"
                
                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"


                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st2     {v28.s, v29.s}[0], [x13]    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st2     {v28.s, v29.s}[1], [x14]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st2     {v28.s, v29.s}[2], [x15]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st2     {v28.s, v29.s}[3], [x16]    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16    \n"
                
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"



                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"


                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x28], #16  \n"
                
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x28], #16  \n"
                
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x28], #16  \n"
                
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x28], #16  \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x28], #16  \n"
                
                
                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x28], #16  \n"

                "   st2     {v24.s, v25.s}[0], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[1], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[2], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[3], [x28], #8  \n"
                
                "   st2     {v28.s, v29.s}[0], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[1], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[2], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[3], [x28], #8  \n"


                        // 4*8
                        
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"
                        

                
                        // 8-------
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                       \n"
                "   str     q9, [x14], #16                      \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                     \n"
                "   str     q11, [x16], #16                     \n"



                
                // 8
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x10]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x12]                       \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"
                
                
                //
                "   ld1     {v0.2s}, [x13]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x14]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                "   ld1     {v2.2s}, [x15]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x16]                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                
                "   st1     {v8.2s}, [x13]                       \n"
                "   st1     {v9.2s}, [x14]                      \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x15]                     \n"
                "   st1     {v11.2s}, [x16]                     \n"
                
    ".endm                                                  \n"
    
    "M8N10_22_ENTRANCE:                                                       \n"
    
    "   mov x29, sp     \n"

    "   sub x29, x29, #320                        \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x28,x29     \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N10_22_BEGIN                     \n"

    
    
    "   b M8N10_22_LOOP                               \n"
    
    "M8N10_22_MAIN_K:                                  \n"
        "   uKERNEL_M8N10_22_K0                     \n"

    "M8N10_22_LOOP:                                  \n"
    "   uKERNEL_M8N10_22_K1                                 \n"
    "   uKERNEL_M8N10_22_K2                                 \n"
    "   uKERNEL_M8N10_22_K3                                 \n"
    "   uKERNEL_M8N10_22_K4                                 \n"

    "   beq     M8N10_22_END_K                        \n"

    "   uKERNEL_M8N10_22_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N10_22_MAIN_K                       \n" 




    "M8N10_22_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N10_22                     \n"

    //ic != 0
    "   uKERNEL_M8N10_22_END                    \n"

    "   b    M8N10_22_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N10_22:                               \n"
    "   M8N10_22_ADD_C                                   \n"
    
    
    "M8N10_22_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N8_22_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N8_22_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x1], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                

                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N8_22_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                "   ld1     {v4.2s}, [x1], #8               \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N8_22_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                

                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"

                "   ldr     q3, [x1], #16                   \n"
                
                //update img row 1 col 1
                
                //update img row 1 col 2

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v4.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x1], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q0, [x3], #16                   \n"

                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
    ".macro M8N8_22_ADD_C                                   \n"
                        "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                        "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                        "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                        "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                        "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                        "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                        "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                        "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                        "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                        "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                        "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                        "   add     sp, sp, #256                    \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_END                             \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"



                
                
                        "   ldr     q0, [x4]                        \n"

                        "   ldr     q1, [x10]                       \n"


                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"



                        "   ldr     q8, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"


                        "   ldr     q9, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4]                        \n"


                        "   ldr     q10, [x29], #16                 \n"
                        "   ldr     q2, [x11]                       \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10]                       \n"

                        "   ldr     q11, [x29], #16                 \n"
                        "   ldr     q0, [x12]                       \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x11]                      \n"
                        "   str     q11, [x12]                      \n"




                        "   ldr     q8, [x13]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"

                        "   ldr     q9, [x14]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"

                        "   ldr     q10, [x15]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"

                        "   ldr     q11, [x16]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13]                       \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14]                       \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x15]                      \n"
                        "   str     q11, [x16]                      \n"




                        "   ldr     q8, [x4, #16]                   \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                        "   ldr     q9, [x10, #16]                  \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                        "   ldr     q10, [x11, #16]                 \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                        "   ldr     q11, [x12, #16]                 \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4, #16]                   \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x11, #16]                 \n"
                        "   str     q11, [x12, #16]                 \n"




                        "   ldr     q8, [x13, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                        "   ldr     q9, [x14, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                        "   ldr     q10, [x15, #16]                 \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                        "   ldr     q11, [x16, #16]                 \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13, #16]                  \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x15, #16]                 \n"
                        "   str     q11, [x16, #16]                 \n"
    
    ".endm                                                  \n"
    
    "M8N8_22_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #256                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N8_22_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N8_22_LOOP                               \n"
    
    "M8N8_22_MAIN_K:                                  \n"
        "   uKERNEL_M8N8_22_K0                     \n"

    "M8N8_22_LOOP:                                  \n"
    "   uKERNEL_M8N8_22_K1                                 \n"
    "   uKERNEL_M8N8_22_K2                                 \n"
    "   uKERNEL_M8N8_22_K3                                 \n"
    "   uKERNEL_M8N8_22_K4                                 \n"

    "   beq     M8N8_22_END_K                        \n"

    "   uKERNEL_M8N8_22_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N8_22_MAIN_K                       \n" 




    "M8N8_22_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N8_22                     \n"

    //ic != 0
    "   uKERNEL_M8N8_22_END                    \n"

    "   b    M8N8_22_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N8_22:                               \n"
    "   M8N8_22_ADD_C                                   \n"
    
    
    "M8N8_22_END:                                       \n"
    :

    :

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N7_22_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N7_22_BEGIN                             \n"

            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"

            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"

            "   ldr     q3, [x1], #16                      \n"


            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"

            "   add     x12, x11, x6           \n"

            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"

            
            //update kernel 

            "   add     x14, x13, x6           \n"


            "   add     x15, x14, x6          \n"

            
            //update kernel

            "   add     x16, x15, x6          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_22_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N7_22_K2                              \n"

    
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x1], #16                      \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"


                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                //update img row 1 col 1
                "   ldr     q3, [x1], #16                      \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_K5                              \n"
    
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                "   ldr     q2, [x1], #16                      \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                "   ldr     q3, [x1], #16                      \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q1, [x3], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N7_22_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"



                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                
                
                "   st3     {v16.s, v17.s, v18.s}[0], [x4]    \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x10]    \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x11]    \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x12]    \n"
                

                

                "   st3     {v20.s, v21.s, v22.s}[0], [x13]   \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x14]   \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x15]   \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x16]   \n"

                


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16 \n"
                /*
                "   st3     {v16.s, v17.s, v18.s}[0], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x28], #12     \n"
                
                "   st3     {v20.s, v21.s, v22.s}[0], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x28], #12     \n"
                */
                "   st2     {v16.s, v17.s}[0], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[1], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[2], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[3], [x28], #8     \n"
                
                "   st2     {v20.s, v21.s}[0], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x28], #8     \n"
                
                "   st1     {v18.s}[0], [x28], #4        \n"
                "   st1     {v18.s}[1], [x28], #4        \n"
                "   st1     {v18.s}[2], [x28], #4        \n"
                "   st1     {v18.s}[3], [x28], #4        \n"
                
                "   st1     {v22.s}[0], [x28], #4        \n"
                "   st1     {v22.s}[1], [x28], #4        \n"
                "   st1     {v22.s}[2], [x28], #4        \n"
                "   st1     {v22.s}[3], [x28], #4        \n"
                
                
                
                //4
                "   ldr     q0, [x4]                   \n"
                "   ldr     q1, [x10]                   \n"
                "   ldr     q2, [x11]                   \n"
                "   ldr     q3, [x12]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"

                //4
                "   ldr     q0, [x13]                   \n"
                "   ldr     q1, [x14]                   \n"
                "   ldr     q2, [x15]                   \n"
                "   ldr     q3, [x16]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"

                //2
                "   ld1     {v0.2s}, [x4]                   \n"
                "   ld1     {v1.2s}, [x10]                   \n"
                "   ld1     {v2.2s}, [x11]                   \n"
                "   ld1     {v3.2s}, [x12]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x4], #8                   \n"
                "   st1     {v9.2s}, [x10], #8                   \n"
                "   st1     {v10.2s}, [x11], #8                   \n"
                "   st1     {v11.2s}, [x12], #8                   \n"

                 //2
                "   ld1     {v0.2s}, [x13]                   \n"
                "   ld1     {v1.2s}, [x14]                   \n"
                "   ld1     {v2.2s}, [x15]                   \n"
                "   ld1     {v3.2s}, [x16]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x13], #8                   \n"
                "   st1     {v9.2s}, [x14], #8                   \n"
                "   st1     {v10.2s}, [x15], #8                   \n"
                "   st1     {v11.2s}, [x16], #8                   \n"
                
                //1
                
                "   ld1     {v0.s}[0], [x4]                   \n"
                "   ld1     {v0.s}[1], [x10]                   \n"
                "   ld1     {v0.s}[2], [x11]                   \n"
                "   ld1     {v0.s}[3], [x12]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x4]                  \n"
                "   st1     {v8.s}[1], [x10]                  \n"
                "   st1     {v8.s}[2], [x11]                  \n"
                "   st1     {v8.s}[3], [x12]                  \n"

                //1
                
                "   ld1     {v0.s}[0], [x13]                   \n"
                "   ld1     {v0.s}[1], [x14]                   \n"
                "   ld1     {v0.s}[2], [x15]                   \n"
                "   ld1     {v0.s}[3], [x16]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x13]                  \n"
                "   st1     {v8.s}[1], [x14]                  \n"
                "   st1     {v8.s}[2], [x15]                  \n"
                "   st1     {v8.s}[3], [x16]                  \n"
    
    ".endm                                                  \n"
    
    "M8N7_22_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x29, sp                            \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N7_22_BEGIN                     \n"
    
    "   sub x29, x29, #224                        \n"
    
    "   mov x28, x29                            \n"
    
    
    "   b M8N7_22_LOOP                               \n"
    
    "M8N7_22_MAIN_K:                                  \n"
        "   uKERNEL_M8N7_22_K0                     \n"

    "M8N7_22_LOOP:                                  \n"
    "   uKERNEL_M8N7_22_K1                                 \n"
    "   uKERNEL_M8N7_22_K2                                 \n"
    "   uKERNEL_M8N7_22_K3                                 \n"
    "   uKERNEL_M8N7_22_K4                                 \n"

    "   beq     M8N7_22_END_K                        \n"

    "   uKERNEL_M8N7_22_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N7_22_MAIN_K                       \n" 




    "M8N7_22_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N7_22                     \n"

    //ic != 0
    "   uKERNEL_M8N7_22_END                    \n"

    "   b    M8N7_22_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N7_22:                               \n"
    "   M8N7_22_ADD_C                                   \n"
    
    
    "M8N7_22_END:                                       \n"
    :

    :
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N5_22_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N5_22_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x1], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            "   ld1     {v3.2s}, [x1], #8                   \n"


            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"


            "   add     x11, x10, x6          \n"

            "   add     x12, x11, x6           \n"


            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"

            "   add     x13, x12, x6           \n"


            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"

                
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                
                
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N5_22_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                "   ldr     q6, [x3], #16                   \n"
                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N5_22_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                
                //update the kernel
                "   ldr     q1, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x1], #16                        \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"


                "   ld1     {v3.2s}, [x1], #8                   \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"



                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

 
                "   ldr     q0, [x3], #16                   \n"
                


                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"


                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q0, [x3], #16                   \n"
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x1], #16                   \n"
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                //prepare: row 2 col 1
                "   ld1     {v3.2s}, [x1], #8                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"


                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
    ".macro M8N5_22_ADD_C                                   \n"
                    "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                "   st1     {v16.s}[0], [x4]        \n"
                "   st1     {v16.s}[1], [x10]        \n"
                "   st1     {v16.s}[2], [x11]        \n"
                "   st1     {v16.s}[3], [x12]        \n"
                
                "   st1     {v20.s}[0], [x13]        \n"
                "   st1     {v20.s}[1], [x14]        \n"
                "   st1     {v20.s}[2], [x15]        \n"
                "   st1     {v20.s}[3], [x16]        \n"

    ".endm                                                  \n"
    
        ".macro uKERNEL_M8N5_22_END       \n"


                    "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"

                    "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                    "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                    "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"
                    "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                    "   ldr     q0, [x4]                        \n"
                    "   ldr     q1, [x10]                        \n"


                    

                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"

                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4], #16                        \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"

                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10], #16                       \n"
                    "   str     q16, [x28], #16     \n"
                    "   str     q20, [x28], #16     \n"
                    
                    
                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11], #16                      \n"
                    "   str     q11, [x12], #16                      \n"

                    "   ldr     q0, [x13]                        \n"
                    "   ldr     q8, [x29], #16                  \n"
                    
                    "   ldr     q1, [x14]                       \n"
                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    "   ldr     q2, [x15]                       \n"
                    "   ldr     q3, [x16]                       \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    
                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q11, [x29], #16                 \n"
                    "   fadd    v10.4s, v10.4s, v2.4s             \n"
                    
                    "   str     q8, [x13], #16                        \n"
                    "   str     q9, [x14], #16                       \n"
                    
                    "   fadd    v11.4s, v11.4s, v3.4s             \n"
                    "   str     q10, [x15], #16                      \n"
                    "   str     q11, [x16], #16                      \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   ld1     {v0.s}[0], [x4]                   \n"
                    "   ld1     {v0.s}[1], [x10]                   \n"
                    "   ld1     {v0.s}[2], [x11]                   \n"
                    "   ld1     {v0.s}[3], [x12]                   \n"

                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    
                    
                    "   ldr     q9, [x29], #16                  \n"
                    "   ld1     {v1.s}[0], [x13]                   \n"
                    "   ld1     {v1.s}[1], [x14]                   \n"
                    "   ld1     {v1.s}[2], [x15]                   \n"
                    "   ld1     {v1.s}[3], [x16]                   \n"
                    
                    "   st1     {v8.s}[0], [x4]                  \n"
                    "   st1     {v8.s}[1], [x10]                  \n"
                    "   st1     {v8.s}[2], [x11]                  \n"
                    "   st1     {v8.s}[3], [x12]                  \n"
                    
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   st1     {v9.s}[0], [x13]                  \n"
                    "   st1     {v9.s}[1], [x14]                  \n"
                    "   st1     {v9.s}[2], [x15]                  \n"
                    "   st1     {v9.s}[3], [x16]                  \n"
    
    ".endm                                                  \n"
    
    "M8N5_22_ENTRANCE:                                                       \n"


    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    "   mov x29, sp                            \n"
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub x29, x29, #160                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N5_22_BEGIN                     \n"
    "   mov x28, x29                            \n"
    
    
    "   b M8N5_22_LOOP                               \n"
    
    "M8N5_22_MAIN_K:                                  \n"
        "   uKERNEL_M8N5_22_K0                     \n"

    "M8N5_22_LOOP:                                  \n"
    "   uKERNEL_M8N5_22_K1                                 \n"
    "   uKERNEL_M8N5_22_K2                                 \n"
    "   uKERNEL_M8N5_22_K3                                 \n"
    "   uKERNEL_M8N5_22_K4                                 \n"

    "   beq     M8N5_22_END_K                        \n"

    "   uKERNEL_M8N5_22_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N5_22_MAIN_K                       \n" 




    "M8N5_22_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N5_22                     \n"

    //ic != 0
    "   uKERNEL_M8N5_22_END                    \n"

    "   b    M8N5_22_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N5_22:                               \n"
    "   M8N5_22_ADD_C                                   \n"
    
    
    "M8N5_22_END:                                       \n"
    :

    :


        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}



void direct_3x3_M8N4_22_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N4_22_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            

            
            //update img
            "   ldr     q3, [x1], #16                      \n"



            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"


            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_K0                              \n"




                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                

                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N4_22_K1                              \n"
    

                
                "   ld1     {v4.2s}, [x1], #8               \n"
                

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N4_22_K2                              \n"
    

                

                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    

                //update img row 1 col 0

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"

                "   ldr     q3, [x1], #16                   \n"
                
                //update img row 1 col 1
                
                //update img row 1 col 2

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_K3                              \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_K4                              \n"


                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2



                //edge :row 1 col 2
                "   ld1     {v4.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                
                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_K5                              \n"
                "   add     x3, x3, #96         \n"


                //prepare: row 2 col 0

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q0, [x3], #16                   \n"

                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
    ".macro M8N4_22_ADD_C                                   \n"


                        "   fmla    v16.4s, v0.4s, v3.s[2]          \n"

                        "   fmla    v17.4s, v0.4s, v3.s[3]          \n"

                        "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                        "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                        "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                        "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                        "   add     sp, sp, #128                    \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_END                             \n"
    



                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16    \n"

                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                        \n"

                "   ldr     q8, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"


                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4]                        \n"


                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q2, [x11]                       \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10]                       \n"

                "   ldr     q11, [x29], #16                 \n"
                "   ldr     q0, [x12]                       \n"
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"

                "   ldr     q8, [x13]                       \n"


                "   ldr     q9, [x14]                       \n"


                "   ldr     q10, [x15]                      \n"


                "   ldr     q11, [x16]                      \n"


                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"

                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"

                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"
    
    ".endm                                                  \n"
    
    "M8N4_22_ENTRANCE:                                                       \n"


    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #128                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N4_22_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N4_22_LOOP                               \n"
    
    "M8N4_22_MAIN_K:                                  \n"
        "   uKERNEL_M8N4_22_K0                     \n"

    "M8N4_22_LOOP:                                  \n"
    "   uKERNEL_M8N4_22_K1                                 \n"
    "   uKERNEL_M8N4_22_K2                                 \n"
    "   uKERNEL_M8N4_22_K3                                 \n"
    "   uKERNEL_M8N4_22_K4                                 \n"

    "   beq     M8N4_22_END_K                        \n"

    "   uKERNEL_M8N4_22_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N4_22_MAIN_K                       \n" 




    "M8N4_22_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N4_22                     \n"

    //ic != 0
    "   uKERNEL_M8N4_22_END                    \n"

    "   b    M8N4_22_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N4_22:                               \n"
    "   M8N4_22_ADD_C                                   \n"
    
    
    "M8N4_22_END:                                       \n"
    :

    :
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N2_22_p1_s1(float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N2_22_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            

            
            //update img
            "   ldr     q3, [x1], #16                      \n"



            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"


            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"


            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_K0                              \n"




                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"

                
                "   ldr     q0, [x3], #16                   \n"
                

                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N2_22_K1                              \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N2_22_K2                              \n"

                "   ldr     q0, [x3], #16                   \n"



                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"



                //update the kernel
                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"


                "   ldr     q3, [x1], #16                   \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_K3                              \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_K4                              \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_K5                              \n"
                "   add     x3, x3, #96         \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   ldr     q3, [x1], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q0, [x3], #16                   \n"
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
                ".macro M8N2_22_ADD_C       \n"


                    "   fmla    v16.4s, v0.4s, v3.s[2]          \n"


                    "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                    
                    "   st2     {v16.s, v17.s}[0], [x4]      \n"
                    "   st2     {v16.s, v17.s}[1], [x10]      \n"
                    "   st2     {v16.s, v17.s}[2], [x11]      \n"
                    "   st2     {v16.s, v17.s}[3], [x12]      \n"


                    "   add     sp, sp, #64                    \n"

                    "   st2     {v20.s, v21.s}[0], [x13]      \n"
                    "   st2     {v20.s, v21.s}[1], [x14]      \n"
                    "   st2     {v20.s, v21.s}[2], [x15]      \n"
                    "   st2     {v20.s, v21.s}[3], [x16]      \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N2_22_END       \n"


                    "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                    "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   st2     {v16.s, v17.s}[0], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[1], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[2], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[3], [x29], #8       \n"

                "   st2     {v20.s, v21.s}[0], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x29], #8     \n"
                
                "   sub     x29, x29, #64                   \n"
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v1.2s}, [x10]                       \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"


                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"

                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v0.2s}, [x12]                       \n"
                
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"


                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"


                "   ld1     {v8.2s}, [x13]                       \n"
                "   ld1     {v9.2s}, [x14]                       \n"
                "   ld1     {v10.2s}, [x15]                      \n"
                "   ld1     {v11.2s}, [x16]                      \n"



                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   st1     {v8.2s}, [x13]                       \n"


                "   ld1     {v1.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   st1     {v9.2s}, [x14]                       \n"

                "   ld1     {v2.2s}, [x29], #8                  \n"
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   st1     {v10.2s}, [x15]                      \n"

                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"
                "   st1     {v11.2s}, [x16]                      \n"
                "   add     sp, sp, #64                    \n"


                ".endm                                          \n" 
    
    "M8N2_22_ENTRANCE:                                                       \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x1, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #64                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N2_22_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N2_22_LOOP                               \n"
    
    "M8N2_22_MAIN_K:                                  \n"
        "   uKERNEL_M8N2_22_K0                     \n"

    "M8N2_22_LOOP:                                  \n"
    "   uKERNEL_M8N2_22_K1                                 \n"
    "   uKERNEL_M8N2_22_K2                                 \n"
    "   uKERNEL_M8N2_22_K3                                 \n"
    "   uKERNEL_M8N2_22_K4                                 \n"

    "   beq     M8N2_22_END_K                        \n"

    "   uKERNEL_M8N2_22_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N2_22_MAIN_K                       \n" 




    "M8N2_22_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N2_22                     \n"

    //ic != 0
    "   uKERNEL_M8N2_22_END                    \n"

    "   b    M8N2_22_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N2_22:                               \n"
    "   M8N2_22_ADD_C                                   \n"
    
    
    "M8N2_22_END:                                       \n"
    :

    :
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


//pack
void direct_3x3_M8N12_00_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_00_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            //"   fmul    v8.4s, v0.4s, #0           \n"
            //"   vmov q8, #0      \n"
            //"   fmov x17, #1  \n"
            /*
            "mov v12.s[0], w17            \n"
            "mov v12.s[1], w17            \n"
            "mov v12.s[2], w17            \n"
            "mov v12.s[3], w17            \n"
            */
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            
            /*
            "fmov v8.s[1], w17            \n"
            "fmov v8.s[2], w17            \n"
            "fmov v8.s[3], w17            \n"
            */
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   str     q2, [x1], #16                   \n"
            
            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"
            
            "   str     q3, [x1], #16                   \n"
            
            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"
            
            "   str     q4, [x1], #16                   \n"
            
            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v3.s[3]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[0]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[1]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[2]          \n"
            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            
            "   fmul    v28.4s, v1.4s, v3.s[3]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[2]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_PACK_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"
                
                "   str     q2, [x1], #16                   \n"
                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_00_PACK_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_00_PACK_K5                              \n"
                "   ld1     {v5.2s}, [x0], #8               \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                "   sub     x0, x0, #56                     \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
                
                "   st1     {v5.2s}, [x1], #8                   \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   str     q2, [x1], #16                   \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_PACK_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                "   str     q4, [x1], #16                   \n"

                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   sub     x22, x22, #56                   \n"             //22 sub

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   st1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                
                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_00_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_00_PACK_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[1]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_00_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add  x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_00_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_00_PACK_LOOP                               \n"
    
    "M8N12_00_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_00_PACK_K3                     \n"

    "M8N12_00_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N12_00_PACK_K4                                 \n"
    "   uKERNEL_M8N12_00_PACK_K5                                 \n"
    "   uKERNEL_M8N12_00_PACK_K6                                 \n"
    "   uKERNEL_M8N12_00_PACK_K7                                 \n"

    "   beq     M8N12_00_PACK_END_K                        \n"

    "   uKERNEL_M8N12_00_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_00_PACK_MAIN_K                       \n" 




    "M8N12_00_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_00_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N12_00_PACK_END                    \n"

    "   b    M8N12_00_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_00_PACK:                               \n"
    "   M8N12_00_PACK_ADD_C                                   \n"
    
    
    "M8N12_00_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N12_01_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_01_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            
            "   str     q2, [x1], #16                   \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            "   str     q3, [x1], #16                   \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   str     q4, [x1], #16                   \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[2]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[3]          \n"
            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            

            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[2]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[3]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_PACK_K3                              \n"


                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q2, [x1], #16                   \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_01_PACK_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                
                "   ld1     {v5.2s}, [x0], #8               \n"
                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                
                "   st1     {v5.2s}, [x1], #8                   \n"
                

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_01_PACK_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #56                     \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_PACK_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                "   sub     x22, x22, #56                   \n"             //22 sub

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   st1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                
                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_01_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   add     sp, sp, #384                       \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_01_PACK_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"




                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[2]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_01_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_01_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_01_PACK_LOOP                               \n"
    
    "M8N12_01_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_01_PACK_K3                     \n"

    "M8N12_01_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N12_01_PACK_K4                                 \n"
    "   uKERNEL_M8N12_01_PACK_K5                                 \n"
    "   uKERNEL_M8N12_01_PACK_K6                                 \n"
    "   uKERNEL_M8N12_01_PACK_K7                                 \n"

    "   beq     M8N12_01_PACK_END_K                        \n"

    "   uKERNEL_M8N12_01_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_01_PACK_MAIN_K                       \n" 




    "M8N12_01_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_01_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N12_01_PACK_END                    \n"

    "   b    M8N12_01_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_01_PACK:                               \n"
    "   M8N12_01_PACK_ADD_C                                   \n"
    
    
    "M8N12_01_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N10_02_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N10_02_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            
            "   str     q2, [x1], #16                   \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            "   str     q3, [x1], #16                   \n"

            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   str     q4, [x1], #16                   \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            

            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_PACK_K3                              \n"


                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q2, [x1], #16                   \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N10_02_PACK_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"


                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"

                

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N10_02_PACK_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #48                     \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"


                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"


                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"


                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_PACK_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                "   sub     x22, x22, #48                   \n"             //22 sub


                "   ldr     q7, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                
                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"

                
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"


                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"

                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N10_02_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st2     {v24.s, v25.s}[0], [x4]    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st2     {v24.s, v25.s}[1], [x10]    \n" 
                
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st2     {v24.s, v25.s}[2], [x11]   \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st2     {v24.s, v25.s}[3], [x12]    \n"
                
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"


                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st2     {v28.s, v29.s}[0], [x13]    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st2     {v28.s, v29.s}[1], [x14]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st2     {v28.s, v29.s}[2], [x15]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st2     {v28.s, v29.s}[3], [x16]    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_02_PACK_END                             \n"

    
                
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16    \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"



                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x28], #16  \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x28], #16  \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x28], #16  \n"
                
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x28], #16  \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x28], #16  \n"
                
                
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x28], #16  \n"

                "   st2     {v24.s, v25.s}[0], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[1], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[2], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[3], [x28], #8  \n"
                
                "   st2     {v28.s, v29.s}[0], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[1], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[2], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[3], [x28], #8  \n"


                        // 4*8
                        
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"
                        

                
                        // 8-------
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                       \n"
                "   str     q9, [x14], #16                      \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                     \n"
                "   str     q11, [x16], #16                     \n"



                
                // 8
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x10]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x12]                       \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"
                
                
                //
                "   ld1     {v0.2s}, [x13]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x14]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                "   ld1     {v2.2s}, [x15]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x16]                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                
                "   st1     {v8.2s}, [x13]                       \n"
                "   st1     {v9.2s}, [x14]                      \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x15]                     \n"
                "   st1     {v11.2s}, [x16]                     \n"
                
    
    ".endm                                                  \n"
    
    "M8N10_02_PACK_ENTRANCE:                                                       \n"
    "   mov x29, sp     \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   sub x29, x29, #320                        \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    "   mov x28,x29     \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N10_02_PACK_BEGIN                     \n"

    
    
    "   b M8N10_02_PACK_LOOP                               \n"
    
    "M8N10_02_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N10_02_PACK_K3                     \n"

    "M8N10_02_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N10_02_PACK_K4                                 \n"
    "   uKERNEL_M8N10_02_PACK_K5                                 \n"
    "   uKERNEL_M8N10_02_PACK_K6                                 \n"
    "   uKERNEL_M8N10_02_PACK_K7                                 \n"

    "   beq     M8N10_02_PACK_END_K                        \n"

    "   uKERNEL_M8N10_02_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N10_02_PACK_MAIN_K                       \n" 




    "M8N10_02_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N10_02_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N10_02_PACK_END                    \n"

    "   b    M8N10_02_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N10_02_PACK:                               \n"
    "   M8N10_02_PACK_ADD_C                                   \n"
    
    
    "M8N10_02_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N8_02_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N8_02_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   str     q2, [x1], #16                   \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"



            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_PACK_K3                              \n"

                
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                
                "   str     q2, [x1], #16                   \n"
                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                
                
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N8_02_PACK_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"
                
                "   ld1     {v4.2s}, [x0], #8                   \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"
                
                "   st1     {v4.2s}, [x1], #8                   \n"
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N8_02_PACK_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #40                     \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   ldr     q3, [x22], #16                   \n"


                
                //update img row 1 col 2

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_PACK_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                "   str     q3, [x1], #16                   \n"
                
                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   ld1     {v4.2s}, [x22], #8                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"
                "   st1     {v4.2s}, [x1], #8                   \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //edge :row 1 col 2

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                "   sub     x22, x22, #40                   \n"             //22 sub

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_02_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N8_02_PACK_ADD_C       \n"

                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                    "   add     sp, sp, #256                    \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

                ".endm              \n"
                
                ".macro uKERNEL_M8N8_02_PACK_END       \n"

                    "   ldr     q0, [x4]                        \n"
                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   ldr     q1, [x10]                       \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"


                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4]                        \n"


                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10]                       \n"

                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11]                      \n"
                    "   str     q11, [x12]                      \n"




                    "   ldr     q8, [x13]                       \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   ldr     q9, [x14]                       \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   ldr     q10, [x15]                      \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                    "   ldr     q11, [x16]                      \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x13]                       \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x14]                       \n"

                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x15]                      \n"
                    "   str     q11, [x16]                      \n"




                    "   ldr     q8, [x4, #16]                   \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                    "   ldr     q9, [x10, #16]                  \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                    "   ldr     q10, [x11, #16]                 \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                    "   ldr     q11, [x12, #16]                 \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4, #16]                   \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10, #16]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x11, #16]                 \n"
                    "   str     q11, [x12, #16]                 \n"




                    "   ldr     q8, [x13, #16]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                    "   ldr     q9, [x14, #16]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                    "   ldr     q10, [x15, #16]                 \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                    "   ldr     q11, [x16, #16]                 \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x13, #16]                  \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x14, #16]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x15, #16]                 \n"
                    "   str     q11, [x16, #16]                 \n"


                ".endm                                          \n" 

//
    

    
    "M8N8_02_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #256                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N8_02_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N8_02_PACK_LOOP                               \n"
    
    "M8N8_02_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N8_02_PACK_K3                     \n"

    "M8N8_02_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N8_02_PACK_K4                                 \n"
    "   uKERNEL_M8N8_02_PACK_K5                                 \n"
    "   uKERNEL_M8N8_02_PACK_K6                                 \n"
    "   uKERNEL_M8N8_02_PACK_K7                                 \n"

    "   beq     M8N8_02_PACK_END_K                        \n"

    "   uKERNEL_M8N8_02_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N8_02_PACK_MAIN_K                       \n" 




    "M8N8_02_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N8_02_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N8_02_PACK_END                    \n"

    "   b    M8N8_02_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N8_02_PACK:                               \n"
    "   M8N8_02_PACK_ADD_C                                   \n"
    
    
    "M8N8_02_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N7_02_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N7_02_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0]                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            

            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x0, #16]                      \n"

            "   str     q2, [x1], #16                   \n"
            
            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"
            
            "   str     q3, [x1], #16                   \n"
            
            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"
            
            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"


            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_PACK_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"
                
                "   str     q2, [x1], #16                   \n"
                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_02_PACK_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N7_02_PACK_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22]                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"



                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"



                "   str     q2, [x1], #16                   \n"

                //update img row 1 col 1
                "   ldr     q3, [x22, #16]                   \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_PACK_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"



                "   ldr     q7, [x3], #16                   \n"
                


                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"

                "   add     x22, x22, x5                    \n"
                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0]                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"



                //prepare: row 2 col 1
                "   ldr     q3, [x0, #16]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    

    
    ".macro M8N7_02_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"



                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                
                
                "   st3     {v16.s, v17.s, v18.s}[0], [x4]    \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x10]    \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x11]    \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x12]    \n"
                

                

                "   st3     {v20.s, v21.s, v22.s}[0], [x13]   \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x14]   \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x15]   \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x16]   \n"

                


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_02_PACK_END                             \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16 \n"
                /*
                "   st3     {v16.s, v17.s, v18.s}[0], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x28], #12     \n"
                
                "   st3     {v20.s, v21.s, v22.s}[0], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x28], #12     \n"
                */
                "   st2     {v16.s, v17.s}[0], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[1], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[2], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[3], [x28], #8     \n"
                
                "   st2     {v20.s, v21.s}[0], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x28], #8     \n"
                
                "   str     q18, [x28], #16     \n"
                "   str     q22, [x28], #16     \n"
                
                
                
                //4
                "   ldr     q0, [x4]                   \n"
                "   ldr     q1, [x10]                   \n"
                "   ldr     q2, [x11]                   \n"
                "   ldr     q3, [x12]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"

                //4
                "   ldr     q0, [x13]                   \n"
                "   ldr     q1, [x14]                   \n"
                "   ldr     q2, [x15]                   \n"
                "   ldr     q3, [x16]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"

                //2
                "   ld1     {v0.2s}, [x4]                   \n"
                "   ld1     {v1.2s}, [x10]                   \n"
                "   ld1     {v2.2s}, [x11]                   \n"
                "   ld1     {v3.2s}, [x12]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x4], #8                   \n"
                "   st1     {v9.2s}, [x10], #8                   \n"
                "   st1     {v10.2s}, [x11], #8                   \n"
                "   st1     {v11.2s}, [x12], #8                   \n"

                 //2
                "   ld1     {v0.2s}, [x13]                   \n"
                "   ld1     {v1.2s}, [x14]                   \n"
                "   ld1     {v2.2s}, [x15]                   \n"
                "   ld1     {v3.2s}, [x16]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x13], #8                   \n"
                "   st1     {v9.2s}, [x14], #8                   \n"
                "   st1     {v10.2s}, [x15], #8                   \n"
                "   st1     {v11.2s}, [x16], #8                   \n"
                
                //1
                
                "   ld1     {v0.s}[0], [x4]                   \n"
                "   ld1     {v0.s}[1], [x10]                   \n"
                "   ld1     {v0.s}[2], [x11]                   \n"
                "   ld1     {v0.s}[3], [x12]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x4]                  \n"
                "   st1     {v8.s}[1], [x10]                  \n"
                "   st1     {v8.s}[2], [x11]                  \n"
                "   st1     {v8.s}[3], [x12]                  \n"

                //1
                
                "   ld1     {v0.s}[0], [x13]                   \n"
                "   ld1     {v0.s}[1], [x14]                   \n"
                "   ld1     {v0.s}[2], [x15]                   \n"
                "   ld1     {v0.s}[3], [x16]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x13]                  \n"
                "   st1     {v8.s}[1], [x14]                  \n"
                "   st1     {v8.s}[2], [x15]                  \n"
                "   st1     {v8.s}[3], [x16]                  \n"
                
                
                
    ".endm                                                  \n"
    
    "M8N7_02_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add  x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #64]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x29, sp                            \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N7_02_PACK_BEGIN                     \n"

    "   sub x29, x29, #224                        \n"
    
    "   mov x28, x29                        \n"
    
    "   b M8N7_02_PACK_LOOP                               \n"
    
    "M8N7_02_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N7_02_PACK_K3                     \n"

    "M8N7_02_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N7_02_PACK_K4                                 \n"
    "   uKERNEL_M8N7_02_PACK_K5                                 \n"
    "   uKERNEL_M8N7_02_PACK_K6                                 \n"
    "   uKERNEL_M8N7_02_PACK_K7                                 \n"

    "   beq     M8N7_02_PACK_END_K                        \n"

    "   uKERNEL_M8N7_02_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N7_02_PACK_MAIN_K                       \n" 




    "M8N7_02_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N7_02_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N7_02_PACK_END                    \n"

    "   b    M8N7_02_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N7_02_PACK:                               \n"
    "   M8N7_02_PACK_ADD_C                                   \n"
    
    
    "M8N7_02_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N5_02_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N5_02_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            
            "   str     q2, [x1], #16                   \n"
            
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"

            "   ld1     {v3.2s}, [x0]                   \n"


            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"

            "   add     x11, x10, x6          \n"
            "   add     x12, x11, x6           \n"

            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   add     x13, x12, x6           \n"
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"
            "   add     x15, x14, x6          \n"
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_PACK_K3                              \n"

                
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                
                "   str     q2, [x1], #16                   \n"
                
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N5_02_PACK_K4                              \n"

                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"
                
                "   st1     {v3.2s}, [x1], #8                   \n"
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N5_02_PACK_K5                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #16                     \n"

                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x22], #16                        \n"
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"

                "   ldr     q7, [x3], #16                   \n"
                "   str     q2, [x1], #16                   \n"

                "   ld1     {v3.2s}, [x22]                   \n"


                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_PACK_K6                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                "   st1     {v3.2s}, [x1], #8                   \n"
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"



    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"


                "   ldr     q6, [x3], #16                   \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"

                "   sub     x22, x22, #16                   \n"             //22 sub

                "   ldr     q7, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"

                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_02_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x0], #16                   \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   ld1     {v3.2s}, [x0]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N5_02_PACK_ADD_C       \n"

                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                "   st1     {v16.s}[0], [x4]        \n"
                "   st1     {v16.s}[1], [x10]        \n"
                "   st1     {v16.s}[2], [x11]        \n"
                "   st1     {v16.s}[3], [x12]        \n"
                
                "   st1     {v20.s}[0], [x13]        \n"
                "   st1     {v20.s}[1], [x14]        \n"
                "   st1     {v20.s}[2], [x15]        \n"
                "   st1     {v20.s}[3], [x16]        \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N5_02_PACK_END       \n"

                    "   ldr     q0, [x4]                        \n"
                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   ldr     q1, [x10]                       \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                    

                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"

                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4], #16                        \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"

                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10], #16                       \n"
                    "   str     q16, [x28], #16         \n"
                    "   str     q20, [x28], #16         \n"
                    
                    
                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11], #16                      \n"
                    "   str     q11, [x12], #16                      \n"

                    "   ldr     q0, [x13]                        \n"
                    "   ldr     q8, [x29], #16                  \n"
                    
                    "   ldr     q1, [x14]                       \n"
                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    "   ldr     q2, [x15]                       \n"
                    "   ldr     q3, [x16]                       \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    
                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q11, [x29], #16                 \n"
                    "   fadd    v10.4s, v10.4s, v2.4s             \n"
                    
                    "   str     q8, [x13], #16                        \n"
                    "   str     q9, [x14], #16                       \n"
                    
                    "   fadd    v11.4s, v11.4s, v3.4s             \n"
                    "   str     q10, [x15], #16                      \n"
                    "   str     q11, [x16], #16                      \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   ld1     {v0.s}[0], [x4]                   \n"
                    "   ld1     {v0.s}[1], [x10]                   \n"
                    "   ld1     {v0.s}[2], [x11]                   \n"
                    "   ld1     {v0.s}[3], [x12]                   \n"

                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    
                    
                    "   ldr     q9, [x29], #16                  \n"
                    "   ld1     {v1.s}[0], [x13]                   \n"
                    "   ld1     {v1.s}[1], [x14]                   \n"
                    "   ld1     {v1.s}[2], [x15]                   \n"
                    "   ld1     {v1.s}[3], [x16]                   \n"
                    
                    "   st1     {v8.s}[0], [x4]                  \n"
                    "   st1     {v8.s}[1], [x10]                  \n"
                    "   st1     {v8.s}[2], [x11]                  \n"
                    "   st1     {v8.s}[3], [x12]                  \n"
                    
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   st1     {v9.s}[0], [x13]                  \n"
                    "   st1     {v9.s}[1], [x14]                  \n"
                    "   st1     {v9.s}[2], [x15]                  \n"
                    "   st1     {v9.s}[3], [x16]                  \n"

                ".endm                                          \n" 

//
    

    
    "M8N5_02_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    "   mov x29, sp                            \n"
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub x29, x29, #160                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N5_02_PACK_BEGIN                     \n"
    "   mov x28, x29                            \n"
    
    
    "   b M8N5_02_PACK_LOOP                               \n"
    
    "M8N5_02_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N5_02_PACK_K3                     \n"

    "M8N5_02_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N5_02_PACK_K4                                 \n"
    "   uKERNEL_M8N5_02_PACK_K5                                 \n"
    "   uKERNEL_M8N5_02_PACK_K6                                 \n"
    "   uKERNEL_M8N5_02_PACK_K7                                 \n"

    "   beq     M8N5_02_PACK_END_K                        \n"

    "   uKERNEL_M8N5_02_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N5_02_PACK_MAIN_K                       \n" 




    "M8N5_02_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N5_02_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N5_02_PACK_END                    \n"

    "   b    M8N5_02_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N5_02_PACK:                               \n"
    "   M8N5_02_PACK_ADD_C                                   \n"
    
    
    "M8N5_02_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N4_02_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N4_02_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"

            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"



            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_PACK_K3                              \n"

                
                

                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                
                "   ldr     q7, [x3], #16                   \n"
                
                "   str     q3, [x1], #16                   \n"
                
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N4_02_PACK_K4                              \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"
                
                "   ld1     {v4.2s}, [x0], #8                   \n"
                


                //update kernel
                "   ldr     q1, [x3], #16                   \n"
                
                "   st1     {v4.2s}, [x1], #8                   \n"
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N4_02_PACK_K5                              \n"
    

                
                "   sub     x0, x0, #24                     \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    

                "   add     x0, x0, x5                    \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q7, [x3], #16                   \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   ldr     q3, [x22], #16                   \n"


                
                //update img row 1 col 2

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_PACK_K6                              \n"

                
                
                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"
                "   ldr     q1, [x3], #16                   \n"

                "   str     q3, [x1], #16                   \n"

                "   ld1     {v4.2s}, [x22], #8                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"
                "   st1     {v4.2s}, [x1], #8                   \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_PACK_K7                              \n"


                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                "   sub     x22, x22, #24                   \n"             //22 sub

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_02_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"


                //update kernel
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N4_02_PACK_ADD_C       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]      \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                    "   add     sp, sp, #128                    \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

                ".endm              \n"
                
                ".macro uKERNEL_M8N4_02_PACK_END       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                    "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                    "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                    "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"


                    "   ldr     q8, [x4]                   \n"

                    "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                    "   ldr     q9, [x10]                  \n"

                    "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                    "   ldr     q10, [x11]                 \n"

                    "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                    "   ldr     q11, [x12]                 \n"

                    "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4]                   \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x11]                 \n"
                    "   str     q11, [x12]                 \n"




                    "   ldr     q8, [x13]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                    "   ldr     q9, [x14]                  \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                    "   ldr     q10, [x15]                 \n"
                    "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                    "   ldr     q11, [x16]                 \n"



                    "   ldr     q0, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"

                    "   ldr     q1, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x13]                  \n"

                    "   ldr     q2, [x29], #16                  \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x14]                  \n"

                    "   ldr     q3, [x29], #16                  \n"
                    "   fadd    v11.4s, v11.4s, v3.4s           \n"
                    "   str     q10, [x15]                 \n"
                    "   str     q11, [x16]                 \n"


                ".endm                                          \n" 

//
    

    
    "M8N4_02_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #128                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N4_02_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N4_02_PACK_LOOP                               \n"
    
    "M8N4_02_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N4_02_PACK_K3                     \n"

    "M8N4_02_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N4_02_PACK_K4                                 \n"
    "   uKERNEL_M8N4_02_PACK_K5                                 \n"
    "   uKERNEL_M8N4_02_PACK_K6                                 \n"
    "   uKERNEL_M8N4_02_PACK_K7                                 \n"

    "   beq     M8N4_02_PACK_END_K                        \n"

    "   uKERNEL_M8N4_02_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N4_02_PACK_MAIN_K                       \n" 




    "M8N4_02_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N4_02_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N4_02_PACK_END                    \n"

    "   b    M8N4_02_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N4_02_PACK:                               \n"
    "   M8N4_02_PACK_ADD_C                                   \n"
    
    
    "M8N4_02_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N2_02_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N2_02_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"

            
            //update img
            "   ldr     q3, [x0]                      \n"

            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"



            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_PACK_K3                              \n"

                
                

                
                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"

                
                "   ldr     q7, [x3], #16                   \n"
                
                "   str     q3, [x1], #16                   \n"
                
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N2_02_PACK_K4                              \n"

                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N2_02_PACK_K5                              \n"
    
                "   ldr     q6, [x3], #16                   \n"
    

                "   add     x0, x0, x5                    \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"



                //update the kernel
                "   ldr     q7, [x3], #16                   \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   ldr     q3, [x22]                   \n"


                
                //update img row 1 col 2

                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_PACK_K6                              \n"

                
                
                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   str     q3, [x1], #16                   \n"



                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_PACK_K7                              \n"


                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"

                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_02_PACK_K8                              \n"
                "   add     x3, x3, #96         \n"


                //update kernel
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"



                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x0]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    
                ".macro M8N2_02_PACK_ADD_C       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"


                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    
                    "   st2     {v16.s, v17.s}[0], [x4]      \n"
                    "   st2     {v16.s, v17.s}[1], [x10]      \n"
                    "   st2     {v16.s, v17.s}[2], [x11]      \n"
                    "   st2     {v16.s, v17.s}[3], [x12]      \n"


                    "   add     sp, sp, #64                    \n"

                    "   st2     {v20.s, v21.s}[0], [x13]      \n"
                    "   st2     {v20.s, v21.s}[1], [x14]      \n"
                    "   st2     {v20.s, v21.s}[2], [x15]      \n"
                    "   st2     {v20.s, v21.s}[3], [x16]      \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N2_02_PACK_END       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"

                "   st2     {v16.s, v17.s}[0], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[1], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[2], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[3], [x29], #8       \n"

                "   st2     {v20.s, v21.s}[0], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x29], #8     \n"
                
                "   sub     x29, x29, #64                   \n"
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v1.2s}, [x10]                       \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"


                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"

                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v0.2s}, [x12]                       \n"
                
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"


                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"


                "   ld1     {v8.2s}, [x13]                       \n"
                "   ld1     {v9.2s}, [x14]                       \n"
                "   ld1     {v10.2s}, [x15]                      \n"
                "   ld1     {v11.2s}, [x16]                      \n"



                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   st1     {v8.2s}, [x13]                       \n"


                "   ld1     {v1.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   st1     {v9.2s}, [x14]                       \n"

                "   ld1     {v2.2s}, [x29], #8                  \n"
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   st1     {v10.2s}, [x15]                      \n"

                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"
                "   st1     {v11.2s}, [x16]                      \n"
                "   add     sp, sp, #64                    \n"


                ".endm                                          \n" 

//
    

    
    "M8N2_02_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   add x3, x3, #96    \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #64                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N2_02_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N2_02_PACK_LOOP                               \n"
    
    "M8N2_02_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N2_02_PACK_K3                     \n"

    "M8N2_02_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N2_02_PACK_K4                                 \n"
    "   uKERNEL_M8N2_02_PACK_K5                                 \n"
    "   uKERNEL_M8N2_02_PACK_K6                                 \n"
    "   uKERNEL_M8N2_02_PACK_K7                                 \n"

    "   beq     M8N2_02_PACK_END_K                        \n"

    "   uKERNEL_M8N2_02_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N2_02_PACK_MAIN_K                       \n" 




    "M8N2_02_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N2_02_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N2_02_PACK_END                    \n"

    "   b    M8N2_02_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N2_02_PACK:                               \n"
    "   M8N2_02_PACK_ADD_C                                   \n"
    
    
    "M8N2_02_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}



void direct_3x3_M8N12_10_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_10_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            "   str     q2, [x1], #16                   \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   str     q4, [x1], #16                   \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v3.s[3]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[0]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[1]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[2]          \n"
            

            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            
            "   fmul    v28.4s, v1.4s, v3.s[3]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[2]          \n"

            "   ldr     q0, [x3], #16                   \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"

    ".endm                                                  \n"
    
//
    ".macro uKERNEL_M8N12_10_PACK_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   str     q2, [x1], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 


                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_PACK_K1                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x0], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   sub     x0, x0, #56                   \n"             //22 sub

                "   st1     {v5.2s}, [x1], #8                   \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                "   add     x0, x0, x5                    \n"             //更新x22:img_1
                
                
                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_PACK_K2                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x22], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   str     q2, [x1], #16                   \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_10_PACK_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   str     q4, [x1], #16                   \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_10_PACK_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_10_PACK_K5                              \n"
                "   ld1     {v5.2s}, [x22], #8               \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                "   st1     {v5.2s}, [x1], #8                   \n"
                
                "   sub     x22, x22, #56                     \n"
                
                //update the kernel
                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                "   add     x22, x22, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x23], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x23], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x23], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_PACK_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x23], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   sub     x23, x23, #56                   \n"             //22 sub

                "   st1     {v5.2s}, [x1], #8                   \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                "   add     x23, x23, x5                    \n"             
                
                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_PACK_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_10_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_10_PACK_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[1]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_10_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x23, %[img_start_2]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_10_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_10_PACK_LOOP                               \n"
    
    "M8N12_10_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_10_PACK_K0                     \n"

    "M8N12_10_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N12_10_PACK_K1                                 \n"
    "   uKERNEL_M8N12_10_PACK_K2                                 \n"
    "   uKERNEL_M8N12_10_PACK_K3                                 \n"
    "   uKERNEL_M8N12_10_PACK_K4                                 \n"
    "   uKERNEL_M8N12_10_PACK_K5                                 \n"
    "   uKERNEL_M8N12_10_PACK_K6                                 \n"
    "   uKERNEL_M8N12_10_PACK_K7                                 \n"

    "   beq     M8N12_10_PACK_END_K                        \n"

    "   uKERNEL_M8N12_10_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_10_PACK_MAIN_K                       \n" 




    "M8N12_10_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_10_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N12_10_PACK_END                    \n"

    "   b    M8N12_10_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_10_PACK:                               \n"
    "   M8N12_10_PACK_ADD_C                                   \n"
    
    
    "M8N12_10_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_start_2]                 "m"     (img_start_2),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N12_11_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_11_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            "   str     q2, [x1], #16                   \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            
            "   str     q3, [x1], #16                   \n"
            
            "   add     x10, x4, x6                     \n"

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   str     q4, [x1], #16                   \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[2]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[3]          \n"
            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"

            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[2]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[3]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K0                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                
                "   str     q2, [x1], #16                   \n"
                
                //update kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K1                              \n"
            "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
            "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
            "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
            "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
            "   prfm    PLDL1KEEP, [x22, #64]            \n"            //预取img_1    
            //get the end two column of img
            "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
            "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
            "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
            "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
            
            //edge condition(这个地方可能会错，需要改成加法)
            "   ld1     {v5.2s}, [x0], #8               \n"
            
            "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
            "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
            
            "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
            "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
            "   sub     x0, x0, #56                     \n"             //将x0减回去

            "   st1     {v5.2s}, [x1], #8                   \n"

            //update the kernel
            "   ldr     q0, [x3], #16                   \n"
            
            // corresponding to the add x0, x0 #48
            "   add     x0, x0, x5                    \n"             //更新x0:img_0
            "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
            "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
            "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
            "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
            //update the kernel
            "   ldr     q1, [x3], #16                   \n"

            "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
            "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
            "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
            "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

            "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
            "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
            "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
            "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K2                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                //update the kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K3                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K4                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                "   sub     x22, x22, #56                   \n"             //22 sub

                "   ldr     q7, [x3], #16                   \n"
                
                "   st1     {v5.2s}, [x1], #8                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"
                "   prfm    PLDL1KEEP, [x23, #64]            \n"            //预取img_2
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K5                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x23], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   str     q2, [x1], #16                   \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x23], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x23], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K6                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                //edge: row 2 col 2

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
            
                "   ld1     {v5.2s}, [x23], #8              \n"
                
                //corresponding to the add
    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K7                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                "   sub     x23, x23, #56                    \n"             //23 sub

                //update r2 to the next inch
                "   prfm    PLDL1KEEP, [x0, #64]            \n"            //预取img_0


                "   st1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                "   add     x23, x23, x5                    \n"             //更新x23:img_2
                //update kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   prfm    PLDL1KEEP, [x3, #128]           \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare row 0 col 0
                "   ldr     q2, [x0], #16                        \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare row 0 col 0
                "   ldr     q3, [x0], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                //prepare row 0 col 0
                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    
    ".macro M8N12_11_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   add     sp, sp, #384                       \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_11_PACK_END                             \n"
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"




                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                "   fmla    v16.4s, v6.4s, v3.s[2]                      \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]                      \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]                      \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_11_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x23, %[img_start_2]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_11_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_11_PACK_LOOP                               \n"
    
    "M8N12_11_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_11_PACK_K0                     \n"

    "M8N12_11_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N12_11_PACK_K1                                 \n"
    "   uKERNEL_M8N12_11_PACK_K2                                 \n"
    "   uKERNEL_M8N12_11_PACK_K3                                 \n"
    "   uKERNEL_M8N12_11_PACK_K4                                 \n"
    "   uKERNEL_M8N12_11_PACK_K5                                 \n"
    "   uKERNEL_M8N12_11_PACK_K6                                 \n"
    "   uKERNEL_M8N12_11_PACK_K7                                 \n"

    "   beq     M8N12_11_PACK_END_K                        \n"

    "   uKERNEL_M8N12_11_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_11_PACK_MAIN_K                       \n" 




    "M8N12_11_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_11_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N12_11_PACK_END                    \n"

    "   b    M8N12_11_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_11_PACK:                               \n"
    "   M8N12_11_PACK_ADD_C                                   \n"
    
    
    "M8N12_11_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_start_2]                 "m"     (img_start_2),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N10_12_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N10_12_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            "   str     q2, [x1], #16                   \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            
            "   str     q3, [x1], #16                   \n"
            
            "   add     x10, x4, x6                     \n"

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   str     q4, [x1], #16                   \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 
            "   ldr     q6, [x3], #16                   \n"
            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"


            
            //update kernel
            "   ldr     q7, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"

            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K0                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                
                "   str     q2, [x1], #16                   \n"
                
                //update kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K1                              \n"
            "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
            "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
            "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
            "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
            "   prfm    PLDL1KEEP, [x22, #64]            \n"            //预取img_1    
            //get the end two column of img
            "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
            "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
            "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
            "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

            
            "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
            "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
            
            "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
            "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
            "   sub     x0, x0, #48                     \n"             //将x0减回去



            //update the kernel
            "   ldr     q0, [x3], #16                   \n"

            "   add     x0, x0, x5                    \n"             //更新x0:img_0
            "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
            "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
            "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
            "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
            //update the kernel
            "   ldr     q1, [x3], #16                   \n"

            "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
            "   fmla    v25.4s, v6.4s, v4.s[2]          \n"


            "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
            "   fmla    v29.4s, v7.4s, v4.s[2]          \n"

    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K2                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                //update the kernel
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"



                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"


                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K3                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K4                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                "   sub     x22, x22, #48                   \n"             //22 sub

                "   ldr     q7, [x3], #16                   \n"
                

                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"

                "   prfm    PLDL1KEEP, [x23, #64]            \n"            //预取img_2
                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K5                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x23], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   str     q2, [x1], #16                   \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x23], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"


                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"


                //prepare: row 2 col 2
                "   ldr     q4, [x23], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K6                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                //edge: row 2 col 2

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"

    
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K7                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                "   sub     x23, x23, #48                    \n"             //23 sub

                //update r2 to the next inch
                "   prfm    PLDL1KEEP, [x0, #64]            \n"            //预取img_0



                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"

                "   add     x23, x23, x5                    \n"             //更新x23:img_2

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"


                //update kernel
                "   ldr     q7, [x3], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   prfm    PLDL1KEEP, [x3, #128]           \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                "   ldr     q2, [x0], #16                        \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   ldr     q3, [x0], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"

                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    
    ".macro M8N10_12_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st2     {v24.s, v25.s}[0], [x4]    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st2     {v24.s, v25.s}[1], [x10]    \n" 
                
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st2     {v24.s, v25.s}[2], [x11]   \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st2     {v24.s, v25.s}[3], [x12]    \n"
                
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"


                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st2     {v28.s, v29.s}[0], [x13]    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st2     {v28.s, v29.s}[1], [x14]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st2     {v28.s, v29.s}[2], [x15]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st2     {v28.s, v29.s}[3], [x16]    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_12_PACK_END                             \n"
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16    \n"
                
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"



                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x28], #16  \n"
                
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x28], #16  \n"
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x28], #16  \n"
                
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x28], #16  \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x28], #16  \n"
                
                
                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x28], #16  \n"

                "   st2     {v24.s, v25.s}[0], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[1], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[2], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[3], [x28], #8  \n"
                
                "   st2     {v28.s, v29.s}[0], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[1], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[2], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[3], [x28], #8  \n"


                        // 4*8
                        
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"
                        

                
                        // 8-------
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                       \n"
                "   str     q9, [x14], #16                      \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                     \n"
                "   str     q11, [x16], #16                     \n"



                
                // 8
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x10]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x12]                       \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"
                
                
                //
                "   ld1     {v0.2s}, [x13]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x14]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                "   ld1     {v2.2s}, [x15]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x16]                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                
                "   st1     {v8.2s}, [x13]                       \n"
                "   st1     {v9.2s}, [x14]                      \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x15]                     \n"
                "   st1     {v11.2s}, [x16]                     \n"
    
    ".endm                                                  \n"
    
    "M8N10_12_PACK_ENTRANCE:                                                       \n"
    "   mov x29, sp     \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x23, %[img_start_2]                      \n"
    
    "   sub x29, x29, #320                        \n"
    
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    "   mov x28,x29     \n"
    "   ldr x8, %[ic]                          \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N10_12_PACK_BEGIN                     \n"

    
    
    "   b M8N10_12_PACK_LOOP                               \n"
    
    "M8N10_12_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N10_12_PACK_K0                     \n"

    "M8N10_12_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N10_12_PACK_K1                                 \n"
    "   uKERNEL_M8N10_12_PACK_K2                                 \n"
    "   uKERNEL_M8N10_12_PACK_K3                                 \n"
    "   uKERNEL_M8N10_12_PACK_K4                                 \n"
    "   uKERNEL_M8N10_12_PACK_K5                                 \n"
    "   uKERNEL_M8N10_12_PACK_K6                                 \n"
    "   uKERNEL_M8N10_12_PACK_K7                                 \n"

    "   beq     M8N10_12_PACK_END_K                        \n"

    "   uKERNEL_M8N10_12_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N10_12_PACK_MAIN_K                       \n" 




    "M8N10_12_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N10_12_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N10_12_PACK_END                    \n"

    "   b    M8N10_12_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N10_12_PACK:                               \n"
    "   M8N10_12_PACK_ADD_C                                   \n"
    
    
    "M8N10_12_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_start_2]                 "m"     (img_start_2),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}



void direct_3x3_M8N8_12_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
            asm volatile(
                    ".macro uKERNEL_M8N8_12_PACK_BEGIN                      \n"
                        "   ldr     q0, [x3], #16                   \n"
                        "   ldr     q1, [x3], #16                   \n"
                        "   ldr     q2, [x0], #16                   \n"     //ldr q2 x0
                        
                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x0, #64]            \n"     //p x0


                        "   add     x10, x4, x6                     \n"

                        "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmul    v11.4s, v0.4s, v2.s[3]          \n"

                        "   str     q2, [x1], #16                   \n"

                        "   ldr     q3, [x0], #16                   \n"     //ldr q2 x0
                        "   add     x11, x10, x6                    \n"

                        "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmul    v15.4s, v1.4s, v2.s[3]          \n"

                        "   str     q3, [x1], #16                   \n"

                        "   ldr     q6, [x3], #16                   \n"
                        "   add     x12, x11, x6                    \n"

                        "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
                        "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

                        "   ldr     q7, [x3], #16                   \n"
                        "   add     x13, x12, x6                    \n"

                        "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
                        "   fmul    v19.4s, v0.4s, v3.s[3]          \n"

                        "   add     x14, x13, x6                    \n"

                        "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
                        "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

                        "   add     x15, x14, x6                    \n"

                        "   prfm    PLDL2KEEP, [x4, #64]            \n"
                        "   prfm    PLDL2KEEP, [x10, #64]           \n"
                        "   prfm    PLDL2KEEP, [x11, #64]           \n"
                        "   prfm    PLDL2KEEP, [x12, #64]           \n"

                        "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
                        "   fmul    v23.4s, v1.4s, v3.s[3]          \n"

                        "   add     x16, x15, x6                    \n"

                        "   prfm    PLDL2KEEP, [x13, #64]           \n"
                        "   prfm    PLDL2KEEP, [x14, #64]           \n"
                        "   prfm    PLDL2KEEP, [x15, #64]           \n"
                        "   prfm    PLDL2KEEP, [x16, #64]           \n"


                        ".endm                                      \n"
                    
                    ".macro uKERNEL_M8N8_12_PACK_K0                         \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   str     q2, [x1], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"
                        
                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                        "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                        "   str     q3, [x1], #16                   \n"

                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                        "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N8_12_PACK_K1     \n"
                        "   ld1     {v4.2s}, [x0], #8                   \n" //ld1 q4 x0

                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                        "   sub     x0, x0, #40                     \n"     //sub x0
                        "   ldr     q0, [x3], #16                   \n"

                        "   st1     {v4.2s}, [x1], #8                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                        "   add     x0, x0, x5                    \n"       //add x0
                        "   ldr     q1, [x3], #16                   \n"
                        "   prfm    PLDL1KEEP, [x22, #64]            \n"            //p 22
                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                        "   fmla    v23.4s, v7.4s, v4.s[0]          \n"


                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_PACK_K2     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                        "   ldr     q2, [x22], #16                  \n"     //ldr q2 x22

                        "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                        "   fmla    v18.4s, v0.4s, v4.s[0]          \n"

                        "   str     q2, [x1], #16                   \n"

                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[3]          \n"

                        "   fmla    v22.4s, v1.4s, v4.s[0]          \n"


                        "   ldr     q3, [x22], #16                   \n"     //ldr q3 x22

                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_PACK_K3     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                        "   str     q3, [x1], #16                   \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                        "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                        

                        "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                        "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_PACK_K4     \n"

                        "   ld1     {v4.2s}, [x22], #8               \n"        //ld1 q4 x22

                        "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                        "   sub     x22, x22, #40                     \n"     //sub x22
                        "   ldr     q6, [x3], #16                   \n"

                        "   st1     {v4.2s}, [x1], #8                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                        "   add     x22, x22, x5                    \n"       //add x22
                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                        "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                        "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                        "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x23, #64]            \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_PACK_K5     \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   ldr     q2, [x23], #16                        \n"       //ldr q2 23    

                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                        "   str     q2, [x1], #16                   \n"

                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                        "   ldr     q3, [x23], #16                   \n"        //ldr q3 23 


                    ".endm              \n"

                    ".macro uKERNEL_M8N8_12_PACK_K6     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   str     q3, [x1], #16                   \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                        "   ldr     q7, [x3], #16                   \n"


                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                        "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                        "   fmla    v19.4s, v0.4s, v3.s[3]          \n"


                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                        "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                        "   fmla    v23.4s, v1.4s, v3.s[3]          \n"



                    ".endm              \n"    
                    
                    ".macro uKERNEL_M8N8_12_PACK_K7     \n"


                        "   ld1     {v4.2s}, [x23], #8                   \n"    //ld1 q4 23

                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                        "   sub     x23, x23, #40                    \n"    //sub x23

                        "   st1     {v4.2s}, [x1], #8                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                        "   add     x23, x23, x5                    \n"     //add x23
                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                        "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                        "   ldr     q7, [x3], #16                   \n"
                    ".endm              \n"
                 
                    ".macro uKERNEL_M8N8_12_PACK_K8     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                        "   prfm    PLDL1KEEP, [x0, #64]            \n"         //p
                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        
                        "   ldr     q2, [x0], #16                        \n"        //ldr q2 x0
                        
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        
                        "   ldr     q3, [x0], #16                   \n"             //ldr q2 x0
                        
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                    ".endm              \n"
                    
                    ".macro M8N8_12_PACK_ADD_C       \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                        "   add     sp, sp, #256                    \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N8_12_PACK_END       \n"

                        "   ldr     q0, [x4]                        \n"
                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   ldr     q1, [x10]                       \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"


                        "   ldr     q8, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"


                        "   ldr     q9, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4]                        \n"


                        "   ldr     q10, [x29], #16                 \n"
                        "   ldr     q2, [x11]                       \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10]                       \n"

                        "   ldr     q11, [x29], #16                 \n"
                        "   ldr     q0, [x12]                       \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x11]                      \n"
                        "   str     q11, [x12]                      \n"




                        "   ldr     q8, [x13]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"
                        "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                        "   ldr     q9, [x14]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"
                        "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                        "   ldr     q10, [x15]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"
                        "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                        "   ldr     q11, [x16]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13]                       \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14]                       \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x15]                      \n"
                        "   str     q11, [x16]                      \n"




                        "   ldr     q8, [x4, #16]                   \n"
                        "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                        "   ldr     q9, [x10, #16]                  \n"
                        "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                        "   ldr     q10, [x11, #16]                 \n"
                        "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                        "   ldr     q11, [x12, #16]                 \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4, #16]                   \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x11, #16]                 \n"
                        "   str     q11, [x12, #16]                 \n"




                        "   ldr     q8, [x13, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                        "   ldr     q9, [x14, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                        "   ldr     q10, [x15, #16]                 \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                        "   ldr     q11, [x16, #16]                 \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13, #16]                  \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x15, #16]                 \n"
                        "   str     q11, [x16, #16]                 \n"


                    ".endm                                          \n" 
            
            "M8N8_12_PACK_ENTRANCE:                                                       \n"
            "   ldr x0, %[img_start_0]                    \n"
            "   ldr x22, %[img_start_1]                      \n"
            "   ldr x23, %[img_start_2]                      \n"
            "   ldr x1, %[img_pack]                     \n"
            "   ldr x3, %[kernal]                       \n"
            "   ldr x4, %[out]                          \n"
            "   ldr x7, %[ic_count]                     \n"
            "   ldr x6, %[stride_out_size]             \n"
            "   ldr x5, %[stride_in_size]             \n"
            
            "   prfm PLDL1KEEP, [x0, #128]              \n"
            "   prfm PLDL1KEEP, [x3, #256]              \n"
            
            "   ldr x8, %[ic]                          \n"
            
            "   sub sp, sp, #256                        \n"
            "   subs x7, x7, #1                         \n"
            
            "   uKERNEL_M8N8_12_PACK_BEGIN                     \n"
            "   mov x29, sp                            \n"
            
            
            "   b M8N8_12_PACK_LOOP                               \n"
            
            "M8N8_12_PACK_MAIN_K:                                  \n"
                "   uKERNEL_M8N8_12_PACK_K0                     \n"

            "M8N8_12_PACK_LOOP:                                  \n"
            "   uKERNEL_M8N8_12_PACK_K1                                 \n"
            "   uKERNEL_M8N8_12_PACK_K2                                 \n"
            "   uKERNEL_M8N8_12_PACK_K3                                 \n"
            "   uKERNEL_M8N8_12_PACK_K4                                 \n"
            "   uKERNEL_M8N8_12_PACK_K5                                 \n"
            "   uKERNEL_M8N8_12_PACK_K6                                 \n"
            "   uKERNEL_M8N8_12_PACK_K7                                 \n"

            "   beq     M8N8_12_PACK_END_K                        \n"

            "   uKERNEL_M8N8_12_PACK_K8                                 \n"

            "   subs    x7, x7, #1                 \n"
            "   b       M8N8_12_PACK_MAIN_K                       \n" 




            "M8N8_12_PACK_END_K:                                     \n"
            //ic = 0, store
            "   cmp     x8, #0                          \n"
            "   beq     END_uKERNEL_M8N8_12_PACK                     \n"

            //ic != 0
            "   uKERNEL_M8N8_12_PACK_END                    \n"

            "   b    M8N8_12_PACK_END                             \n"
            
            //ic = 0, add
            "END_uKERNEL_M8N8_12_PACK:                               \n"
            "   M8N8_12_PACK_ADD_C                                   \n"
            
            
            "M8N8_12_PACK_END:                                       \n"
            :

            :
                [img_start_0]                 "m"     (img_start_0),
                [img_start_1]                 "m"     (img_start_1),
                [img_start_2]                 "m"     (img_start_2),
                [img_pack]                    "m"     (img_pack),
                [kernal]                    "m"     (kernal),
                [out]                       "m"     (out),
                [ic_count]                  "m"     (ic_count),
                [ic]                        "m"     (ic),
                [stride_out_size]           "m"     (stride_out_size),
                [stride_in_size]            "m"     (stride_in_size)
                
            :
                "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
                "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
                "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
                "x26", "x27", "x28","x29","x30",
                "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
                "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
                "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
                "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
            );
            
            
}


void direct_3x3_M8N7_12_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N7_12_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0]                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            "   str     q2, [x1], #16                   \n"
            
            //update img
            "   ldr     q3, [x0, #16]                     \n"

            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            "   add     x14, x13, x6           \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   add     x15, x14, x6          \n"

            "   ldr     q0, [x3], #16                   \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            "   add     x16, x15, x6          \n"
            "   ldr     q1, [x3], #16                   \n"

    ".endm                                                  \n"
    
//
    ".macro uKERNEL_M8N7_12_PACK_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   str     q2, [x1], #16                   \n"


                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 


                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   ldr     q0, [x3], #16                   \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"


                
                "   ldr     q1, [x3], #16                   \n"
                
                
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_PACK_K1                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

 

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"




                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"

                "   add     x0, x0, x5                    \n" 

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_PACK_K2                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x22]                  \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"


                "   str     q2, [x1], #16                   \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x22, #16]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"


    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_12_PACK_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                "   ldr     q6, [x3], #16                   \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"



    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_12_PACK_K4                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"
                
                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"


                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"



    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N7_12_PACK_K5                              \n"

    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                "   ldr     q6, [x3], #16                   \n"
    
                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                "   add     x22, x22, x5                    \n"

                "   ldr     q2, [x23]                        \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                //update img row 1 col 1
                "   ldr     q3, [x23, #16]                   \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_PACK_K6                              \n"

                "   fmla    v9.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v13.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[1]          \n"



    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_PACK_K7                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"
                


                "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"


                //update kernel 
                "   ldr     q7, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"

                "   add     x23, x23, x5                    \n"             
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_PACK_K8                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel
                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0]                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                //update kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x0, #16]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

    ".endm                                                  \n"
    

    
    ".macro M8N7_12_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                
                
                "   st3     {v16.s, v17.s, v18.s}[0], [x4]    \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x10]    \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x11]    \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x12]    \n"
                

                

                "   st3     {v20.s, v21.s, v22.s}[0], [x13]   \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x14]   \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x15]   \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x16]   \n"

                


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_12_PACK_END                             \n"
                
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16 \n"
                /*
                "   st3     {v16.s, v17.s, v18.s}[0], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x28], #12     \n"
                
                "   st3     {v20.s, v21.s, v22.s}[0], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x28], #12     \n"
                */
                "   st2     {v16.s, v17.s}[0], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[1], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[2], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[3], [x28], #8     \n"
                
                "   st2     {v20.s, v21.s}[0], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x28], #8     \n"
                

                
                "   str     q18, [x28], #16     \n"
                "   str     q22, [x28], #16     \n"

                
                
                
                //4
                "   ldr     q0, [x4]                   \n"
                "   ldr     q1, [x10]                   \n"
                "   ldr     q2, [x11]                   \n"
                "   ldr     q3, [x12]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"

                //4
                "   ldr     q0, [x13]                   \n"
                "   ldr     q1, [x14]                   \n"
                "   ldr     q2, [x15]                   \n"
                "   ldr     q3, [x16]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"

                //2
                "   ld1     {v0.2s}, [x4]                   \n"
                "   ld1     {v1.2s}, [x10]                   \n"
                "   ld1     {v2.2s}, [x11]                   \n"
                "   ld1     {v3.2s}, [x12]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x4], #8                   \n"
                "   st1     {v9.2s}, [x10], #8                   \n"
                "   st1     {v10.2s}, [x11], #8                   \n"
                "   st1     {v11.2s}, [x12], #8                   \n"

                 //2
                "   ld1     {v0.2s}, [x13]                   \n"
                "   ld1     {v1.2s}, [x14]                   \n"
                "   ld1     {v2.2s}, [x15]                   \n"
                "   ld1     {v3.2s}, [x16]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x13], #8                   \n"
                "   st1     {v9.2s}, [x14], #8                   \n"
                "   st1     {v10.2s}, [x15], #8                   \n"
                "   st1     {v11.2s}, [x16], #8                   \n"
                
                //1
                
                "   ld1     {v0.s}[0], [x4]                   \n"
                "   ld1     {v0.s}[1], [x10]                   \n"
                "   ld1     {v0.s}[2], [x11]                   \n"
                "   ld1     {v0.s}[3], [x12]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x4]                  \n"
                "   st1     {v8.s}[1], [x10]                  \n"
                "   st1     {v8.s}[2], [x11]                  \n"
                "   st1     {v8.s}[3], [x12]                  \n"

                //1
                
                "   ld1     {v0.s}[0], [x13]                   \n"
                "   ld1     {v0.s}[1], [x14]                   \n"
                "   ld1     {v0.s}[2], [x15]                   \n"
                "   ld1     {v0.s}[3], [x16]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x13]                  \n"
                "   st1     {v8.s}[1], [x14]                  \n"
                "   st1     {v8.s}[2], [x15]                  \n"
                "   st1     {v8.s}[3], [x16]                  \n"
                
                
    
    ".endm                                                  \n"
    
    "M8N7_12_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x23, %[img_start_2]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x29, sp                            \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N7_12_PACK_BEGIN                     \n"

    "   sub x29, x29, #224                        \n"
    
    "   mov x28, x29                            \n"
    
    "   b M8N7_12_PACK_LOOP                               \n"
    
    "M8N7_12_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N7_12_PACK_K0                     \n"

    "M8N7_12_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N7_12_PACK_K1                                 \n"
    "   uKERNEL_M8N7_12_PACK_K2                                 \n"
    "   uKERNEL_M8N7_12_PACK_K3                                 \n"
    "   uKERNEL_M8N7_12_PACK_K4                                 \n"
    "   uKERNEL_M8N7_12_PACK_K5                                 \n"
    "   uKERNEL_M8N7_12_PACK_K6                                 \n"
    "   uKERNEL_M8N7_12_PACK_K7                                 \n"

    "   beq     M8N7_12_PACK_END_K                        \n"

    "   uKERNEL_M8N7_12_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N7_12_PACK_MAIN_K                       \n" 




    "M8N7_12_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N7_12_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N7_12_PACK_END                    \n"

    "   b    M8N7_12_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N7_12_PACK:                               \n"
    "   M8N7_12_PACK_ADD_C                                   \n"
    
    
    "M8N7_12_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_start_2]                 "m"     (img_start_2),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N5_12_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
            asm volatile(
                    ".macro uKERNEL_M8N5_12_PACK_BEGIN                      \n"
                        "   ldr     q0, [x3], #16                   \n"
                        "   ldr     q1, [x3], #16                   \n"
                        "   ldr     q2, [x0], #16                   \n"     //ldr q2 x0
                        
                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x0, #64]            \n"     //p x0


                        "   add     x10, x4, x6                     \n"

                        "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmul    v11.4s, v0.4s, v2.s[3]          \n"

                        "   str     q2, [x1], #16                   \n"

                        "   ld1     {v3.2s}, [x0]                   \n"
                        "   add     x11, x10, x6                    \n"

                        "   fmul    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmul    v15.4s, v1.4s, v2.s[3]          \n"

                        "   st1     {v3.2s}, [x1], #8                   \n"

                        "   ldr     q6, [x3], #16                   \n"
                        "   add     x12, x11, x6                    \n"
                        "   fmul    v16.4s, v0.4s, v3.s[0]          \n"

                        "   ldr     q7, [x3], #16                   \n"
                        "   add     x13, x12, x6                    \n"


                        "   add     x14, x13, x6                    \n"

                        "   fmul    v20.4s, v1.4s, v3.s[0]          \n"


                        "   add     x15, x14, x6                    \n"

                        "   prfm    PLDL2KEEP, [x4, #64]            \n"
                        "   prfm    PLDL2KEEP, [x10, #64]           \n"
                        "   prfm    PLDL2KEEP, [x11, #64]           \n"
                        "   prfm    PLDL2KEEP, [x12, #64]           \n"


                        "   add     x16, x15, x6                    \n"

                        "   prfm    PLDL2KEEP, [x13, #64]           \n"
                        "   prfm    PLDL2KEEP, [x14, #64]           \n"
                        "   prfm    PLDL2KEEP, [x15, #64]           \n"
                        "   prfm    PLDL2KEEP, [x16, #64]           \n"


                        ".endm                                      \n"
                    
                    ".macro uKERNEL_M8N5_12_PACK_K0                         \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   str     q2, [x1], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"
                        
                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"


                        "   st1     {v3.2s}, [x1], #8                   \n"

                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"


                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N5_12_PACK_K1     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                        "   sub     x0, x0, #16                     \n"   
                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                        "   add     x0, x0, x5                    \n"       //add x0
                        "   ldr     q1, [x3], #16                   \n"
                        "   prfm    PLDL1KEEP, [x22, #64]            \n"            //p 22
                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"


                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"



                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_PACK_K2     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                        "   ldr     q2, [x22], #16                  \n"     //ldr q2 x22


                        "   str     q2, [x1], #16                   \n"

                        "   ldr     q7, [x3], #16                   \n"

                        "   ld1     {v3.2s}, [x22]                   \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_PACK_K3     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                        "   st1     {v3.2s}, [x1], #8                   \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v16.4s, v6.4s, v3.s[0]          \n"


                        

                        "   fmla    v20.4s, v7.4s, v3.s[0]          \n"


                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_PACK_K4     \n"


                        "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                        "   sub     x22, x22, #16                     \n"     //sub x22
                        "   ldr     q6, [x3], #16                   \n"


                        "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v1.4s, v3.s[0]          \n"
                        "   add     x22, x22, x5                    \n"       //add x22
                        "   ldr     q7, [x3], #16                   \n"

                        "   fmla    v16.4s, v0.4s, v3.s[1]          \n"


                        "   fmla    v20.4s, v1.4s, v3.s[1]          \n"


                        "   prfm    PLDL1KEEP, [x3, #256]           \n"
                        "   prfm    PLDL1KEEP, [x23, #64]            \n"

                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_PACK_K5     \n"

                        "   ldr     q0, [x3], #16                   \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   ldr     q2, [x23], #16                        \n"  


                        "   str     q2, [x1], #16                   \n"


                        "   ld1     {v3.2s}, [x23]                   \n"


                    ".endm              \n"

                    ".macro uKERNEL_M8N5_12_PACK_K6     \n"

                        "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                        "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                        "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                        "   st1     {v3.2s}, [x1], #8                   \n"

                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v1.4s, v2.s[0]          \n"
                        "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                        "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                        "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                        "   ldr     q7, [x3], #16                   \n"


                        "   fmla    v16.4s, v0.4s, v3.s[0]          \n"



                        "   fmla    v20.4s, v1.4s, v3.s[0]          \n"




                    ".endm              \n"    
                    
                    ".macro uKERNEL_M8N5_12_PACK_K7     \n"



                        "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                        "   sub     x23, x23, #16                    \n"    //sub x23



                        "   fmla    v16.4s, v6.4s, v3.s[1]          \n"

                        "   add     x23, x23, x5                    \n"     //add x23
                        "   ldr     q6, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                        "   fmla    v20.4s, v7.4s, v3.s[1]          \n"


                        "   ldr     q7, [x3], #16                   \n"
                    ".endm              \n"
                 
                    ".macro uKERNEL_M8N5_12_PACK_K8     \n"

                        "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                        "   prfm    PLDL1KEEP, [x0, #64]            \n"         //p
                        "   ldr     q0, [x3], #16                   \n"




                        "   prfm    PLDL1KEEP, [x3, #256]           \n"

                        "   ldr     q1, [x3], #16                   \n"

                        "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                        "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                        
                        "   ldr     q2, [x0], #16                        \n"        //ldr q2 x0
                        
                        "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                        "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                        "   ld1     {v3.2s}, [x0]                   \n"
                        



                    ".endm              \n"
                    
                    ".macro M8N5_12_PACK_ADD_C       \n"

                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                "   st1     {v16.s}[0], [x4]        \n"
                "   st1     {v16.s}[1], [x10]        \n"
                "   st1     {v16.s}[2], [x11]        \n"
                "   st1     {v16.s}[3], [x12]        \n"
                
                "   st1     {v20.s}[0], [x13]        \n"
                "   st1     {v20.s}[1], [x14]        \n"
                "   st1     {v20.s}[2], [x15]        \n"
                "   st1     {v20.s}[3], [x16]        \n"

                    ".endm              \n"
                    
                    ".macro uKERNEL_M8N5_12_PACK_END       \n"

                    "   ldr     q0, [x4]                        \n"
                    "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                    "   ldr     q1, [x10]                       \n"
                    "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v6.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"

                    "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                    "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                    "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"
                    "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                    

                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"

                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4], #16                        \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"

                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10], #16                       \n"
                    "   str     q16, [x28], #16     \n"
                    "   str     q20, [x28], #16     \n"
                    
                    
                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11], #16                      \n"
                    "   str     q11, [x12], #16                      \n"

                    "   ldr     q0, [x13]                        \n"
                    "   ldr     q8, [x29], #16                  \n"
                    
                    "   ldr     q1, [x14]                       \n"
                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    "   ldr     q2, [x15]                       \n"
                    "   ldr     q3, [x16]                       \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    
                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q11, [x29], #16                 \n"
                    "   fadd    v10.4s, v10.4s, v2.4s             \n"
                    
                    "   str     q8, [x13], #16                        \n"
                    "   str     q9, [x14], #16                       \n"
                    
                    "   fadd    v11.4s, v11.4s, v3.4s             \n"
                    "   str     q10, [x15], #16                      \n"
                    "   str     q11, [x16], #16                      \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   ld1     {v0.s}[0], [x4]                   \n"
                    "   ld1     {v0.s}[1], [x10]                   \n"
                    "   ld1     {v0.s}[2], [x11]                   \n"
                    "   ld1     {v0.s}[3], [x12]                   \n"

                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    
                    
                    "   ldr     q9, [x29], #16                  \n"
                    "   ld1     {v1.s}[0], [x13]                   \n"
                    "   ld1     {v1.s}[1], [x14]                   \n"
                    "   ld1     {v1.s}[2], [x15]                   \n"
                    "   ld1     {v1.s}[3], [x16]                   \n"
                    
                    "   st1     {v8.s}[0], [x4]                  \n"
                    "   st1     {v8.s}[1], [x10]                  \n"
                    "   st1     {v8.s}[2], [x11]                  \n"
                    "   st1     {v8.s}[3], [x12]                  \n"
                    
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   st1     {v9.s}[0], [x13]                  \n"
                    "   st1     {v9.s}[1], [x14]                  \n"
                    "   st1     {v9.s}[2], [x15]                  \n"
                    "   st1     {v9.s}[3], [x16]                  \n"


                    ".endm                                          \n" 
            
            "M8N5_12_PACK_ENTRANCE:                                                       \n"
            "   ldr x0, %[img_start_0]                    \n"
            "   ldr x22, %[img_start_1]                      \n"
            "   ldr x23, %[img_start_2]                      \n"
            "   ldr x1, %[img_pack]                     \n"
            "   ldr x3, %[kernal]                       \n"
            "   ldr x4, %[out]                          \n"
            "   ldr x7, %[ic_count]                     \n"
            "   ldr x6, %[stride_out_size]             \n"
            "   ldr x5, %[stride_in_size]             \n"
            "   mov x29, sp                            \n"
            "   prfm PLDL1KEEP, [x0, #128]              \n"
            "   prfm PLDL1KEEP, [x3, #256]              \n"
            
            "   ldr x8, %[ic]                          \n"
            
            "   sub x29, x29, #160                        \n"
            "   subs x7, x7, #1                         \n"
            
            "   uKERNEL_M8N5_12_PACK_BEGIN                     \n"
            "   mov x28, x29                            \n"
            
            
            "   b M8N5_12_PACK_LOOP                               \n"
            
            "M8N5_12_PACK_MAIN_K:                                  \n"
                "   uKERNEL_M8N5_12_PACK_K0                     \n"

            "M8N5_12_PACK_LOOP:                                  \n"
            "   uKERNEL_M8N5_12_PACK_K1                                 \n"
            "   uKERNEL_M8N5_12_PACK_K2                                 \n"
            "   uKERNEL_M8N5_12_PACK_K3                                 \n"
            "   uKERNEL_M8N5_12_PACK_K4                                 \n"
            "   uKERNEL_M8N5_12_PACK_K5                                 \n"
            "   uKERNEL_M8N5_12_PACK_K6                                 \n"
            "   uKERNEL_M8N5_12_PACK_K7                                 \n"

            "   beq     M8N5_12_PACK_END_K                        \n"

            "   uKERNEL_M8N5_12_PACK_K8                                 \n"

            "   subs    x7, x7, #1                 \n"
            "   b       M8N5_12_PACK_MAIN_K                       \n" 




            "M8N5_12_PACK_END_K:                                     \n"
            //ic = 0, store
            "   cmp     x8, #0                          \n"
            "   beq     END_uKERNEL_M8N5_12_PACK                     \n"

            //ic != 0
            "   uKERNEL_M8N5_12_PACK_END                    \n"

            "   b    M8N5_12_PACK_END                             \n"
            
            //ic = 0, add
            "END_uKERNEL_M8N5_12_PACK:                               \n"
            "   M8N5_12_PACK_ADD_C                                   \n"
            
            
            "M8N5_12_PACK_END:                                       \n"
            :

            :
                [img_start_0]                 "m"     (img_start_0),
                [img_start_1]                 "m"     (img_start_1),
                [img_start_2]                 "m"     (img_start_2),
                [img_pack]                    "m"     (img_pack),
                [kernal]                    "m"     (kernal),
                [out]                       "m"     (out),
                [ic_count]                  "m"     (ic_count),
                [ic]                        "m"     (ic),
                [stride_out_size]           "m"     (stride_out_size),
                [stride_in_size]            "m"     (stride_in_size)
                
            :
                "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
                "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
                "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
                "x26", "x27", "x28","x29","x30",
                "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
                "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
                "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
                "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
            );
            
            
}

void direct_3x3_M8N4_12_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
            ".macro uKERNEL_M8N4_12_PACK_BEGIN                      \n"
                "   ldr     q0, [x3], #16                   \n"
                "   ldr     q1, [x3], #16                   \n"

                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                "   prfm    PLDL1KEEP, [x0, #64]            \n"     //p x0


                "   add     x10, x4, x6                     \n"


                "   ldr     q3, [x0], #16                   \n"     //ldr q2 x0
                "   add     x11, x10, x6                    \n"

                "   ldr     q6, [x3], #16                   \n"
                "   add     x12, x11, x6                    \n"

                "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"
                "   add     x13, x12, x6                    \n"

                "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmul    v19.4s, v0.4s, v3.s[3]          \n"

                "   add     x14, x13, x6                    \n"

                "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

                "   add     x15, x14, x6                    \n"

                "   prfm    PLDL2KEEP, [x4, #64]            \n"
                "   prfm    PLDL2KEEP, [x10, #64]           \n"
                "   prfm    PLDL2KEEP, [x11, #64]           \n"
                "   prfm    PLDL2KEEP, [x12, #64]           \n"

                "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmul    v23.4s, v1.4s, v3.s[3]          \n"

                "   add     x16, x15, x6                    \n"

                "   prfm    PLDL2KEEP, [x13, #64]           \n"
                "   prfm    PLDL2KEEP, [x14, #64]           \n"
                "   prfm    PLDL2KEEP, [x15, #64]           \n"
                "   prfm    PLDL2KEEP, [x16, #64]           \n"


                ".endm                                      \n"
            
            ".macro uKERNEL_M8N4_12_PACK_K0                         \n"



                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

            ".endm              \n"
            
            ".macro uKERNEL_M8N4_12_PACK_K1     \n"
                "   ld1     {v4.2s}, [x0], #8                   \n" //ld1 q4 x0

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
                "   sub     x0, x0, #24                     \n"     //sub x0

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   add     x0, x0, x5                    \n"       //add x0

                "   st1     {v4.2s}, [x1], #8                   \n"


            ".endm              \n"

            ".macro uKERNEL_M8N4_12_PACK_K2     \n"



                "   ldr     q6, [x3], #16                   \n"




                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"


                "   ldr     q3, [x22], #16                   \n"     //ldr q3 x22

            ".endm              \n"

            ".macro uKERNEL_M8N4_12_PACK_K3     \n"


                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"

            ".endm              \n"

            ".macro uKERNEL_M8N4_12_PACK_K4     \n"

                "   ld1     {v4.2s}, [x22], #8               \n"        //ld1 q4 x22


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"
                
                "   sub     x22, x22, #24                     \n"     //sub x22
                
                "   st1     {v4.2s}, [x1], #8                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   add     x22, x22, x5                    \n"       //add x22

                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                "   prfm    PLDL1KEEP, [x23, #64]            \n"

            ".endm              \n"

            ".macro uKERNEL_M8N4_12_PACK_K5     \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


                "   ldr     q3, [x23], #16                   \n"        //ldr q3 23 


            ".endm              \n"

            ".macro uKERNEL_M8N4_12_PACK_K6     \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"



            ".endm              \n"    
            
            ".macro uKERNEL_M8N4_12_PACK_K7     \n"


                "   ld1     {v4.2s}, [x23], #8                   \n"    //ld1 q4 23
                

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                
                "   ldr     q6, [x3], #16                   \n"
                
                "   sub     x23, x23, #24                    \n"    //sub x23

                "   st1     {v4.2s}, [x1], #8                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   add     x23, x23, x5                    \n"     //add x23

            ".endm              \n"
         
            ".macro uKERNEL_M8N4_12_PACK_K8     \n"

                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   ldr     q1, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                
                "   ldr     q3, [x0], #16                   \n"             //ldr q2 x0
                
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"


            ".endm              \n"
            
            ".macro M8N4_12_PACK_ADD_C       \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"

                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]      \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                "   add     sp, sp, #128                    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

            ".endm              \n"
            
            ".macro uKERNEL_M8N4_12_PACK_END       \n"
                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                "   ldr     q8, [x4]                   \n"
                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10]                  \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11]                 \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4]                   \n"

                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10]                  \n"

                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11]                 \n"
                "   str     q11, [x12]                 \n"




                "   ldr     q8, [x13]                  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                "   ldr     q9, [x14]                  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                "   ldr     q10, [x15]                 \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                "   ldr     q11, [x16]                 \n"



                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                  \n"

                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                  \n"

                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15]                 \n"
                "   str     q11, [x16]                 \n"


            ".endm                                          \n" 
    
    "M8N4_12_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x23, %[img_start_2]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #128                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N4_12_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N4_12_PACK_LOOP                               \n"
    
    "M8N4_12_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N4_12_PACK_K0                     \n"

    "M8N4_12_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N4_12_PACK_K1                                 \n"
    "   uKERNEL_M8N4_12_PACK_K2                                 \n"
    "   uKERNEL_M8N4_12_PACK_K3                                 \n"
    "   uKERNEL_M8N4_12_PACK_K4                                 \n"
    "   uKERNEL_M8N4_12_PACK_K5                                 \n"
    "   uKERNEL_M8N4_12_PACK_K6                                 \n"
    "   uKERNEL_M8N4_12_PACK_K7                                 \n"

    "   beq     M8N4_12_PACK_END_K                        \n"

    "   uKERNEL_M8N4_12_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N4_12_PACK_MAIN_K                       \n" 




    "M8N4_12_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N4_12_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N4_12_PACK_END                    \n"

    "   b    M8N4_12_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N4_12_PACK:                               \n"
    "   M8N4_12_PACK_ADD_C                                   \n"
    
    
    "M8N4_12_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_start_2]                 "m"     (img_start_2),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N2_12_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_start_2, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
            ".macro uKERNEL_M8N2_12_PACK_BEGIN                      \n"
                "   ldr     q0, [x3], #16                   \n"
                "   ldr     q1, [x3], #16                   \n"

                
                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                "   prfm    PLDL1KEEP, [x0, #64]            \n"     //p x0


                "   add     x10, x4, x6                     \n"


                "   ldr     q3, [x0]                   \n"     //ldr q2 x0
                "   add     x11, x10, x6                    \n"

                "   ldr     q6, [x3], #16                   \n"
                "   add     x12, x11, x6                    \n"

                "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"
                "   add     x13, x12, x6                    \n"


                "   add     x14, x13, x6                    \n"

                "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

                "   add     x15, x14, x6                    \n"

                "   prfm    PLDL2KEEP, [x4, #64]            \n"
                "   prfm    PLDL2KEEP, [x10, #64]           \n"
                "   prfm    PLDL2KEEP, [x11, #64]           \n"
                "   prfm    PLDL2KEEP, [x12, #64]           \n"


                "   add     x16, x15, x6                    \n"

                "   prfm    PLDL2KEEP, [x13, #64]           \n"
                "   prfm    PLDL2KEEP, [x14, #64]           \n"
                "   prfm    PLDL2KEEP, [x15, #64]           \n"
                "   prfm    PLDL2KEEP, [x16, #64]           \n"


                ".endm                                      \n"
            
            ".macro uKERNEL_M8N2_12_PACK_K0                         \n"



                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"


                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

            ".endm              \n"
            
            ".macro uKERNEL_M8N2_12_PACK_K1     \n"


                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                
                "   ldr     q1, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                "   add     x0, x0, x5                    \n"       //add x0


            ".endm              \n"

            ".macro uKERNEL_M8N2_12_PACK_K2     \n"



                "   ldr     q6, [x3], #16                   \n"




                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   ldr     q3, [x22]                   \n"     //ldr q3 x22

            ".endm              \n"

            ".macro uKERNEL_M8N2_12_PACK_K3     \n"


                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"


                "   ldr     q1, [x3], #16                   \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"

            ".endm              \n"

            ".macro uKERNEL_M8N2_12_PACK_K4     \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                "   add     x22, x22, x5                    \n"       //add x22

                "   prfm    PLDL1KEEP, [x3, #256]           \n"


            ".endm              \n"

            ".macro uKERNEL_M8N2_12_PACK_K5     \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   ldr     q3, [x23]                   \n"        //ldr q3 23 


            ".endm              \n"

            ".macro uKERNEL_M8N2_12_PACK_K6     \n"

                "   ldr     q6, [x3], #16                   \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"


                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"




            ".endm              \n"    
            
            ".macro uKERNEL_M8N2_12_PACK_K7     \n"
                

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                
                "   ldr     q6, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                "   ldr     q7, [x3], #16                   \n"

                "   add     x23, x23, x5                    \n"     //add x23

            ".endm              \n"
         
            ".macro uKERNEL_M8N2_12_PACK_K8     \n"

                "   ldr     q0, [x3], #16                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"



                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   ldr     q1, [x3], #16                   \n"
                


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                
                "   ldr     q3, [x0]                   \n"             //ldr q2 x0
                



            ".endm              \n"
            
                ".macro M8N2_12_PACK_ADD_C       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"


                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                    
                    "   st2     {v16.s, v17.s}[0], [x4]      \n"
                    "   st2     {v16.s, v17.s}[1], [x10]      \n"
                    "   st2     {v16.s, v17.s}[2], [x11]      \n"
                    "   st2     {v16.s, v17.s}[3], [x12]      \n"


                    "   add     sp, sp, #64                    \n"

                    "   st2     {v20.s, v21.s}[0], [x13]      \n"
                    "   st2     {v20.s, v21.s}[1], [x14]      \n"
                    "   st2     {v20.s, v21.s}[2], [x15]      \n"
                    "   st2     {v20.s, v21.s}[3], [x16]      \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N2_12_PACK_END       \n"


                    "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                    "   fmla    v20.4s, v7.4s, v3.s[2]          \n"

                "   st2     {v16.s, v17.s}[0], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[1], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[2], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[3], [x29], #8       \n"

                "   st2     {v20.s, v21.s}[0], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x29], #8     \n"
                
                "   sub     x29, x29, #64                   \n"
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v1.2s}, [x10]                       \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"


                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"

                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v0.2s}, [x12]                       \n"
                
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"


                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"


                "   ld1     {v8.2s}, [x13]                       \n"
                "   ld1     {v9.2s}, [x14]                       \n"
                "   ld1     {v10.2s}, [x15]                      \n"
                "   ld1     {v11.2s}, [x16]                      \n"



                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   st1     {v8.2s}, [x13]                       \n"


                "   ld1     {v1.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   st1     {v9.2s}, [x14]                       \n"

                "   ld1     {v2.2s}, [x29], #8                  \n"
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   st1     {v10.2s}, [x15]                      \n"

                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"
                "   st1     {v11.2s}, [x16]                      \n"
                "   add     sp, sp, #64                    \n"


                ".endm                                          \n" 
    
    "M8N2_12_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x23, %[img_start_2]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #64                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N2_12_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N2_12_PACK_LOOP                               \n"
    
    "M8N2_12_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N2_12_PACK_K0                     \n"

    "M8N2_12_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N2_12_PACK_K1                                 \n"
    "   uKERNEL_M8N2_12_PACK_K2                                 \n"
    "   uKERNEL_M8N2_12_PACK_K3                                 \n"
    "   uKERNEL_M8N2_12_PACK_K4                                 \n"
    "   uKERNEL_M8N2_12_PACK_K5                                 \n"
    "   uKERNEL_M8N2_12_PACK_K6                                 \n"
    "   uKERNEL_M8N2_12_PACK_K7                                 \n"

    "   beq     M8N2_12_PACK_END_K                        \n"

    "   uKERNEL_M8N2_12_PACK_K8                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N2_12_PACK_MAIN_K                       \n" 




    "M8N2_12_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N2_12_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N2_12_PACK_END                    \n"

    "   b    M8N2_12_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N2_12_PACK:                               \n"
    "   M8N2_12_PACK_ADD_C                                   \n"
    
    
    "M8N2_12_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_start_2]                 "m"     (img_start_2),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}




void direct_3x3_M8N12_20_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_20_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"
            "   str     q2, [x1], #16                   \n"

            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[2]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   str     q4, [x1], #16                   \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[2]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v3.s[3]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[0]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[1]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[2]          \n"
            
            //update kernel

            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            
            "   fmul    v28.4s, v1.4s, v3.s[3]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[2]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_PACK_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_20_PACK_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                
                "   ldr     q7, [x3], #16                   \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_20_PACK_K2                              \n"
                "   ld1     {v5.2s}, [x0], #8               \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"
                
                "   st1     {v5.2s}, [x1], #8                   \n"
                
                "   sub     x0, x0, #56                     \n"
                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_PACK_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   str     q4, [x1], #16                   \n"

                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[2]          \n"

                "   fmla    v24.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[2]          \n"

                "   fmla    v28.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[2]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_PACK_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v6.4s, v3.s[3]          \n"
                "   sub     x22, x22, #56                   \n"             //22 sub

                "   st1     {v5.2s}, [x1], #8                   \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v7.4s, v3.s[3]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                
                "   fmla    v24.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v6.4s, v4.s[3]          \n"
                
                "   fmla    v28.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v7.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_PACK_K5                              \n"
    
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_20_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_20_PACK_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"


                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"
                
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"

                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_20_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_20_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_20_PACK_LOOP                               \n"
    
    "M8N12_20_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_20_PACK_K0                     \n"

    "M8N12_20_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N12_20_PACK_K1                                 \n"
    "   uKERNEL_M8N12_20_PACK_K2                                 \n"
    "   uKERNEL_M8N12_20_PACK_K3                                 \n"
    "   uKERNEL_M8N12_20_PACK_K4                                 \n"

    "   beq     M8N12_20_PACK_END_K                        \n"

    "   uKERNEL_M8N12_20_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_20_PACK_MAIN_K                       \n" 




    "M8N12_20_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_20_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N12_20_PACK_END                    \n"

    "   b    M8N12_20_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_20_PACK:                               \n"
    "   M8N12_20_PACK_ADD_C                                   \n"
    
    
    "M8N12_20_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N12_21_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N12_21_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            "   str     q2, [x1], #16                   \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   str     q3, [x1], #16                   \n"

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

            "   str     q4, [x1], #16                   \n"

            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"

            "   fmul    v26.4s, v0.4s, v4.s[2]          \n"
            "   fmul    v27.4s, v0.4s, v4.s[3]          \n"
            
            //update kernel

            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"
            "   fmul    v30.4s, v1.4s, v4.s[2]          \n"
            "   fmul    v31.4s, v1.4s, v4.s[3]          \n"

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_PACK_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N12_21_PACK_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   ld1     {v5.2s}, [x0], #8               \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[0]          \n"

                "   st1     {v5.2s}, [x1], #8                   \n"

                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q7, [x3], #16                   \n"
                "   fmla    v30.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[0]          \n"

    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N12_21_PACK_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #56                     \n"
                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v6.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[1]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v7.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[1]          \n"
                
                //update img row 1 col 2
                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_PACK_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v26.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v27.4s, v0.4s, v4.s[3]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v30.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v31.4s, v1.4s, v4.s[3]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_PACK_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v5.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                "   sub     x22, x22, #56                   \n"             //22 sub

                "   st1     {v5.2s}, [x1], #8                   \n"

                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                
                
                
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"
                "   fmla    v26.4s, v6.4s, v4.s[3]          \n"
                "   fmla    v27.4s, v6.4s, v5.s[0]          \n"
                
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"
                "   fmla    v30.4s, v7.4s, v4.s[3]          \n"
                "   fmla    v31.4s, v7.4s, v5.s[0]          \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_PACK_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
                "   ldr     q4, [x0], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N12_21_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"

                "   add     sp, sp, #384                       \n"


                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [x4], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [x10], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [x11], #16    \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [x12], #16    \n"
                

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [x13], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [x14], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [x15], #16    \n"
                
                //update sp pointer(no use)
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [x16], #16    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N12_21_PACK_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[3]          \n"
                "   fmla    v26.4s, v0.4s, v5.s[0]          \n"
                "   fmla    v27.4s, v0.4s, v5.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[3]          \n"
                "   fmla    v30.4s, v1.4s, v5.s[0]          \n"
                "   fmla    v31.4s, v1.4s, v5.s[1]          \n"
                
                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                       \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"
                //v8-v11[0]
                "   ldr     q8, [x29], #16                  \n"
                
                //v8-v11[1]
                "   ldr     q9, [x29], #16                  \n"
                
                //v8-v11[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v8-v11[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   str     q8, [x4]                        \n"
                "   str     q9, [x10]                       \n"

                //v8-v11[3]
                "   ldr     q10, [x29], #16                 \n"
                
                
                "   ldr     q2, [x11]                       \n"
                
                //v8-v11[3] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"

                //v8-v11[4]
                "   ldr     q11, [x29], #16                 \n"
                
                
                "   ldr     q0, [x12]                       \n"
                //v8-v11[3] - x12
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"



                "   ldr     q8, [x13]                       \n"
                "   ldr     q9, [x14]                       \n"
                
                "   ldr     q10, [x15]                      \n"
                "   ldr     q11, [x16]                      \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"


                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                //v12-v15[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                //v12-v15[0]
                "   ldr     q1, [x29], #16                  \n"
                
                //v12-v15[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"
                
                //v12-v15[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v12-v15[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"
                
                //v12-v15[3]
                "   ldr     q0, [x29], #16                  \n"
                
                //v12-v15[3] - x16
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"



                
                "   ldr     q8, [x4, #16]                   \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                "   ldr     q9, [x10, #16]                  \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                "   ldr     q10, [x11, #16]                 \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                "   ldr     q11, [x12, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"


                //v16-v19[0] 
                "   ldr     q0, [x29], #16                  \n"
                
                //v16-v19[0] - x4
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v16-v19[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v16-v19[1] - x10
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #16]                   \n"

                //v16-v19[2]
                "   ldr     q2, [x29], #16                  \n"
                
                //v16-v19[2] - x11
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #16]                  \n"

                //v16-v19[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v16-v19[3] - x12
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #16]                 \n"
                "   str     q11, [x12, #16]                 \n"




                "   ldr     q8, [x13, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"

                "   ldr     q9, [x14, #16]                  \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"

                "   ldr     q10, [x15, #16]                 \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"

                "   ldr     q11, [x16, #16]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[0], [sp], #16      \n"


                //v20-v23[0]
                "   ldr     q0, [x29], #16                  \n"
                
                //v20-v23[0] - x13
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v20-v23[1]
                "   ldr     q1, [x29], #16                  \n"
                
                //v20-v23[1] - x14
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #16]                  \n"

                //v20-v23[2] 
                "   ldr     q2, [x29], #16                  \n"
                
                //v20-v23[2] - x15
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #16]                  \n"

                //v20-v23[3]
                "   ldr     q3, [x29], #16                  \n"
                
                //v20-v23[3] - x16
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #16]                 \n"
                "   str     q11, [x16, #16]                 \n"



                "   ldr     q8, [x4, #32]                   \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[1], [sp], #16      \n"

                "   ldr     q9, [x10, #32]                  \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[2], [sp], #16      \n"

                "   ldr     q10, [x11, #32]                 \n"

                "   st4     {v24.s, v25.s, v26.s, v27.s}[3], [sp], #16      \n"

                "   ldr     q11, [x12, #32]                 \n"

                "   st4     {v28.s, v29.s, v30.s, v31.s}[0], [sp], #16      \n"


                //v24-v27[0] - x4
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v24-v27[1] - x10
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4, #32]                   \n"

                //v24-v27[2] - x11
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10, #32]                  \n"

                //v24-v27[3] - x12
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x11, #32]                 \n"
                "   str     q11, [x12, #32]                 \n"



                "   ldr     q8, [x13, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[1], [sp], #16      \n"
                "   ldr     q9, [x14, #32]                  \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[2], [sp], #16      \n"
                "   ldr     q10, [x15, #32]                 \n"
                "   st4     {v28.s, v29.s, v30.s, v31.s}[3], [sp], #16      \n"
                "   ldr     q11, [x16, #32]                 \n"

                //v28-v31[0] - x13
                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                //v28-v31[1] - x14
                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13, #32]                  \n"

                //v28-v31[2] - x15
                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14, #32]                  \n"


                //v28-v31[3] - x16
                "   ldr     q3, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v3.4s           \n"
                "   str     q10, [x15, #32]                 \n"
                "   str     q11, [x16, #32]                 \n"
    
    ".endm                                                  \n"
    
    "M8N12_21_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #384                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N12_21_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N12_21_PACK_LOOP                               \n"
    
    "M8N12_21_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N12_21_PACK_K0                     \n"

    "M8N12_21_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N12_21_PACK_K1                                 \n"
    "   uKERNEL_M8N12_21_PACK_K2                                 \n"
    "   uKERNEL_M8N12_21_PACK_K3                                 \n"
    "   uKERNEL_M8N12_21_PACK_K4                                 \n"

    "   beq     M8N12_21_PACK_END_K                        \n"

    "   uKERNEL_M8N12_21_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N12_21_PACK_MAIN_K                       \n" 




    "M8N12_21_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N12_21_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N12_21_PACK_END                    \n"

    "   b    M8N12_21_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N12_21_PACK:                               \n"
    "   M8N12_21_PACK_ADD_C                                   \n"
    
    
    "M8N12_21_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N10_22_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N10_22_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            "   str     q2, [x1], #16                   \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   str     q3, [x1], #16                   \n"

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img
            "   ldr     q4, [x0], #16                      \n"

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"

            "   str     q4, [x1], #16                   \n"

            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   fmul    v24.4s, v0.4s, v4.s[0]          \n"
            "   fmul    v25.4s, v0.4s, v4.s[1]          \n"

            "   add     x15, x14, x6          \n"


            "   add     x16, x15, x6          \n"

            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            
            "   fmul    v28.4s, v1.4s, v4.s[0]          \n"
            "   fmul    v29.4s, v1.4s, v4.s[1]          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_PACK_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"
                "   ldr     q0, [x3], #16                   \n"
                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"
                

                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N10_22_PACK_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                "   fmla    v24.4s, v0.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[2]          \n"



                "   fmla    v28.4s, v1.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[2]          \n"
                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N10_22_PACK_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #48                     \n"
                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[1]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[1]          \n"

                //update img row 1 col 1
                "   ldr     q3, [x22], #16                   \n"

                "   fmla    v24.4s, v6.4s, v4.s[2]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v28.4s, v7.4s, v4.s[2]          \n"

                "   ldr     q4, [x22], #16                   \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_PACK_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q4, [x1], #16                   \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

                "   fmla    v24.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v25.4s, v0.4s, v4.s[1]          \n"


                "   fmla    v28.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v29.4s, v1.4s, v4.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_PACK_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                "   sub     x22, x22, #48                   \n"             //22 sub


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                
                
                
                "   fmla    v24.4s, v6.4s, v4.s[1]          \n"
                "   fmla    v25.4s, v6.4s, v4.s[2]          \n"

                
                "   fmla    v28.4s, v7.4s, v4.s[1]          \n"
                "   fmla    v29.4s, v7.4s, v4.s[2]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_PACK_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                
                "   ldr     q3, [x0], #16                   \n"
                
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                
                "   prfm PLDL1KEEP, [x3, #256]              \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"

                "   ldr     q0, [x3], #16                   \n"
                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   ldr     q4, [x0], #16                   \n"

                
                "   ldr     q1, [x3], #16                   \n"


    ".endm                                                  \n"
    

    
    ".macro M8N10_22_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"

                
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4], #16    \n"
                "   st2     {v24.s, v25.s}[0], [x4]    \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10], #16    \n"
                "   st2     {v24.s, v25.s}[1], [x10]    \n" 
                
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11], #16    \n"
                "   st2     {v24.s, v25.s}[2], [x11]   \n"
                
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12], #16    \n"
                "   st2     {v24.s, v25.s}[3], [x12]    \n"
                
                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"

                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"


                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13], #16    \n"
                "   st2     {v28.s, v29.s}[0], [x13]    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14], #16    \n"
                "   st2     {v28.s, v29.s}[1], [x14]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15], #16    \n"
                "   st2     {v28.s, v29.s}[2], [x15]    \n"

                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16], #16    \n"
                "   st2     {v28.s, v29.s}[3], [x16]    \n"
    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N10_22_PACK_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16    \n"
                
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"



                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                
                "   fmla    v19.4s, v0.4s, v4.s[1]          \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"


                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x28], #16  \n"
                
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x28], #16  \n"
                
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x28], #16  \n"
                
                "   fmla    v23.4s, v1.4s, v4.s[1]          \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x28], #16  \n"

                "   fmla    v24.4s, v0.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x28], #16  \n"
                
                
                "   fmla    v28.4s, v1.4s, v4.s[2]          \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x28], #16  \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x28], #16  \n"

                "   st2     {v24.s, v25.s}[0], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[1], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[2], [x28], #8  \n"
                "   st2     {v24.s, v25.s}[3], [x28], #8  \n"
                
                "   st2     {v28.s, v29.s}[0], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[1], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[2], [x28], #8  \n"
                "   st2     {v28.s, v29.s}[3], [x28], #8  \n"


                        // 4*8
                        
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"
                        

                
                        // 8-------
                "   ldr     q0, [x4]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x10]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                
                "   ldr     q2, [x11]                       \n"
                "   ldr     q10, [x29], #16                 \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q3, [x12]                       \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"
    
                "   ldr     q0, [x13]                        \n"
                "   ldr     q8, [x29], #16                  \n"
                
                "   ldr     q1, [x14]                       \n"
                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                
                "   ldr     q2, [x15]                       \n"
                "   ldr     q3, [x16]                       \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                
                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q11, [x29], #16                 \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                
                "   str     q8, [x13], #16                       \n"
                "   str     q9, [x14], #16                      \n"
                
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                "   str     q10, [x15], #16                     \n"
                "   str     q11, [x16], #16                     \n"



                
                // 8
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x10]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x12]                       \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"
                
                
                //
                "   ld1     {v0.2s}, [x13]                        \n"
                "   ld1     {v8.2s}, [x29], #8                  \n"
                
                "   ld1     {v1.2s}, [x14]                       \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                
                "   ld1     {v2.2s}, [x15]                       \n"
                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   ld1     {v3.2s}, [x16]                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                
                "   st1     {v8.2s}, [x13]                       \n"
                "   st1     {v9.2s}, [x14]                      \n"
                
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                "   st1     {v10.2s}, [x15]                     \n"
                "   st1     {v11.2s}, [x16]                     \n"
                
    ".endm                                                  \n"
    
    "M8N10_22_PACK_ENTRANCE:                                                       \n"
    
    "   mov x29, sp     \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   sub x29, x29, #320                        \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x28,x29     \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N10_22_PACK_BEGIN                     \n"

    
    
    "   b M8N10_22_PACK_LOOP                               \n"
    
    "M8N10_22_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N10_22_PACK_K0                     \n"

    "M8N10_22_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N10_22_PACK_K1                                 \n"
    "   uKERNEL_M8N10_22_PACK_K2                                 \n"
    "   uKERNEL_M8N10_22_PACK_K3                                 \n"
    "   uKERNEL_M8N10_22_PACK_K4                                 \n"

    "   beq     M8N10_22_PACK_END_K                        \n"

    "   uKERNEL_M8N10_22_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N10_22_PACK_MAIN_K                       \n" 




    "M8N10_22_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N10_22_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N10_22_PACK_END                    \n"

    "   b    M8N10_22_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N10_22_PACK:                               \n"
    "   M8N10_22_PACK_ADD_C                                   \n"
    
    
    "M8N10_22_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N8_22_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N8_22_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            //update img
            "   ldr     q3, [x0], #16                      \n"

            "   str     q2, [x1], #16                   \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_PACK_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                

                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N8_22_PACK_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                "   ld1     {v4.2s}, [x0], #8               \n"
                
                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                "   st1     {v4.2s}, [x1], #8                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N8_22_PACK_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #40                     \n"
                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22], #16                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"

                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"

                "   ldr     q3, [x22], #16                   \n"
                
                //update img row 1 col 1
                
                //update img row 1 col 2

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_PACK_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_PACK_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"

                //edge :row 1 col 2
                "   ld1     {v4.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                
                "   sub     x22, x22, #40                   \n"             //22 sub
                
                "   st1     {v4.2s}, [x1], #8                   \n"
                
                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_PACK_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q0, [x3], #16                   \n"

                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
    ".macro M8N8_22_PACK_ADD_C                                   \n"
                        "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                        "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                        "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                        "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                        "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                        "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                        "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                        "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                        "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                        "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                        "   fmla    v18.4s, v0.4s, v4.s[0]          \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                        "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                        "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                        "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                        "   add     sp, sp, #256                    \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N8_22_PACK_END                             \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"



                
                
                        "   ldr     q0, [x4]                        \n"

                        "   ldr     q1, [x10]                       \n"


                        "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [sp], #16    \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [sp], #16    \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [sp], #16   \n"

                        "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [sp], #16   \n"



                        "   ldr     q8, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"


                        "   ldr     q9, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4]                        \n"


                        "   ldr     q10, [x29], #16                 \n"
                        "   ldr     q2, [x11]                       \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10]                       \n"

                        "   ldr     q11, [x29], #16                 \n"
                        "   ldr     q0, [x12]                       \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x11]                      \n"
                        "   str     q11, [x12]                      \n"




                        "   ldr     q8, [x13]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [sp], #16  \n"

                        "   ldr     q9, [x14]                       \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [sp], #16  \n"

                        "   ldr     q10, [x15]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [sp], #16  \n"

                        "   ldr     q11, [x16]                      \n"
                        "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [sp], #16 \n"


                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16  \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13]                       \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14]                       \n"

                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v0.4s           \n"
                        "   str     q10, [x15]                      \n"
                        "   str     q11, [x16]                      \n"




                        "   ldr     q8, [x4, #16]                   \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16  \n"

                        "   ldr     q9, [x10, #16]                  \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16  \n"

                        "   ldr     q10, [x11, #16]                 \n"

                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16  \n"

                        "   ldr     q11, [x12, #16]                 \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16  \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x4, #16]                   \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x10, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x11, #16]                 \n"
                        "   str     q11, [x12, #16]                 \n"




                        "   ldr     q8, [x13, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16  \n"
                        "   ldr     q9, [x14, #16]                  \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16  \n"
                        "   ldr     q10, [x15, #16]                 \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16  \n"
                        "   ldr     q11, [x16, #16]                 \n"



                        "   ldr     q0, [x29], #16                  \n"
                        "   fadd    v8.4s, v8.4s, v0.4s             \n"

                        "   ldr     q1, [x29], #16                  \n"
                        "   fadd    v9.4s, v9.4s, v1.4s             \n"
                        "   str     q8, [x13, #16]                  \n"

                        "   ldr     q2, [x29], #16                  \n"
                        "   fadd    v10.4s, v10.4s, v2.4s           \n"
                        "   str     q9, [x14, #16]                  \n"

                        "   ldr     q3, [x29], #16                  \n"
                        "   fadd    v11.4s, v11.4s, v3.4s           \n"
                        "   str     q10, [x15, #16]                 \n"
                        "   str     q11, [x16, #16]                 \n"
    
    ".endm                                                  \n"
    
    "M8N8_22_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #256                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N8_22_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N8_22_PACK_LOOP                               \n"
    
    "M8N8_22_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N8_22_PACK_K0                     \n"

    "M8N8_22_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N8_22_PACK_K1                                 \n"
    "   uKERNEL_M8N8_22_PACK_K2                                 \n"
    "   uKERNEL_M8N8_22_PACK_K3                                 \n"
    "   uKERNEL_M8N8_22_PACK_K4                                 \n"

    "   beq     M8N8_22_PACK_END_K                        \n"

    "   uKERNEL_M8N8_22_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N8_22_PACK_MAIN_K                       \n" 




    "M8N8_22_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N8_22_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N8_22_PACK_END                    \n"

    "   b    M8N8_22_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N8_22_PACK:                               \n"
    "   M8N8_22_PACK_ADD_C                                   \n"
    
    
    "M8N8_22_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N7_22_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N7_22_PACK_BEGIN                             \n"

            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0]                      \n"
            "   ldr     q1, [x3], #16                      \n"

            "   add     x10, x4, x6                     \n"
            
            "movi v8.4s, #0            \n"
            "movi v12.4s, #0            \n"
            
            "   fmul    v9.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[1]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[2]          \n"

            "   ldr     q3, [x0, #16]                      \n"
            "   str     q2, [x1], #16                   \n"

            "   fmul    v13.4s, v1.4s, v2.s[0]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[2]          \n"
            

            "   fmul    v16.4s, v0.4s, v2.s[3]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[0]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[1]          \n"

            "   add     x12, x11, x6           \n"

            "   fmul    v20.4s, v1.4s, v2.s[3]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[0]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[1]          \n"

            
            //update kernel 

            "   add     x14, x13, x6           \n"


            "   add     x15, x14, x6          \n"

            
            //update kernel

            "   add     x16, x15, x6          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            

            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_PACK_K0                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                "   str     q2, [x1], #16                   \n"

                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q0, [x3], #16                   \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"

                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N7_22_PACK_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"
                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N7_22_PACK_K2                              \n"

    
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"
                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0
                "   ldr     q2, [x22]                        \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"


                "   str     q2, [x1], #16                   \n"

                //update the kernel
                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"


                //update img row 1 col 1
                "   ldr     q3, [x22, #16]                   \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_PACK_K3                              \n"

                "   fmla    v9.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[1]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"


                "   str     q3, [x1], #16                   \n"

                "   fmla    v13.4s, v1.4s, v2.s[0]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[2]          \n"

                //update kernel 
                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[1]          \n"


                "   fmla    v20.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[1]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_PACK_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v6.4s, v2.s[3]          \n"

                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2

                "   fmla    v12.4s, v7.4s, v2.s[0]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v7.4s, v2.s[3]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[2]          \n"


                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[2]          \n"

                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_PACK_K5                              \n"
    
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"


                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"

                //prepare: row 2 col 0
                "   ldr     q2, [x0]                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                //prepare: row 2 col 1
                "   ldr     q3, [x0, #16]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q1, [x3], #16                   \n"
    ".endm                                                  \n"
    

    
    ".macro M8N7_22_PACK_ADD_C                                   \n"
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"



                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16    \n"
                
                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16    \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16    \n"
                
                
                "   st3     {v16.s, v17.s, v18.s}[0], [x4]    \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x10]    \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x11]    \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x12]    \n"
                

                

                "   st3     {v20.s, v21.s, v22.s}[0], [x13]   \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x14]   \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x15]   \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x16]   \n"

                


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N7_22_PACK_END                             \n"
                
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"

                "   fmla    v12.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"



                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                
                "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"

                "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16 \n"
                /*
                "   st3     {v16.s, v17.s, v18.s}[0], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[1], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[2], [x28], #12     \n"
                "   st3     {v16.s, v17.s, v18.s}[3], [x28], #12     \n"
                
                "   st3     {v20.s, v21.s, v22.s}[0], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[1], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[2], [x28], #12     \n"
                "   st3     {v20.s, v21.s, v22.s}[3], [x28], #12     \n"
                */
                "   st2     {v16.s, v17.s}[0], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[1], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[2], [x28], #8     \n"
                "   st2     {v16.s, v17.s}[3], [x28], #8     \n"
                
                "   st2     {v20.s, v21.s}[0], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x28], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x28], #8     \n"
                
                "   str     q18, [x28], #16     \n"
                "   str     q22, [x28], #16     \n"
                
                
                
                //4
                "   ldr     q0, [x4]                   \n"
                "   ldr     q1, [x10]                   \n"
                "   ldr     q2, [x11]                   \n"
                "   ldr     q3, [x12]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x4], #16                        \n"
                "   str     q9, [x10], #16                       \n"
                "   str     q10, [x11], #16                      \n"
                "   str     q11, [x12], #16                      \n"

                //4
                "   ldr     q0, [x13]                   \n"
                "   ldr     q1, [x14]                   \n"
                "   ldr     q2, [x15]                   \n"
                "   ldr     q3, [x16]                   \n"
                
                "   ldr     q8, [x29], #16                  \n"
                "   ldr     q9, [x29], #16                  \n"
                "   ldr     q10, [x29], #16                  \n"
                "   ldr     q11, [x29], #16                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   fadd    v10.4s, v10.4s, v2.4s             \n"
                "   fadd    v11.4s, v11.4s, v3.4s             \n"
                
                
                "   str     q8, [x13], #16                        \n"
                "   str     q9, [x14], #16                       \n"
                "   str     q10, [x15], #16                      \n"
                "   str     q11, [x16], #16                      \n"

                //2
                "   ld1     {v0.2s}, [x4]                   \n"
                "   ld1     {v1.2s}, [x10]                   \n"
                "   ld1     {v2.2s}, [x11]                   \n"
                "   ld1     {v3.2s}, [x12]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x4], #8                   \n"
                "   st1     {v9.2s}, [x10], #8                   \n"
                "   st1     {v10.2s}, [x11], #8                   \n"
                "   st1     {v11.2s}, [x12], #8                   \n"

                 //2
                "   ld1     {v0.2s}, [x13]                   \n"
                "   ld1     {v1.2s}, [x14]                   \n"
                "   ld1     {v2.2s}, [x15]                   \n"
                "   ld1     {v3.2s}, [x16]                   \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"
                "   ld1     {v10.2s}, [x29], #8                  \n"
                "   ld1     {v11.2s}, [x29], #8                  \n"
                
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   fadd    v10.2s, v10.2s, v2.2s             \n"
                "   fadd    v11.2s, v11.2s, v3.2s             \n"
                
                "   st1     {v8.2s}, [x13], #8                   \n"
                "   st1     {v9.2s}, [x14], #8                   \n"
                "   st1     {v10.2s}, [x15], #8                   \n"
                "   st1     {v11.2s}, [x16], #8                   \n"
                
                //1
                
                "   ld1     {v0.s}[0], [x4]                   \n"
                "   ld1     {v0.s}[1], [x10]                   \n"
                "   ld1     {v0.s}[2], [x11]                   \n"
                "   ld1     {v0.s}[3], [x12]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x4]                  \n"
                "   st1     {v8.s}[1], [x10]                  \n"
                "   st1     {v8.s}[2], [x11]                  \n"
                "   st1     {v8.s}[3], [x12]                  \n"

                //1
                
                "   ld1     {v0.s}[0], [x13]                   \n"
                "   ld1     {v0.s}[1], [x14]                   \n"
                "   ld1     {v0.s}[2], [x15]                   \n"
                "   ld1     {v0.s}[3], [x16]                   \n"
                
                "   ld1     {v8.s}[0], [x29], #4                  \n"
                "   ld1     {v8.s}[1], [x29], #4                  \n"
                "   ld1     {v8.s}[2], [x29], #4                  \n"
                "   ld1     {v8.s}[3], [x29], #4                  \n"
                
                
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                
                "   st1     {v8.s}[0], [x13]                  \n"
                "   st1     {v8.s}[1], [x14]                  \n"
                "   st1     {v8.s}[2], [x15]                  \n"
                "   st1     {v8.s}[3], [x16]                  \n"
    
    ".endm                                                  \n"
    
    "M8N7_22_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"
    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   mov x29, sp                            \n"

    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N7_22_PACK_BEGIN                     \n"
    
    "   sub x29, x29, #224                        \n"
    
    "   mov x28, x29                            \n"
    
    
    "   b M8N7_22_PACK_LOOP                               \n"
    
    "M8N7_22_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N7_22_PACK_K0                     \n"

    "M8N7_22_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N7_22_PACK_K1                                 \n"
    "   uKERNEL_M8N7_22_PACK_K2                                 \n"
    "   uKERNEL_M8N7_22_PACK_K3                                 \n"
    "   uKERNEL_M8N7_22_PACK_K4                                 \n"

    "   beq     M8N7_22_PACK_END_K                        \n"

    "   uKERNEL_M8N7_22_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N7_22_PACK_MAIN_K                       \n" 




    "M8N7_22_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N7_22_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N7_22_PACK_END                    \n"

    "   b    M8N7_22_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N7_22_PACK:                               \n"
    "   M8N7_22_PACK_ADD_C                                   \n"
    
    
    "M8N7_22_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),
        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N5_22_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N5_22_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"
            "   ldr     q2, [x0], #16                      \n"
            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            
            "   fmul    v8.4s, v0.4s, v2.s[0]           \n"
            "   fmul    v9.4s, v0.4s, v2.s[1]           \n"
            "   fmul    v10.4s, v0.4s, v2.s[2]          \n"
            "   fmul    v11.4s, v0.4s, v2.s[3]          \n"
            
            "   ld1     {v3.2s}, [x0]                   \n"

            "   str     q2, [x1], #16                   \n"

            "   fmul    v12.4s, v1.4s, v2.s[0]           \n"
            "   fmul    v13.4s, v1.4s, v2.s[1]          \n"
            "   fmul    v14.4s, v1.4s, v2.s[2]          \n"
            "   fmul    v15.4s, v1.4s, v2.s[3]          \n"
            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"


            "   st1     {v3.2s}, [x1], #8                   \n"

            "   add     x11, x10, x6          \n"

            "   add     x12, x11, x6           \n"


            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"

            "   add     x13, x12, x6           \n"


            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_PACK_K0                              \n"

                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                
                "   str     q2, [x1], #16                   \n"
                
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                
                
                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   st1     {v3.2s}, [x1], #8                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N5_22_PACK_K1                              \n"
    
                "   fmla    v8.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[0]          \n"
                
                "   ldr     q6, [x3], #16                   \n"
                "   fmla    v12.4s, v1.4s, v2.s[1]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N5_22_PACK_K2                              \n"
    
                "   fmla    v8.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[3]           \n"
                "   ldr     q0, [x3], #16                   \n"
                
                "   fmla    v10.4s, v6.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[1]          \n"
                
                "   sub     x0, x0, #16                     \n"
                
                //update the kernel
                "   ldr     q1, [x3], #16                   \n"
    
                "   fmla    v12.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x22], #16                        \n"
                
                "   fmla    v14.4s, v7.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[1]          \n"
                "   add     x0, x0, x5                    \n"


                "   str     q2, [x1], #16                   \n"

                "   ld1     {v3.2s}, [x22]                   \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_PACK_K3                              \n"
                "   fmla    v8.4s, v0.4s, v2.s[0]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[1]           \n"
                "   fmla    v10.4s, v0.4s, v2.s[2]          \n"
                "   fmla    v11.4s, v0.4s, v2.s[3]          \n"

                "   st1     {v3.2s}, [x1], #8                   \n"


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v12.4s, v1.4s, v2.s[0]           \n"
                "   fmla    v13.4s, v1.4s, v2.s[1]          \n"
                "   fmla    v14.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v15.4s, v1.4s, v2.s[3]          \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"


                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_PACK_K4                              \n"
                "   fmla    v8.4s, v6.4s, v2.s[1]           \n"
                "   fmla    v9.4s, v6.4s, v2.s[2]           \n"
                "   fmla    v10.4s, v6.4s, v2.s[3]          \n"
                "   fmla    v11.4s, v6.4s, v3.s[0]          \n"

 
                "   ldr     q0, [x3], #16                   \n"
                


                "   fmla    v12.4s, v7.4s, v2.s[1]          \n"
                "   fmla    v13.4s, v7.4s, v2.s[2]          \n"
                "   fmla    v14.4s, v7.4s, v2.s[3]          \n"
                "   fmla    v15.4s, v7.4s, v3.s[0]          \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"

                
                "   sub     x22, x22, #16                   \n"             //22 sub

                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"

                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N5_22_PACK_K5                              \n"
                "   add     x3, x3, #96         \n"
                "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                "   ldr     q0, [x3], #16                   \n"
                "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                
                "   ldr     q2, [x0], #16                   \n"
                
                "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v15.4s, v1.4s, v3.s[1]          \n"


                //prepare: row 2 col 1
                "   ld1     {v3.2s}, [x0]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"


                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
    ".macro M8N5_22_PACK_ADD_C                                   \n"
                    "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x4], #16    \n"

                    "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x10], #16   \n"
                    "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x11], #16   \n"
                    "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x12], #16   \n"
                    "   fmla    v15.4s, v1.4s, v3.s[1]          \n"

                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x13], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x14], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x15], #16 \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x16], #16 \n"

                "   st1     {v16.s}[0], [x4]        \n"
                "   st1     {v16.s}[1], [x10]        \n"
                "   st1     {v16.s}[2], [x11]        \n"
                "   st1     {v16.s}[3], [x12]        \n"
                
                "   st1     {v20.s}[0], [x13]        \n"
                "   st1     {v20.s}[1], [x14]        \n"
                "   st1     {v20.s}[2], [x15]        \n"
                "   st1     {v20.s}[3], [x16]        \n"

    ".endm                                                  \n"
    
        ".macro uKERNEL_M8N5_22_PACK_END       \n"


                    "   fmla    v8.4s, v0.4s, v2.s[2]           \n"
                    "   fmla    v9.4s, v0.4s, v2.s[3]           \n"
                    "   fmla    v10.4s, v0.4s, v3.s[0]          \n"
                    "   fmla    v11.4s, v0.4s, v3.s[1]          \n"

                    "   st4     {v8.s, v9.s, v10.s, v11.s}[0], [x28], #16    \n"

                    "   fmla    v12.4s, v1.4s, v2.s[2]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[1], [x28], #16    \n"
                    "   fmla    v13.4s, v1.4s, v2.s[3]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[2], [x28], #16   \n"
                    "   fmla    v14.4s, v1.4s, v3.s[0]          \n"
                    "   st4     {v8.s, v9.s, v10.s, v11.s}[3], [x28], #16   \n"
                    "   fmla    v15.4s, v1.4s, v3.s[1]          \n"
                    "   ldr     q0, [x4]                        \n"
                    "   ldr     q1, [x10]                        \n"


                    

                    "   ldr     q8, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[0], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[1], [x28], #16  \n"

                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   str     q8, [x4], #16                        \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[2], [x28], #16  \n"
                    "   st4     {v12.s, v13.s, v14.s, v15.s}[3], [x28], #16  \n"

                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q2, [x11]                       \n"
                    "   fadd    v10.4s, v10.4s, v2.4s           \n"
                    "   str     q9, [x10], #16                       \n"
                    "   str     q16, [x28], #16     \n"
                    "   str     q20, [x28], #16     \n"
                    
                    
                    "   ldr     q11, [x29], #16                 \n"
                    "   ldr     q0, [x12]                       \n"
                    "   fadd    v11.4s, v11.4s, v0.4s           \n"
                    "   str     q10, [x11], #16                      \n"
                    "   str     q11, [x12], #16                      \n"

                    "   ldr     q0, [x13]                        \n"
                    "   ldr     q8, [x29], #16                  \n"
                    
                    "   ldr     q1, [x14]                       \n"
                    "   ldr     q9, [x29], #16                  \n"
                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    "   ldr     q2, [x15]                       \n"
                    "   ldr     q3, [x16]                       \n"
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    
                    "   ldr     q10, [x29], #16                 \n"
                    "   ldr     q11, [x29], #16                 \n"
                    "   fadd    v10.4s, v10.4s, v2.4s             \n"
                    
                    "   str     q8, [x13], #16                        \n"
                    "   str     q9, [x14], #16                       \n"
                    
                    "   fadd    v11.4s, v11.4s, v3.4s             \n"
                    "   str     q10, [x15], #16                      \n"
                    "   str     q11, [x16], #16                      \n"


                    "   ldr     q8, [x29], #16                  \n"
                    "   ld1     {v0.s}[0], [x4]                   \n"
                    "   ld1     {v0.s}[1], [x10]                   \n"
                    "   ld1     {v0.s}[2], [x11]                   \n"
                    "   ld1     {v0.s}[3], [x12]                   \n"

                    "   fadd    v8.4s, v8.4s, v0.4s             \n"
                    
                    
                    
                    "   ldr     q9, [x29], #16                  \n"
                    "   ld1     {v1.s}[0], [x13]                   \n"
                    "   ld1     {v1.s}[1], [x14]                   \n"
                    "   ld1     {v1.s}[2], [x15]                   \n"
                    "   ld1     {v1.s}[3], [x16]                   \n"
                    
                    "   st1     {v8.s}[0], [x4]                  \n"
                    "   st1     {v8.s}[1], [x10]                  \n"
                    "   st1     {v8.s}[2], [x11]                  \n"
                    "   st1     {v8.s}[3], [x12]                  \n"
                    
                    "   fadd    v9.4s, v9.4s, v1.4s             \n"
                    "   st1     {v9.s}[0], [x13]                  \n"
                    "   st1     {v9.s}[1], [x14]                  \n"
                    "   st1     {v9.s}[2], [x15]                  \n"
                    "   st1     {v9.s}[3], [x16]                  \n"
    
    ".endm                                                  \n"
    
    "M8N5_22_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    "   mov x29, sp                            \n"
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub x29, x29, #160                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N5_22_PACK_BEGIN                     \n"
    "   mov x28, x29                            \n"
    
    
    "   b M8N5_22_PACK_LOOP                               \n"
    
    "M8N5_22_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N5_22_PACK_K0                     \n"

    "M8N5_22_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N5_22_PACK_K1                                 \n"
    "   uKERNEL_M8N5_22_PACK_K2                                 \n"
    "   uKERNEL_M8N5_22_PACK_K3                                 \n"
    "   uKERNEL_M8N5_22_PACK_K4                                 \n"

    "   beq     M8N5_22_PACK_END_K                        \n"

    "   uKERNEL_M8N5_22_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N5_22_PACK_MAIN_K                       \n" 




    "M8N5_22_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N5_22_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N5_22_PACK_END                    \n"

    "   b    M8N5_22_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N5_22_PACK:                               \n"
    "   M8N5_22_PACK_ADD_C                                   \n"
    
    
    "M8N5_22_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3_M8N4_22_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N4_22_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            

            
            //update img
            "   ldr     q3, [x0], #16                      \n"



            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"

            "   fmul    v18.4s, v0.4s, v3.s[2]          \n"
            "   fmul    v19.4s, v0.4s, v3.s[3]          \n"
            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"

            "   fmul    v22.4s, v1.4s, v3.s[2]          \n"
            "   fmul    v23.4s, v1.4s, v3.s[3]          \n"
            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_PACK_K0                              \n"




                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"
                
                "   ldr     q0, [x3], #16                   \n"
                

                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N4_22_PACK_K1                              \n"
    

                
                "   ld1     {v4.2s}, [x0], #8               \n"
                

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v0.4s, v4.s[0]          \n"

                "   st1     {v4.2s}, [x1], #8                   \n"

                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v1.4s, v4.s[0]          \n"

                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N4_22_PACK_K2                              \n"
    

                
                "   sub     x0, x0, #24                     \n"
                
                //update the kernel
                "   ldr     q0, [x3], #16                   \n"
    

                "   add     x0, x0, x5                    \n"
                //update img row 1 col 0

                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v6.4s, v4.s[0]          \n"


                //update the kernel
                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v7.4s, v4.s[0]          \n"

                "   ldr     q3, [x22], #16                   \n"
                
                //update img row 1 col 1
                
                //update img row 1 col 2

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_PACK_K3                              \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v18.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v19.4s, v0.4s, v3.s[3]          \n"

                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v22.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v23.4s, v1.4s, v3.s[3]          \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_PACK_K4                              \n"


                //update kernel 
                "   ldr     q0, [x3], #16                   \n"
                
                //edge :row 1 col 2



                //edge :row 1 col 2
                "   ld1     {v4.2s}, [x22], #8                   \n"

                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"
                "   fmla    v18.4s, v6.4s, v3.s[3]          \n"
                "   fmla    v19.4s, v6.4s, v4.s[0]          \n"
                
                "   sub     x22, x22, #24                   \n"             //22 sub
                
                "   st1     {v4.2s}, [x1], #8                   \n"
                
                //update kernel 
                "   ldr     q1, [x3], #16                   \n"
                
                //correspongding add

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"
                "   fmla    v22.4s, v7.4s, v3.s[3]          \n"
                "   fmla    v23.4s, v7.4s, v4.s[0]          \n"
                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_PACK_K5                              \n"
                "   add     x3, x3, #96         \n"


                //prepare: row 2 col 0

                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"

                //prepare: row 2 col 1
                "   ldr     q3, [x0], #16                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q0, [x3], #16                   \n"

                
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
    ".macro M8N4_22_PACK_ADD_C                                   \n"


                        "   fmla    v16.4s, v0.4s, v3.s[2]          \n"

                        "   fmla    v17.4s, v0.4s, v3.s[3]          \n"

                        "   fmla    v18.4s, v0.4s, v4.s[0]          \n"


                        "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [x4]       \n"

                        "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [x10]      \n"
                        "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [x11]      \n"
                        "   fmla    v22.4s, v1.4s, v4.s[0]          \n"
                        "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [x12]      \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [x13]      \n"

                        "   add     sp, sp, #128                    \n"

                        "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [x14]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [x15]      \n"
                        "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [x16]      \n"

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N4_22_PACK_END                             \n"
    



                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[3]          \n"
                "   fmla    v18.4s, v0.4s, v4.s[0]          \n"




                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[3]          \n"
                "   fmla    v22.4s, v1.4s, v4.s[0]          \n"

                "   st4     {v16.s, v17.s, v18.s, v19.s}[0], [sp], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[1], [sp], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[2], [sp], #16    \n"
                "   st4     {v16.s, v17.s, v18.s, v19.s}[3], [sp], #16    \n"
                
                "   st4     {v20.s, v21.s, v22.s, v23.s}[0], [sp], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[1], [sp], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[2], [sp], #16    \n"
                "   st4     {v20.s, v21.s, v22.s, v23.s}[3], [sp], #16    \n"

                "   ldr     q0, [x4]                        \n"
                "   ldr     q1, [x10]                        \n"

                "   ldr     q8, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"


                "   ldr     q9, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x4]                        \n"


                "   ldr     q10, [x29], #16                 \n"
                "   ldr     q2, [x11]                       \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x10]                       \n"

                "   ldr     q11, [x29], #16                 \n"
                "   ldr     q0, [x12]                       \n"
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x11]                      \n"
                "   str     q11, [x12]                      \n"

                "   ldr     q8, [x13]                       \n"


                "   ldr     q9, [x14]                       \n"


                "   ldr     q10, [x15]                      \n"


                "   ldr     q11, [x16]                      \n"


                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v8.4s, v8.4s, v0.4s             \n"

                "   ldr     q1, [x29], #16                  \n"
                "   fadd    v9.4s, v9.4s, v1.4s             \n"
                "   str     q8, [x13]                       \n"

                "   ldr     q2, [x29], #16                  \n"
                "   fadd    v10.4s, v10.4s, v2.4s           \n"
                "   str     q9, [x14]                       \n"

                "   ldr     q0, [x29], #16                  \n"
                "   fadd    v11.4s, v11.4s, v0.4s           \n"
                "   str     q10, [x15]                      \n"
                "   str     q11, [x16]                      \n"
    
    ".endm                                                  \n"
    
    "M8N4_22_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #128                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N4_22_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N4_22_PACK_LOOP                               \n"
    
    "M8N4_22_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N4_22_PACK_K0                     \n"

    "M8N4_22_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N4_22_PACK_K1                                 \n"
    "   uKERNEL_M8N4_22_PACK_K2                                 \n"
    "   uKERNEL_M8N4_22_PACK_K3                                 \n"
    "   uKERNEL_M8N4_22_PACK_K4                                 \n"

    "   beq     M8N4_22_PACK_END_K                        \n"

    "   uKERNEL_M8N4_22_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N4_22_PACK_MAIN_K                       \n" 




    "M8N4_22_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N4_22_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N4_22_PACK_END                    \n"

    "   b    M8N4_22_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N4_22_PACK:                               \n"
    "   M8N4_22_PACK_ADD_C                                   \n"
    
    
    "M8N4_22_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}


void direct_3x3_M8N2_22_p1_s1_pack(float *img_start_0, float *img_start_1, float *img_pack, float *kernal, float *out, long ic_count, long ic, long stride_out_size, long stride_in_size){
    
    asm volatile(
    ".macro uKERNEL_M8N2_22_PACK_BEGIN                             \n"
            //update kernel
            "   ldr     q0, [x3], #16                      \n"

            "   ldr     q1, [x3], #16                      \n"
            //update img 
            "   add     x10, x4, x6                     \n"
            

            
            //update img
            "   ldr     q3, [x0]                      \n"



            

            "   fmul    v16.4s, v0.4s, v3.s[0]          \n"
            "   fmul    v17.4s, v0.4s, v3.s[1]          \n"

            "   str     q3, [x1], #16                   \n"

            "   add     x11, x10, x6          \n"


            
            //update img

            "   add     x12, x11, x6           \n"


        // 浮点向量乘法指令
            "   fmul    v20.4s, v1.4s, v3.s[0]          \n"
            "   fmul    v21.4s, v1.4s, v3.s[1]          \n"


            "   add     x13, x12, x6           \n"


            
            //update kernel 

            "   add     x14, x13, x6           \n"

            "   add     x15, x14, x6          \n"


            "   prfm    PLDL2KEEP, [x4, #64]           \n"
            "   prfm    PLDL2KEEP, [x10, #64]          \n"
            "   prfm    PLDL2KEEP, [x11, #64]          \n"
            "   prfm    PLDL2KEEP, [x12, #64]          \n"
            
            "   ldr     q0, [x3], #16                   \n"
            "   add     x16, x15, x6          \n"


            "   prfm    PLDL2KEEP, [x13, #64]          \n"
            "   prfm    PLDL2KEEP, [x14, #64]          \n"
            "   prfm    PLDL2KEEP, [x15, #64]          \n"
            "   prfm    PLDL2KEEP, [x16, #64]          \n"
            
            "   ldr     q1, [x3], #16                   \n"
            

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_PACK_K0                              \n"




                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"


                "   str     q3, [x1], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"

                
                "   ldr     q0, [x3], #16                   \n"
                

                
                "   ldr     q1, [x3], #16                   \n"
                
    ".endm                                                  \n"
    
    
    
    ".macro uKERNEL_M8N2_22_PACK_K1                              \n"

                "   fmla    v16.4s, v0.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[2]          \n"


                "   ldr     q6, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[2]          \n"


                "   prfm    PLDL1KEEP, [x3, #256]           \n"

                
                "   ldr     q7, [x3], #16                   \n"


    ".endm                                                  \n"
    
    
    ".macro uKERNEL_M8N2_22_PACK_K2                              \n"

                "   ldr     q0, [x3], #16                   \n"
                "   add     x0, x0, x5                    \n"


                "   fmla    v16.4s, v6.4s, v3.s[2]          \n"



                //update the kernel
                "   ldr     q1, [x3], #16                   \n"


                "   fmla    v20.4s, v7.4s, v3.s[2]          \n"


                "   ldr     q3, [x22]                   \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_PACK_K3                              \n"

                //update kernel 
                "   ldr     q6, [x3], #16                   \n"



                "   fmla    v16.4s, v0.4s, v3.s[0]          \n"
                "   fmla    v17.4s, v0.4s, v3.s[1]          \n"


                "   str     q3, [x1], #16                   \n"

                "   ldr     q7, [x3], #16                   \n"

                "   fmla    v20.4s, v1.4s, v3.s[0]          \n"
                "   fmla    v21.4s, v1.4s, v3.s[1]          \n"


    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_PACK_K4                              \n"

                "   ldr     q0, [x3], #16                   \n"


                "   fmla    v16.4s, v6.4s, v3.s[1]          \n"
                "   fmla    v17.4s, v6.4s, v3.s[2]          \n"

                "   ldr     q1, [x3], #16                   \n"

                "   fmla    v20.4s, v7.4s, v3.s[1]          \n"
                "   fmla    v21.4s, v7.4s, v3.s[2]          \n"

                "   add     x22, x22, x5                    \n"             //更新x22:img_1
                

    ".endm                                                  \n"
    
    ".macro uKERNEL_M8N2_22_PACK_K5                              \n"
                "   add     x3, x3, #96         \n"


                "   fmla    v16.4s, v0.4s, v3.s[2]          \n"

                "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   ldr     q3, [x0]                   \n"

                "   prfm PLDL1KEEP, [x3, #256]              \n"

                
                "   ldr     q0, [x3], #16                   \n"
                "   ldr     q1, [x3], #16                   \n"

                //prepare: row 2 col 2
    ".endm                                                  \n"
    

    
                ".macro M8N2_22_PACK_ADD_C       \n"


                    "   fmla    v16.4s, v0.4s, v3.s[2]          \n"


                    "   fmla    v20.4s, v1.4s, v3.s[2]          \n"
                    
                    "   st2     {v16.s, v17.s}[0], [x4]      \n"
                    "   st2     {v16.s, v17.s}[1], [x10]      \n"
                    "   st2     {v16.s, v17.s}[2], [x11]      \n"
                    "   st2     {v16.s, v17.s}[3], [x12]      \n"


                    "   add     sp, sp, #64                    \n"

                    "   st2     {v20.s, v21.s}[0], [x13]      \n"
                    "   st2     {v20.s, v21.s}[1], [x14]      \n"
                    "   st2     {v20.s, v21.s}[2], [x15]      \n"
                    "   st2     {v20.s, v21.s}[3], [x16]      \n"


                ".endm              \n"
                
                ".macro uKERNEL_M8N2_22_PACK_END       \n"


                    "   fmla    v16.4s, v0.4s, v3.s[2]          \n"
                    "   fmla    v20.4s, v1.4s, v3.s[2]          \n"

                "   st2     {v16.s, v17.s}[0], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[1], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[2], [x29], #8       \n"
                "   st2     {v16.s, v17.s}[3], [x29], #8       \n"

                "   st2     {v20.s, v21.s}[0], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[1], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[2], [x29], #8     \n"
                "   st2     {v20.s, v21.s}[3], [x29], #8     \n"
                
                "   sub     x29, x29, #64                   \n"
                
                "   ld1     {v0.2s}, [x4]                        \n"
                "   ld1     {v1.2s}, [x10]                       \n"
                
                "   ld1     {v8.2s}, [x29], #8                  \n"
                "   ld1     {v9.2s}, [x29], #8                  \n"


                "   ld1     {v10.2s}, [x29], #8                 \n"
                "   ld1     {v11.2s}, [x29], #8                 \n"
                
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                
                "   st1     {v8.2s}, [x4]                        \n"
                "   st1     {v9.2s}, [x10]                       \n"

                
                "   ld1     {v2.2s}, [x11]                       \n"
                "   ld1     {v0.2s}, [x12]                       \n"
                
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"


                "   st1     {v10.2s}, [x11]                      \n"
                "   st1     {v11.2s}, [x12]                      \n"


                "   ld1     {v8.2s}, [x13]                       \n"
                "   ld1     {v9.2s}, [x14]                       \n"
                "   ld1     {v10.2s}, [x15]                      \n"
                "   ld1     {v11.2s}, [x16]                      \n"



                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v8.2s, v8.2s, v0.2s             \n"
                "   st1     {v8.2s}, [x13]                       \n"


                "   ld1     {v1.2s}, [x29], #8                 \n"
                "   fadd    v9.2s, v9.2s, v1.2s             \n"
                "   st1     {v9.2s}, [x14]                       \n"

                "   ld1     {v2.2s}, [x29], #8                  \n"
                "   fadd    v10.2s, v10.2s, v2.2s           \n"
                "   st1     {v10.2s}, [x15]                      \n"

                "   ld1     {v0.2s}, [x29], #8                  \n"
                "   fadd    v11.2s, v11.2s, v0.2s           \n"
                "   st1     {v11.2s}, [x16]                      \n"
                "   add     sp, sp, #64                    \n"


                ".endm                                          \n" 
    
    "M8N2_22_PACK_ENTRANCE:                                                       \n"
    "   ldr x0, %[img_start_0]                    \n"
    "   ldr x22, %[img_start_1]                      \n"

    "   ldr x1, %[img_pack]                     \n"
    "   ldr x3, %[kernal]                       \n"
    "   ldr x4, %[out]                          \n"
    "   ldr x7, %[ic_count]                     \n"
    "   ldr x6, %[stride_out_size]             \n"
    "   ldr x5, %[stride_in_size]             \n"
    
    "   prfm PLDL1KEEP, [x0, #128]              \n"
    "   prfm PLDL1KEEP, [x3, #256]              \n"
    
    "   ldr x8, %[ic]                          \n"
    
    "   sub sp, sp, #64                        \n"
    "   subs x7, x7, #1                         \n"
    
    "   uKERNEL_M8N2_22_PACK_BEGIN                     \n"
    "   mov x29, sp                            \n"
    
    
    "   b M8N2_22_PACK_LOOP                               \n"
    
    "M8N2_22_PACK_MAIN_K:                                  \n"
        "   uKERNEL_M8N2_22_PACK_K0                     \n"

    "M8N2_22_PACK_LOOP:                                  \n"
    "   uKERNEL_M8N2_22_PACK_K1                                 \n"
    "   uKERNEL_M8N2_22_PACK_K2                                 \n"
    "   uKERNEL_M8N2_22_PACK_K3                                 \n"
    "   uKERNEL_M8N2_22_PACK_K4                                 \n"

    "   beq     M8N2_22_PACK_END_K                        \n"

    "   uKERNEL_M8N2_22_PACK_K5                                 \n"

    "   subs    x7, x7, #1                 \n"
    "   b       M8N2_22_PACK_MAIN_K                       \n" 




    "M8N2_22_PACK_END_K:                                     \n"
    //ic = 0, store
    "   cmp     x8, #0                          \n"
    "   beq     END_uKERNEL_M8N2_22_PACK                     \n"

    //ic != 0
    "   uKERNEL_M8N2_22_PACK_END                    \n"

    "   b    M8N2_22_PACK_END                             \n"
    
    //ic = 0, add
    "END_uKERNEL_M8N2_22_PACK:                               \n"
    "   M8N2_22_PACK_ADD_C                                   \n"
    
    
    "M8N2_22_PACK_END:                                       \n"
    :

    :
        [img_start_0]                 "m"     (img_start_0),
        [img_start_1]                 "m"     (img_start_1),

        [img_pack]                    "m"     (img_pack),
        [kernal]                    "m"     (kernal),
        [out]                       "m"     (out),
        [ic_count]                  "m"     (ic_count),
        [ic]                        "m"     (ic),
        [stride_out_size]           "m"     (stride_out_size),
        [stride_in_size]            "m"     (stride_in_size)
        
    :
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7", "x8",
        "x9", "x10", "x11", "x12", "x13","x14", "x15", "x16",
        "x17", "x18", "x19", "x20", "x21", "x22", "x23", "x24","x25",
        "x26", "x27", "x28","x29","x30",
        "v0", "v1", "v2", "v3", "v4", "v5", "v6", "v7",
        "v8", "v9", "v10", "v11", "v12", "v13", "v14", "v15",
        "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
        "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31"
    );
    
    
}

void direct_3x3s1(float* out_kernal, float* img, float* out, long inch, long outch, long in_h, long out_h, long k_h, long p_h, long s_h, long kc_tile, long ic_tile, long ic_out_tile, long kc_out_tile){
    
    
    long in_size = in_h * in_h;
    
    long i_d_c = out_h / 12;

    long i_d_c_size = i_d_c * 12;
    
    long i_d_r = out_h % 12;

    long i_s_h = 12 + k_h - 1;
    
    long i_s_n = 3 * i_s_h;
    
    
    long i_s_n_ic_tile = i_s_n * ic_tile;
    

    
    long out_w = out_h;
    
    long out_w_c = out_h / 12 * 12;
    
    long out_w_r = out_h % 12;
    
    long stride_in = in_h * in_h;
    
    long stride_in_size = stride_in * sizeof(float);
    
    
    long stride_out = out_h * out_w;
    
    long stride_out_size = stride_out * sizeof(float);
    
    
    long stride_k = k_h * k_h;
    

    
    float *kernal_k, *kernal_s, *kernal_c, *kernal_start, *kernal_1;
    
    float *out_img_s, *out_img_c, *out_img_p, *out_img_p_1;
    
    float *img_start, *img_start_h, *img_start_s_0;
    
    float *img_start_s_1, *img_start_s_2, *img_start_s_3;
    
    float *r0;
    
    float *img_pack = (float*)malloc(i_s_n_ic_tile * sizeof(float));
    
    long i, j, k, ic, oc, oh, ow;
    
    long kc;
    
    long kc_out, ic_out;
    
    long kc_size = kc_tile;
    
    long kc_count = outch / kc_size;
    
    long oh_count, oh_re;
    
    for(kc_out = 0; kc_out < outch; kc_out += kc_out_tile){

        kernal_start = out_kernal + 9 * inch * kc_out;
        
        for(ic_out = 0; ic_out<inch; ic_out += ic_out_tile){

            kernal_1 = kernal_start + 9 * kc_out_tile * ic_out;
            
            for(kc = kc_out; kc < kc_out + kc_out_tile; kc += kc_tile){

                kernal_k = kernal_1 + 9 * (kc - kc_out) * ic_out_tile;
                
                for(ic=ic_out; ic < ic_out + ic_out_tile; ic += ic_tile){

                    kernal_s = kernal_k + 9 * (ic - ic_out) * kc_tile;
                    
                    img_start = img + ic * in_size;
                    
                    for(oh=0; oh < out_h; oh++){
                        
                        
                        
                        img_start_h = img_start + oh * in_h;
                        
                        out_img_s = out + oh * out_w;
                        
                        if(oh == 0){
                        

                            for(ow=0; ow<out_w_c; ow+=12){
                                
                                
                                out_img_c = out_img_s + ow;
                                
                                if(ow == 0){
                                
                                    img_start_s_0 = img_start_h;
                                    
                                    img_start_s_1 = img_start_s_0 + in_h;
                                
                                    for(oc = kc; oc < kc + kc_tile; oc+=8){
                                        
                                        out_img_p = out_img_c + oc * stride_out;
                                        
                                        kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                        
                                        if(oc == kc){
                                            direct_3x3_M8N12_00_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N12_00_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }


                                        
                                    }
                                }
                                else{
                                    
                                    img_start_s_0 = img_start_h + ow - 1;
                                    
                                    img_start_s_1 = img_start_s_0 + in_h;
                                    
                                    for(oc = kc; oc < kc + kc_tile; oc+=8){
                                        
                                        
                                        out_img_p = out_img_c + oc * stride_out;
                                        
                                        kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                        
                                        if(oc == kc){
                                            direct_3x3_M8N12_01_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N12_01_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        
                                    }
                                    
                                    
                                }
                                
                            
                            
                            }
                        
                            if(out_w_r == 8){
                                
                                img_start_s_0 = img_start_h + ow - 1 ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N8_02_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N8_02_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }


                                    }
                                    
                                }
                        
                        
                            else if(out_w_r == 10){
                                
                                img_start_s_0 = img_start_h + ow-1;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N10_02_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }
                                        else{
                                            direct_3x3_M8N10_02_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }


                                    }
                                    
                                }
                        
                            else if(out_w_r == 5){
                                
                                img_start_s_0 = img_start_h + ow-1;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){

                                            direct_3x3_M8N5_02_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }
                                        else{
                                            direct_3x3_M8N5_02_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);



                                        }


                                    }
                                    
                                }
                        
                            else if(out_w_r == 7){
                                
                                img_start_s_0 = img_start_h + ow;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N7_02_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }
                                        else{
                                            direct_3x3_M8N7_02_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }


                                    }
                                    
                                }
                        
                        
                            else if(out_w_r == 4){
                                
                                img_start_s_0 = img_start_h + ow - 1 ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N4_02_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }
                                        else{
                                            direct_3x3_M8N4_02_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }


                                    }
                                    
                                }
                        
                            else if(out_w_r == 2){
                                
                                img_start_s_0 = img_start_h + ow - 1 ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N2_02_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                            
                                        }
                                        else{
                                            direct_3x3_M8N2_02_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                        }


                                    }
                                    
                                }
                        
                        
                        }

                        else if(0 < oh && oh < (out_h - 1) ){

                            
                            
                            for(ow=0; ow<out_w_c; ow+=12){
                                
                                
                                out_img_c = out_img_s + ow;
                                
                                if(ow == 0){
                                
                                    img_start_s_0 = img_start_h + ow - in_h;
                                    
                                    img_start_s_1 = img_start_s_0 + in_h;
                                    
                                    img_start_s_2 = img_start_s_1 + in_h;
                                
                                    for(oc = kc; oc < kc + kc_tile; oc+=8){
                                        
                                        
                                        out_img_p = out_img_c + oc * stride_out;
                                        
                                        kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                        
                                        if(oc == kc){
                                            direct_3x3_M8N12_10_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N12_10_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        
                                  
                                        
                                    }
                                }
                                
                                else{
                                        
                                    img_start_s_0 = img_start_h + ow - in_h - 1;
                                    
                                    img_start_s_1 = img_start_s_0 + in_h;
                                    
                                    img_start_s_2 = img_start_s_1 + in_h;
                                        
                                    for(oc = kc; oc < kc + kc_tile; oc+=8){
                                        
                                        out_img_p = out_img_c + oc * stride_out;
                                        
                                        kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                        
                                        if(oc == kc){
                                            direct_3x3_M8N12_11_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N12_11_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        
                                    
                                        
                                    }
                                        
                                    
                                }
                            
                            
                            }
                        
                            if(out_w_r == 8){
                                
                                
                                img_start_s_0 = img_start_h + ow - in_h - 1 ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                img_start_s_2 = img_start_s_1 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N8_12_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N8_12_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }


                                    }
                            
                            
                            }
                        
                            else if(out_w_r == 7){
                                
                                
                                img_start_s_0 = img_start_h - in_h ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                img_start_s_2 = img_start_s_1 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N7_12_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }
                                        else{
                                            direct_3x3_M8N7_12_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                        }


                                    }
                            
                            
                            }
                        
                            else if(out_w_r == 10){
                                
                                
                                img_start_s_0 = img_start_h - in_h +ow -1;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                img_start_s_2 = img_start_s_1 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N10_12_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }
                                        else{
                                            direct_3x3_M8N10_12_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            
                                        }


                                    }
                            
                            
                            }
                        
                            else if(out_w_r == 5){
                                
                                
                                img_start_s_0 = img_start_h - in_h +ow -1;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                img_start_s_2 = img_start_s_1 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N5_12_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);


                                        }
                                        else{

                                            direct_3x3_M8N5_12_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            
                                        }


                                    }
                            
                            
                            }
                        
                        
                            else if(out_w_r == 4){
                                
                                img_start_s_0 = img_start_h + ow - in_h - 1 ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                img_start_s_2 = img_start_s_1 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){

                                            direct_3x3_M8N4_12_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                            
                                        }
                                        else{
                                            direct_3x3_M8N4_12_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                        }


                                    }
                            
                            
                            }
                        
                            else if(out_w_r == 2){
                                
                                img_start_s_0 = img_start_h + ow - in_h - 1 ;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                img_start_s_2 = img_start_s_1 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                    
                                        if(oc == kc){

                                            
                                            direct_3x3_M8N2_12_p1_s1_pack(img_start_s_0, img_start_s_1, img_start_s_2, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                            
                                        }
                                        else{
                                            direct_3x3_M8N2_12_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }


                                    }
                            
                            
                            }
                        
                        
                        }
                        
                        else if(oh == (out_h -1 )){
                        
                  
                            for(ow=0; ow<out_w_c; ow+=12){
                                
                                
                                out_img_c = out_img_s + ow;
                                
                                if(ow == 0){
                                
                                    img_start_s_0 = img_start_h  - in_h;
                                    
                                    img_start_s_1 = img_start_s_0 + in_h;
                                
                                    for(oc = kc; oc < kc + kc_tile; oc+=8){
                                        
                                        
                                        out_img_p = out_img_c + oc * stride_out;
                                        
                                        kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                        
                                        if(oc == kc){
                                            direct_3x3_M8N12_20_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N12_20_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        
                                        
                                    }
                                }
                                
                                else{
                                    
                                    img_start_s_0 = img_start_h + ow - in_h - 1;
                                    
                                    img_start_s_1 = img_start_s_0 + in_h;
                                    
                                    for(oc = kc; oc < kc + kc_tile; oc+=8){

                                        out_img_p = out_img_c + oc * stride_out;
                                        
                                        kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                        
                                        if(oc == kc){
                                            direct_3x3_M8N12_21_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N12_21_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        
                                        
                                        
                                    }
                                    
                                }
                            
                            
                            }
                        
                            if(out_w_r == 8){
                                
                                img_start_s_0 = img_start_h + ow - 1 - in_h;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                  
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N8_22_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }
                                        else{
                                            direct_3x3_M8N8_22_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                        }

                                    }

                            }
                        
                            else if(out_w_r == 7){
                                
                                img_start_s_0 = img_start_h - in_h;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                  
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N7_22_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }
                                        else{
                                            direct_3x3_M8N7_22_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            

                                        }

                                    }

                            }
                        
                            else if(out_w_r == 10){
                                
                                img_start_s_0 = img_start_h - in_h + ow -1;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                  
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N10_22_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
  
                                            
                                        }
                                        else{
                                            direct_3x3_M8N10_22_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }

                                    }

                            }
                        
                            else if(out_w_r == 5){
                                
                                img_start_s_0 = img_start_h - in_h + ow -1;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                  
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N5_22_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
  
                                            
                                        }
                                        else{
                                            direct_3x3_M8N5_22_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);
                                            
                                        }

                                    }

                            }
                        
                            else if(out_w_r == 4){
                                
                                img_start_s_0 = img_start_h + ow - 1 - in_h;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                  
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N4_22_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }
                                        else{
                                            direct_3x3_M8N4_22_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }

                                    }

                            }
                        
                            else if(out_w_r == 2){
                                
                                img_start_s_0 = img_start_h + ow - 1 - in_h;
                                
                                img_start_s_1 = img_start_s_0 + in_h;
                                
                                out_img_c = out_img_s + ow;
                                
                                for(oc = kc; oc < kc + kc_tile; oc+=8){
                                    
                                    out_img_p = out_img_c + oc * stride_out;
                                    
                                    kernal_c = kernal_s + 9 * (oc - kc) * ic_tile;
                                    
                                  
                                    
                                        if(oc == kc){
                                            direct_3x3_M8N2_22_p1_s1_pack(img_start_s_0, img_start_s_1, img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                            
                                        }
                                        else{
                                            direct_3x3_M8N2_22_p1_s1(img_pack, kernal_c, out_img_p, ic_tile, ic, stride_out_size, stride_in_size);

                                        }

                                    }

                            }
                        
                        }
                    
                    }
                    


            
                }
        
            }
        

        }
    
    }

    
}


